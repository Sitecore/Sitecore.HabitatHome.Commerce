---
ID: "52a1386c-6848-4122-a1f5-8c3e01568627"
Parent: "0f96d50a-ce5f-456f-837d-a416b6d71b99"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: "/sitecore/media library/Themes/Habitat Sites/Habitat Home Store/scripts/vendors/knockoutvalidation-200"
DB: master
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/87C29E4EC4C04524B1F1876ADAE457ED.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  BlobID: "c5f55ed4-ca81-4ae7-bb5d-9ee9804d6d9f"
  Value: Lyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KCUF1dGhvcjoJCQlFcmljIE0uIEJhcm5hcmQgLSBAZXJpY21iYXJuYXJkCQkJCQkJCQkNCglMaWNlbnNlOgkJTUlUIChodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvbWl0LWxpY2Vuc2UucGhwKQkJDQoJCQkJCQkJCQkJCQkJCQkJCQkJCQ0KCURlc2NyaXB0aW9uOglWYWxpZGF0aW9uIExpYnJhcnkgZm9yIEtub2Nrb3V0SlMJCQkJCQkJDQoJVmVyc2lvbjoJCTIuMC4wCQkJCQkJCQkJCQkNCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiovDQovKmdsb2JhbHMgcmVxdWlyZTogZmFsc2UsIGV4cG9ydHM6IGZhbHNlLCBkZWZpbmU6IGZhbHNlLCBrbzogZmFsc2UgKi8NCg0KKGZ1bmN0aW9uIChmYWN0b3J5KSB7DQoJLy8gTW9kdWxlIHN5c3RlbXMgbWFnaWMgZGFuY2UuDQoNCglpZiAodHlwZW9mIHJlcXVpcmUgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIGV4cG9ydHMgPT09ICJvYmplY3QiICYmIHR5cGVvZiBtb2R1bGUgPT09ICJvYmplY3QiKSB7DQoJCS8vIENvbW1vbkpTIG9yIE5vZGU6IGhhcmQtY29kZWQgZGVwZW5kZW5jeSBvbiAia25vY2tvdXQiDQoJCWZhY3RvcnkocmVxdWlyZSgia25vY2tvdXQiKSwgZXhwb3J0cyk7DQoJfSBlbHNlIGlmICh0eXBlb2YgZGVmaW5lID09PSAiZnVuY3Rpb24iICYmIGRlZmluZVsiYW1kIl0pIHsNCgkJLy8gQU1EIGFub255bW91cyBtb2R1bGUgd2l0aCBoYXJkLWNvZGVkIGRlcGVuZGVuY3kgb24gImtub2Nrb3V0Ig0KCQlkZWZpbmUoWyJrbm9ja291dCIsICJleHBvcnRzIl0sIGZhY3RvcnkpOw0KCX0gZWxzZSB7DQoJCS8vIDxzY3JpcHQ+IHRhZzogdXNlIHRoZSBnbG9iYWwgYGtvYCBvYmplY3QsIGF0dGFjaGluZyBhIGBtYXBwaW5nYCBwcm9wZXJ0eQ0KCQlmYWN0b3J5KGtvLCBrby52YWxpZGF0aW9uID0ge30pOw0KCX0NCn0oZnVuY3Rpb24gKCBrbywgZXhwb3J0cyApIHsNCg0KCWlmICh0eXBlb2YgKGtvKSA9PT0gJ3VuZGVmaW5lZCcpIHsNCgkJdGhyb3cgbmV3IEVycm9yKCdLbm9ja291dCBpcyByZXF1aXJlZCwgcGxlYXNlIGVuc3VyZSBpdCBpcyBsb2FkZWQgYmVmb3JlIGxvYWRpbmcgdGhpcyB2YWxpZGF0aW9uIHBsdWctaW4nKTsNCgl9DQoNCgkvLyBjcmVhdGUgb3VyIG5hbWVzcGFjZSBvYmplY3QNCglrby52YWxpZGF0aW9uID0gZXhwb3J0czsNCg0KCXZhciBrdiA9IGtvLnZhbGlkYXRpb24sDQoJCWtvVXRpbHMgPSBrby51dGlscywNCgkJdW53cmFwID0ga29VdGlscy51bndyYXBPYnNlcnZhYmxlLA0KCQlmb3JFYWNoID0ga29VdGlscy5hcnJheUZvckVhY2gsDQoJCWV4dGVuZCA9IGtvVXRpbHMuZXh0ZW5kOw0KOy8qZ2xvYmFsIGtvOiBmYWxzZSovDQoNCnZhciBkZWZhdWx0cyA9IHsNCglyZWdpc3RlckV4dGVuZGVyczogdHJ1ZSwNCgltZXNzYWdlc09uTW9kaWZpZWQ6IHRydWUsDQoJZXJyb3JzQXNUaXRsZTogdHJ1ZSwgICAgICAgICAgICAvLyBlbmFibGVzL2Rpc2FibGVzIHNob3dpbmcgb2YgZXJyb3JzIGFzIHRpdGxlIGF0dHJpYnV0ZSBvZiB0aGUgdGFyZ2V0IGVsZW1lbnQuDQoJZXJyb3JzQXNUaXRsZU9uTW9kaWZpZWQ6IGZhbHNlLCAvLyBzaG93cyB0aGUgZXJyb3Igd2hlbiBob3ZlcmluZyB0aGUgaW5wdXQgZmllbGQgKGRlY29yYXRlRWxlbWVudCBtdXN0IGJlIHRydWUpDQoJbWVzc2FnZVRlbXBsYXRlOiBudWxsLA0KCWluc2VydE1lc3NhZ2VzOiB0cnVlLCAgICAgICAgICAgLy8gYXV0b21hdGljYWxseSBpbnNlcnRzIHZhbGlkYXRpb24gbWVzc2FnZXMgYXMgPHNwYW4+PC9zcGFuPg0KCXBhcnNlSW5wdXRBdHRyaWJ1dGVzOiBmYWxzZSwgICAgLy8gcGFyc2VzIHRoZSBIVE1MNSB2YWxpZGF0aW9uIGF0dHJpYnV0ZSBmcm9tIGEgZm9ybSBlbGVtZW50IGFuZCBhZGRzIHRoYXQgdG8gdGhlIG9iamVjdA0KCXdyaXRlSW5wdXRBdHRyaWJ1dGVzOiBmYWxzZSwgICAgLy8gYWRkcyBIVE1MNSBpbnB1dCB2YWxpZGF0aW9uIGF0dHJpYnV0ZXMgdG8gZm9ybSBlbGVtZW50cyB0aGF0IGtvIG9ic2VydmFibGUncyBhcmUgYm91bmQgdG8NCglkZWNvcmF0ZUlucHV0RWxlbWVudDogZmFsc2UsICAgICAgICAgLy8gZmFsc2UgdG8ga2VlcCBiYWNrd2FyZCBjb21wYXRpYmlsaXR5DQoJZGVjb3JhdGVFbGVtZW50T25Nb2RpZmllZDogdHJ1ZSwvLyB0cnVlIHRvIGtlZXAgYmFja3dhcmQgY29tcGF0aWJpbGl0eQ0KCWVycm9yQ2xhc3M6IG51bGwsICAgICAgICAgICAgICAgLy8gc2luZ2xlIGNsYXNzIGZvciBlcnJvciBtZXNzYWdlIGFuZCBlbGVtZW50DQoJZXJyb3JFbGVtZW50Q2xhc3M6ICd2YWxpZGF0aW9uRWxlbWVudCcsICAvLyBjbGFzcyB0byBkZWNvcmF0ZSBlcnJvciBlbGVtZW50DQoJZXJyb3JNZXNzYWdlQ2xhc3M6ICd2YWxpZGF0aW9uTWVzc2FnZScsICAvLyBjbGFzcyB0byBkZWNvcmF0ZSBlcnJvciBtZXNzYWdlDQoJYWxsb3dIdG1sTWVzc2FnZXM6IGZhbHNlLAkJLy8gYWxsb3dzIEhUTUwgaW4gdmFsaWRhdGlvbiBtZXNzYWdlcw0KCWdyb3VwaW5nOiB7DQoJCWRlZXA6IGZhbHNlLCAgICAgICAgLy9ieSBkZWZhdWx0IGdyb3VwaW5nIGlzIHNoYWxsb3cNCgkJb2JzZXJ2YWJsZTogdHJ1ZSwgICAvL2FuZCB1c2luZyBvYnNlcnZhYmxlcw0KCQlsaXZlOiBmYWxzZQkJICAgIC8vcmVhY3QgdG8gY2hhbmdlcyB0byBvYnNlcnZhYmxlQXJyYXlzIGlmIG9ic2VydmFibGUgPT09IHRydWUNCgl9LA0KCXZhbGlkYXRlOiB7DQoJCS8vIHRocm90dGxlOiAxMA0KCX0NCn07DQoNCi8vIG1ha2UgYSBjb3B5ICBzbyB3ZSBjYW4gdXNlICdyZXNldCcgbGF0ZXINCnZhciBjb25maWd1cmF0aW9uID0gZXh0ZW5kKHt9LCBkZWZhdWx0cyk7DQoNCmNvbmZpZ3VyYXRpb24uaHRtbDVBdHRyaWJ1dGVzID0gWydyZXF1aXJlZCcsICdwYXR0ZXJuJywgJ21pbicsICdtYXgnLCAnc3RlcCddOw0KY29uZmlndXJhdGlvbi5odG1sNUlucHV0VHlwZXMgPSBbJ2VtYWlsJywgJ251bWJlcicsICdkYXRlJ107DQoNCmNvbmZpZ3VyYXRpb24ucmVzZXQgPSBmdW5jdGlvbiAoKSB7DQoJZXh0ZW5kKGNvbmZpZ3VyYXRpb24sIGRlZmF1bHRzKTsNCn07DQoNCmt2LmNvbmZpZ3VyYXRpb24gPSBjb25maWd1cmF0aW9uOw0KO2t2LnV0aWxzID0gKGZ1bmN0aW9uICgpIHsNCgl2YXIgc2VlZElkID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7DQoNCgl2YXIgZG9tRGF0YSA9IHt9OyAvL2hhc2ggb2YgZGF0YSBvYmplY3RzIHRoYXQgd2UgcmVmZXJlbmNlIGZyb20gZG9tIGVsZW1lbnRzDQoJdmFyIGRvbURhdGFLZXkgPSAnX19rb192YWxpZGF0aW9uX18nOw0KDQoJcmV0dXJuIHsNCgkJaXNBcnJheTogZnVuY3Rpb24gKG8pIHsNCgkJCXJldHVybiBvLmlzQXJyYXkgfHwgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pID09PSAnW29iamVjdCBBcnJheV0nOw0KCQl9LA0KCQlpc09iamVjdDogZnVuY3Rpb24gKG8pIHsNCgkJCXJldHVybiBvICE9PSBudWxsICYmIHR5cGVvZiBvID09PSAnb2JqZWN0JzsNCgkJfSwNCgkJaXNOdW1iZXI6IGZ1bmN0aW9uKG8pIHsNCgkJCXJldHVybiAhaXNOYU4obyk7CQ0KCQl9LA0KCQlpc09ic2VydmFibGVBcnJheTogZnVuY3Rpb24oaW5zdGFuY2UpIHsNCgkJCXJldHVybiAhIWluc3RhbmNlICYmDQoJCQkJCXR5cGVvZiBpbnN0YW5jZVsicmVtb3ZlIl0gPT09ICJmdW5jdGlvbiIgJiYNCgkJCQkJdHlwZW9mIGluc3RhbmNlWyJyZW1vdmVBbGwiXSA9PT0gImZ1bmN0aW9uIiAmJg0KCQkJCQl0eXBlb2YgaW5zdGFuY2VbImRlc3Ryb3kiXSA9PT0gImZ1bmN0aW9uIiAmJg0KCQkJCQl0eXBlb2YgaW5zdGFuY2VbImRlc3Ryb3lBbGwiXSA9PT0gImZ1bmN0aW9uIiAmJg0KCQkJCQl0eXBlb2YgaW5zdGFuY2VbImluZGV4T2YiXSA9PT0gImZ1bmN0aW9uIiAmJg0KCQkJCQl0eXBlb2YgaW5zdGFuY2VbInJlcGxhY2UiXSA9PT0gImZ1bmN0aW9uIjsNCgkJfSwNCgkJdmFsdWVzOiBmdW5jdGlvbiAobykgew0KCQkJdmFyIHIgPSBbXTsNCgkJCWZvciAodmFyIGkgaW4gbykgew0KCQkJCWlmIChvLmhhc093blByb3BlcnR5KGkpKSB7DQoJCQkJCXIucHVzaChvW2ldKTsNCgkJCQl9DQoJCQl9DQoJCQlyZXR1cm4gcjsNCgkJfSwNCgkJZ2V0VmFsdWU6IGZ1bmN0aW9uIChvKSB7DQoJCQlyZXR1cm4gKHR5cGVvZiBvID09PSAnZnVuY3Rpb24nID8gbygpIDogbyk7DQoJCX0sDQoJCWhhc0F0dHJpYnV0ZTogZnVuY3Rpb24gKG5vZGUsIGF0dHIpIHsNCgkJCXJldHVybiBub2RlLmdldEF0dHJpYnV0ZShhdHRyKSAhPT0gbnVsbDsNCgkJfSwNCgkJZ2V0QXR0cmlidXRlOiBmdW5jdGlvbiAoZWxlbWVudCwgYXR0cikgew0KCQkJcmV0dXJuIGVsZW1lbnQuZ2V0QXR0cmlidXRlKGF0dHIpOw0KCQl9LA0KCQlzZXRBdHRyaWJ1dGU6IGZ1bmN0aW9uIChlbGVtZW50LCBhdHRyLCB2YWx1ZSkgew0KCQkJcmV0dXJuIGVsZW1lbnQuc2V0QXR0cmlidXRlKGF0dHIsIHZhbHVlKTsNCgkJfSwNCgkJaXNWYWxpZGF0YWJsZTogZnVuY3Rpb24gKG8pIHsNCgkJCXJldHVybiAhIShvICYmIG8ucnVsZXMgJiYgby5pc1ZhbGlkICYmIG8uaXNNb2RpZmllZCk7DQoJCX0sDQoJCWluc2VydEFmdGVyOiBmdW5jdGlvbiAobm9kZSwgbmV3Tm9kZSkgew0KCQkJbm9kZS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShuZXdOb2RlLCBub2RlLm5leHRTaWJsaW5nKTsNCgkJfSwNCgkJbmV3SWQ6IGZ1bmN0aW9uICgpIHsNCgkJCXJldHVybiBzZWVkSWQgKz0gMTsNCgkJfSwNCgkJZ2V0Q29uZmlnT3B0aW9uczogZnVuY3Rpb24gKGVsZW1lbnQpIHsNCgkJCXZhciBvcHRpb25zID0ga3YudXRpbHMuY29udGV4dEZvcihlbGVtZW50KTsNCg0KCQkJcmV0dXJuIG9wdGlvbnMgfHwga3YuY29uZmlndXJhdGlvbjsNCgkJfSwNCgkJc2V0RG9tRGF0YTogZnVuY3Rpb24gKG5vZGUsIGRhdGEpIHsNCgkJCXZhciBrZXkgPSBub2RlW2RvbURhdGFLZXldOw0KDQoJCQlpZiAoIWtleSkgew0KCQkJCW5vZGVbZG9tRGF0YUtleV0gPSBrZXkgPSBrdi51dGlscy5uZXdJZCgpOw0KCQkJfQ0KDQoJCQlkb21EYXRhW2tleV0gPSBkYXRhOw0KCQl9LA0KCQlnZXREb21EYXRhOiBmdW5jdGlvbiAobm9kZSkgew0KCQkJdmFyIGtleSA9IG5vZGVbZG9tRGF0YUtleV07DQoNCgkJCWlmICgha2V5KSB7DQoJCQkJcmV0dXJuIHVuZGVmaW5lZDsNCgkJCX0NCg0KCQkJcmV0dXJuIGRvbURhdGFba2V5XTsNCgkJfSwNCgkJY29udGV4dEZvcjogZnVuY3Rpb24gKG5vZGUpIHsNCgkJCXN3aXRjaCAobm9kZS5ub2RlVHlwZSkgew0KCQkJCWNhc2UgMToNCgkJCQljYXNlIDg6DQoJCQkJCXZhciBjb250ZXh0ID0ga3YudXRpbHMuZ2V0RG9tRGF0YShub2RlKTsNCgkJCQkJaWYgKGNvbnRleHQpIHsgcmV0dXJuIGNvbnRleHQ7IH0NCgkJCQkJaWYgKG5vZGUucGFyZW50Tm9kZSkgeyByZXR1cm4ga3YudXRpbHMuY29udGV4dEZvcihub2RlLnBhcmVudE5vZGUpOyB9DQoJCQkJCWJyZWFrOw0KCQkJfQ0KCQkJcmV0dXJuIHVuZGVmaW5lZDsNCgkJfSwNCgkJaXNFbXB0eVZhbDogZnVuY3Rpb24gKHZhbCkgew0KCQkJaWYgKHZhbCA9PT0gdW5kZWZpbmVkKSB7DQoJCQkJcmV0dXJuIHRydWU7DQoJCQl9DQoJCQlpZiAodmFsID09PSBudWxsKSB7DQoJCQkJcmV0dXJuIHRydWU7DQoJCQl9DQoJCQlpZiAodmFsID09PSAiIikgew0KCQkJCXJldHVybiB0cnVlOw0KCQkJfQ0KCQl9LA0KCQlnZXRPcmlnaW5hbEVsZW1lbnRUaXRsZTogZnVuY3Rpb24gKGVsZW1lbnQpIHsNCgkJCXZhciBzYXZlZE9yaWdpbmFsVGl0bGUgPSBrdi51dGlscy5nZXRBdHRyaWJ1dGUoZWxlbWVudCwgJ2RhdGEtb3JpZy10aXRsZScpLA0KCQkJCWN1cnJlbnRUaXRsZSA9IGVsZW1lbnQudGl0bGUsDQoJCQkJaGFzU2F2ZWRPcmlnaW5hbFRpdGxlID0ga3YudXRpbHMuaGFzQXR0cmlidXRlKGVsZW1lbnQsICdkYXRhLW9yaWctdGl0bGUnKTsNCg0KCQkJcmV0dXJuIGhhc1NhdmVkT3JpZ2luYWxUaXRsZSA/DQoJCQkJc2F2ZWRPcmlnaW5hbFRpdGxlIDogY3VycmVudFRpdGxlOw0KCQl9LA0KCQlhc3luYzogZnVuY3Rpb24gKGV4cHIpIHsNCgkJCWlmICh3aW5kb3cuc2V0SW1tZWRpYXRlKSB7IHdpbmRvdy5zZXRJbW1lZGlhdGUoZXhwcik7IH0NCgkJCWVsc2UgeyB3aW5kb3cuc2V0VGltZW91dChleHByLCAwKTsgfQ0KCQl9LA0KCQlmb3JFYWNoOiBmdW5jdGlvbiAob2JqZWN0LCBjYWxsYmFjaykgew0KCQkJaWYgKGt2LnV0aWxzLmlzQXJyYXkob2JqZWN0KSkgew0KCQkJCXJldHVybiBmb3JFYWNoKG9iamVjdCwgY2FsbGJhY2spOw0KCQkJfQ0KCQkJZm9yICh2YXIgcHJvcCBpbiBvYmplY3QpIHsNCgkJCQlpZiAob2JqZWN0Lmhhc093blByb3BlcnR5KHByb3ApKSB7DQoJCQkJCWNhbGxiYWNrKG9iamVjdFtwcm9wXSwgcHJvcCk7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJfTsNCn0oKSk7O3ZhciBhcGkgPSAoZnVuY3Rpb24gKCkgew0KDQoJdmFyIGlzSW5pdGlhbGl6ZWQgPSAwLA0KCQljb25maWd1cmF0aW9uID0ga3YuY29uZmlndXJhdGlvbiwNCgkJdXRpbHMgPSBrdi51dGlsczsNCg0KCWZ1bmN0aW9uIGNsZWFuVXBTdWJzY3JpcHRpb25zKGNvbnRleHQpIHsNCgkJZm9yRWFjaChjb250ZXh0LnN1YnNjcmlwdGlvbnMsIGZ1bmN0aW9uIChzdWJzY3JpcHRpb24pIHsNCgkJCXN1YnNjcmlwdGlvbi5kaXNwb3NlKCk7DQoJCX0pOw0KCQljb250ZXh0LnN1YnNjcmlwdGlvbnMgPSBbXTsNCgl9DQoNCglmdW5jdGlvbiBkaXNwb3NlKGNvbnRleHQpIHsNCgkJaWYgKGNvbnRleHQub3B0aW9ucy5kZWVwKSB7DQoJCQlmb3JFYWNoKGNvbnRleHQuZmxhZ2dlZCwgZnVuY3Rpb24gKG9iaikgew0KCQkJCWRlbGV0ZSBvYmouX19rdl90cmF2ZXJzZWQ7DQoJCQl9KTsNCgkJCWNvbnRleHQuZmxhZ2dlZC5sZW5ndGggPSAwOw0KCQl9DQoNCgkJaWYgKCFjb250ZXh0Lm9wdGlvbnMubGl2ZSkgew0KCQkJY2xlYW5VcFN1YnNjcmlwdGlvbnMoY29udGV4dCk7DQoJCX0NCgl9DQoNCglmdW5jdGlvbiBydW5UcmF2ZXJzYWwob2JqLCBjb250ZXh0KSB7DQoJCWNvbnRleHQudmFsaWRhdGFibGVzID0gW107DQoJCWNsZWFuVXBTdWJzY3JpcHRpb25zKGNvbnRleHQpOw0KCQl0cmF2ZXJzZUdyYXBoKG9iaiwgY29udGV4dCk7DQoJCWRpc3Bvc2UoY29udGV4dCk7DQoJfQ0KDQoJZnVuY3Rpb24gdHJhdmVyc2VHcmFwaChvYmosIGNvbnRleHQsIGxldmVsKSB7DQoJCXZhciBvYmpWYWx1ZXMgPSBbXSwNCgkJCXZhbCA9IG9iai5wZWVrID8gb2JqLnBlZWsoKSA6IG9iajsNCg0KCQlpZiAob2JqLl9fa3ZfdHJhdmVyc2VkID09PSB0cnVlKSB7DQoJCQlyZXR1cm47DQoJCX0NCg0KCQlpZiAoY29udGV4dC5vcHRpb25zLmRlZXApIHsNCgkJCW9iai5fX2t2X3RyYXZlcnNlZCA9IHRydWU7DQoJCQljb250ZXh0LmZsYWdnZWQucHVzaChvYmopOw0KCQl9DQoNCgkJLy9kZWZhdWx0IGxldmVsIHZhbHVlIGRlcGVuZHMgb24gZGVlcCBvcHRpb24uDQoJCWxldmVsID0gKGxldmVsICE9PSB1bmRlZmluZWQgPyBsZXZlbCA6IGNvbnRleHQub3B0aW9ucy5kZWVwID8gMSA6IC0xKTsNCg0KCQkvLyBpZiBvYmplY3QgaXMgb2JzZXJ2YWJsZSB0aGVuIGFkZCBpdCB0byB0aGUgbGlzdA0KCQlpZiAoa28uaXNPYnNlcnZhYmxlKG9iaikpIHsNCgkJCS8vIGVuc3VyZSBpdCdzIHZhbGlkYXRhYmxlIGJ1dCBkb24ndCBleHRlbmQgdmFsaWRhdGVkT2JzZXJ2YWJsZSBiZWNhdXNlIGl0DQoJCQkvLyB3b3VsZCBvdmVyd3JpdGUgaXNWYWxpZCBwcm9wZXJ0eS4NCgkJCWlmICghb2JqLmVycm9ycyAmJiAhdXRpbHMuaXNWYWxpZGF0YWJsZShvYmopKSB7DQoJCQkJb2JqLmV4dGVuZCh7IHZhbGlkYXRhYmxlOiB0cnVlIH0pOw0KCQkJfQ0KCQkJY29udGV4dC52YWxpZGF0YWJsZXMucHVzaChvYmopOw0KDQoJCQlpZiAoY29udGV4dC5vcHRpb25zLmxpdmUgJiYgdXRpbHMuaXNPYnNlcnZhYmxlQXJyYXkob2JqKSkgew0KCQkJCWNvbnRleHQuc3Vic2NyaXB0aW9ucy5wdXNoKG9iai5zdWJzY3JpYmUoZnVuY3Rpb24gKCkgew0KCQkJCQljb250ZXh0LmdyYXBoTW9uaXRvci52YWx1ZUhhc011dGF0ZWQoKTsNCgkJCQl9KSk7DQoJCQl9DQoJCX0NCg0KCQkvL2dldCBsaXN0IG9mIHZhbHVlcyBlaXRoZXIgZnJvbSBhcnJheSBvciBvYmplY3QgYnV0IGlnbm9yZSBub24tb2JqZWN0cw0KCQkvLyBhbmQgZGVzdHJveWVkIG9iamVjdHMNCgkJaWYgKHZhbCAmJiAhdmFsLl9kZXN0cm95KSB7DQoJCQlpZiAodXRpbHMuaXNBcnJheSh2YWwpKSB7DQoJCQkJb2JqVmFsdWVzID0gdmFsOw0KCQkJfQ0KCQkJZWxzZSBpZiAodXRpbHMuaXNPYmplY3QodmFsKSkgew0KCQkJCW9ialZhbHVlcyA9IHV0aWxzLnZhbHVlcyh2YWwpOw0KCQkJfQ0KCQl9DQoNCgkJLy9wcm9jZXNzIHJlY3Vyc2l2ZWx5IGlmIGl0IGlzIGRlZXAgZ3JvdXBpbmcNCgkJaWYgKGxldmVsICE9PSAwKSB7DQoJCQl1dGlscy5mb3JFYWNoKG9ialZhbHVlcywgZnVuY3Rpb24gKG9ic2VydmFibGUpIHsNCgkJCQkvL2J1dCBub3QgZmFsc3kgdGhpbmdzIGFuZCBub3QgSFRNTCBFbGVtZW50cw0KCQkJCWlmIChvYnNlcnZhYmxlICYmICFvYnNlcnZhYmxlLm5vZGVUeXBlICYmICgha28uaXNDb21wdXRlZChvYnNlcnZhYmxlKSB8fCBvYnNlcnZhYmxlLnJ1bGVzKSkgew0KCQkJCQl0cmF2ZXJzZUdyYXBoKG9ic2VydmFibGUsIGNvbnRleHQsIGxldmVsICsgMSk7DQoJCQkJfQ0KCQkJfSk7DQoJCX0NCgl9DQoNCglmdW5jdGlvbiBjb2xsZWN0RXJyb3JzKGFycmF5KSB7DQoJCXZhciBlcnJvcnMgPSBbXTsNCgkJZm9yRWFjaChhcnJheSwgZnVuY3Rpb24gKG9ic2VydmFibGUpIHsNCgkJCS8vIERvIG5vdCBjb2xsZWN0IHZhbGlkYXRlZE9ic2VydmFibGUgZXJyb3JzDQoJCQlpZiAodXRpbHMuaXNWYWxpZGF0YWJsZShvYnNlcnZhYmxlKSAmJiAhb2JzZXJ2YWJsZS5pc1ZhbGlkKCkpIHsNCgkJCQkvLyBVc2UgcGVlayBiZWNhdXNlIHdlIGRvbid0IHdhbnQgYSBkZXBlbmRlbmN5IGZvciAnZXJyb3InIHByb3BlcnR5IGJlY2F1c2UgaXQNCgkJCQkvLyBjaGFuZ2VzIGJlZm9yZSAnaXNWYWxpZCcgZG9lcy4gKElzc3VlICM5OSkNCgkJCQllcnJvcnMucHVzaChvYnNlcnZhYmxlLmVycm9yLnBlZWsoKSk7DQoJCQl9DQoJCX0pOw0KCQlyZXR1cm4gZXJyb3JzOw0KCX0NCg0KCXJldHVybiB7DQoJCS8vQ2FsbCB0aGlzIG9uIHN0YXJ0dXANCgkJLy9hbnkgY29uZmlnIGNhbiBiZSBvdmVycmlkZGVuIHdpdGggdGhlIHBhc3NlZCBpbiBvcHRpb25zDQoJCWluaXQ6IGZ1bmN0aW9uIChvcHRpb25zLCBmb3JjZSkgew0KCQkJLy9kb25lIHJ1biB0aGlzIG11bHRpcGxlIHRpbWVzIGlmIHdlIGRvbid0IHJlYWxseSB3YW50IHRvDQoJCQlpZiAoaXNJbml0aWFsaXplZCA+IDAgJiYgIWZvcmNlKSB7DQoJCQkJcmV0dXJuOw0KCQkJfQ0KDQoJCQkvL2JlY2F1c2Ugd2Ugd2lsbCBiZSBhY2Nlc3Npbmcgb3B0aW9ucyBwcm9wZXJ0aWVzIGl0IGhhcyB0byBiZSBhbiBvYmplY3QgYXQgbGVhc3QNCgkJCW9wdGlvbnMgPSBvcHRpb25zIHx8IHt9Ow0KCQkJLy9pZiBzcGVjaWZpYyBlcnJvciBjbGFzc2VzIGFyZSBub3QgcHJvdmlkZWQgdGhlbiBhcHBseSBnZW5lcmljIGVycm9yQ2xhc3MNCgkJCS8vaXQgaGFzIHRvIGJlIGRvbmUgb24gb3B0aW9uIHNvIHRoYXQgb3B0aW9ucy5lcnJvckNsYXNzIGNhbiBvdmVycmlkZSBkZWZhdWx0DQoJCQkvL2Vycm9yRWxlbWVudENsYXNzIGFuZCBlcnJvck1lc3NhZ2UgY2xhc3MgYnV0IG5vdCB0aG9zZSBwcm92aWRlZCBpbiBvcHRpb25zDQoJCQlvcHRpb25zLmVycm9yRWxlbWVudENsYXNzID0gb3B0aW9ucy5lcnJvckVsZW1lbnRDbGFzcyB8fCBvcHRpb25zLmVycm9yQ2xhc3MgfHwgY29uZmlndXJhdGlvbi5lcnJvckVsZW1lbnRDbGFzczsNCgkJCW9wdGlvbnMuZXJyb3JNZXNzYWdlQ2xhc3MgPSBvcHRpb25zLmVycm9yTWVzc2FnZUNsYXNzIHx8IG9wdGlvbnMuZXJyb3JDbGFzcyB8fCBjb25maWd1cmF0aW9uLmVycm9yTWVzc2FnZUNsYXNzOw0KDQoJCQlleHRlbmQoY29uZmlndXJhdGlvbiwgb3B0aW9ucyk7DQoNCgkJCWlmIChjb25maWd1cmF0aW9uLnJlZ2lzdGVyRXh0ZW5kZXJzKSB7DQoJCQkJa3YucmVnaXN0ZXJFeHRlbmRlcnMoKTsNCgkJCX0NCg0KCQkJaXNJbml0aWFsaXplZCA9IDE7DQoJCX0sDQoNCgkJLy8gcmVzZXRzIHRoZSBjb25maWcgYmFjayB0byBpdHMgb3JpZ2luYWwgc3RhdGUNCgkJcmVzZXQ6IGt2LmNvbmZpZ3VyYXRpb24ucmVzZXQsDQoNCgkJLy8gcmVjdXJzaXZlbHkgd2Fsa3MgYSB2aWV3TW9kZWwgYW5kIGNyZWF0ZXMgYW4gb2JqZWN0IHRoYXQNCgkJLy8gcHJvdmlkZXMgdmFsaWRhdGlvbiBpbmZvcm1hdGlvbiBmb3IgdGhlIGVudGlyZSB2aWV3TW9kZWwNCgkJLy8gb2JqIC0+IHRoZSB2aWV3TW9kZWwgdG8gd2Fsaw0KCQkvLyBvcHRpb25zIC0+IHsNCgkJLy8JICBkZWVwOiBmYWxzZSwgLy8gaWYgdHJ1ZSwgd2lsbCB3YWxrIHBhc3QgdGhlIGZpcnN0IGxldmVsIG9mIHZpZXdNb2RlbCBwcm9wZXJ0aWVzDQoJCS8vCSAgb2JzZXJ2YWJsZTogZmFsc2UgLy8gaWYgdHJ1ZSwgcmV0dXJucyBhIGNvbXB1dGVkIG9ic2VydmFibGUgaW5kaWNhdGluZyBpZiB0aGUgdmlld01vZGVsIGlzIHZhbGlkDQoJCS8vIH0NCgkJZ3JvdXA6IGZ1bmN0aW9uIGdyb3VwKG9iaiwgb3B0aW9ucykgeyAvLyBhcnJheSBvZiBvYnNlcnZhYmxlcyBvciB2aWV3TW9kZWwNCgkJCW9wdGlvbnMgPSBleHRlbmQoZXh0ZW5kKHt9LCBjb25maWd1cmF0aW9uLmdyb3VwaW5nKSwgb3B0aW9ucyk7DQoNCgkJCXZhciBjb250ZXh0ID0gew0KCQkJCW9wdGlvbnM6IG9wdGlvbnMsDQoJCQkJZ3JhcGhNb25pdG9yOiBrby5vYnNlcnZhYmxlKCksDQoJCQkJZmxhZ2dlZDogW10sDQoJCQkJc3Vic2NyaXB0aW9uczogW10sDQoJCQkJdmFsaWRhdGFibGVzOiBbXQ0KCQkJfTsNCg0KCQkJdmFyIHJlc3VsdCA9IG51bGw7DQoNCgkJCS8vaWYgdXNpbmcgb2JzZXJ2YWJsZXMgdGhlbiB0cmF2ZXJzZSBzdHJ1Y3R1cmUgb25jZSBhbmQgYWRkIG9ic2VydmFibGVzDQoJCQlpZiAob3B0aW9ucy5vYnNlcnZhYmxlKSB7DQoJCQkJcmVzdWx0ID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkgew0KCQkJCQljb250ZXh0LmdyYXBoTW9uaXRvcigpOyAvL3JlZ2lzdGVyIGRlcGVuZGVuY3kNCgkJCQkJcnVuVHJhdmVyc2FsKG9iaiwgY29udGV4dCk7DQoJCQkJCXJldHVybiBjb2xsZWN0RXJyb3JzKGNvbnRleHQudmFsaWRhdGFibGVzKTsNCgkJCQl9KTsNCgkJCX0NCgkJCWVsc2UgeyAvL2lmIG5vdCB1c2luZyBvYnNlcnZhYmxlcyB0aGVuIGV2ZXJ5IGNhbGwgdG8gZXJyb3IoKSBzaG91bGQgdHJhdmVyc2UgdGhlIHN0cnVjdHVyZQ0KCQkJCXJlc3VsdCA9IGZ1bmN0aW9uICgpIHsNCgkJCQkJcnVuVHJhdmVyc2FsKG9iaiwgY29udGV4dCk7DQoJCQkJCXJldHVybiBjb2xsZWN0RXJyb3JzKGNvbnRleHQudmFsaWRhdGFibGVzKTsNCgkJCQl9Ow0KCQkJfQ0KDQoJCQlyZXN1bHQuc2hvd0FsbE1lc3NhZ2VzID0gZnVuY3Rpb24gKHNob3cpIHsgLy8gdGhhbmtzIEBoZWxpb3NQb3J0YWwNCgkJCQlpZiAoc2hvdyA9PT0gdW5kZWZpbmVkKSB7Ly9kZWZhdWx0IHRvIHRydWUNCgkJCQkJc2hvdyA9IHRydWU7DQoJCQkJfQ0KDQoJCQkJcmVzdWx0LmZvckVhY2goZnVuY3Rpb24gKG9ic2VydmFibGUpIHsNCgkJCQkJaWYgKHV0aWxzLmlzVmFsaWRhdGFibGUob2JzZXJ2YWJsZSkpIHsNCgkJCQkJCW9ic2VydmFibGUuaXNNb2RpZmllZChzaG93KTsNCgkJCQkJfQ0KCQkJCX0pOw0KCQkJfTsNCg0KCQkJcmVzdWx0LmlzQW55TWVzc2FnZVNob3duID0gZnVuY3Rpb24gKCkgew0KCQkJCXZhciBpbnZhbGlkQW5kTW9kaWZpZWRQcmVzZW50Ow0KDQoJCQkJaW52YWxpZEFuZE1vZGlmaWVkUHJlc2VudCA9ICEhcmVzdWx0LmZpbmQoZnVuY3Rpb24gKG9ic2VydmFibGUpIHsNCgkJCQkJcmV0dXJuIHV0aWxzLmlzVmFsaWRhdGFibGUob2JzZXJ2YWJsZSkgJiYgIW9ic2VydmFibGUuaXNWYWxpZCgpICYmIG9ic2VydmFibGUuaXNNb2RpZmllZCgpOw0KCQkJCX0pOw0KCQkJCXJldHVybiBpbnZhbGlkQW5kTW9kaWZpZWRQcmVzZW50Ow0KCQkJfTsNCg0KCQkJcmVzdWx0LmZpbHRlciA9IGZ1bmN0aW9uKHByZWRpY2F0ZSkgew0KCQkJCXByZWRpY2F0ZSA9IHByZWRpY2F0ZSB8fCBmdW5jdGlvbiAoKSB7IHJldHVybiB0cnVlOyB9Ow0KCQkJCS8vIGVuc3VyZSB3ZSBoYXZlIGxhdGVzdCBjaGFuZ2VzDQoJCQkJcmVzdWx0KCk7DQoNCgkJCQlyZXR1cm4ga29VdGlscy5hcnJheUZpbHRlcihjb250ZXh0LnZhbGlkYXRhYmxlcywgcHJlZGljYXRlKTsNCgkJCX07DQoNCgkJCXJlc3VsdC5maW5kID0gZnVuY3Rpb24ocHJlZGljYXRlKSB7DQoJCQkJcHJlZGljYXRlID0gcHJlZGljYXRlIHx8IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRydWU7IH07DQoJCQkJLy8gZW5zdXJlIHdlIGhhdmUgbGF0ZXN0IGNoYW5nZXMNCgkJCQlyZXN1bHQoKTsNCg0KCQkJCXJldHVybiBrb1V0aWxzLmFycmF5Rmlyc3QoY29udGV4dC52YWxpZGF0YWJsZXMsIHByZWRpY2F0ZSk7DQoJCQl9Ow0KDQoJCQlyZXN1bHQuZm9yRWFjaCA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7DQoJCQkJY2FsbGJhY2sgPSBjYWxsYmFjayB8fCBmdW5jdGlvbiAoKSB7IH07DQoJCQkJLy8gZW5zdXJlIHdlIGhhdmUgbGF0ZXN0IGNoYW5nZXMNCgkJCQlyZXN1bHQoKTsNCg0KCQkJCWZvckVhY2goY29udGV4dC52YWxpZGF0YWJsZXMsIGNhbGxiYWNrKTsNCgkJCX07DQoNCgkJCXJlc3VsdC5tYXAgPSBmdW5jdGlvbihtYXBwaW5nKSB7DQoJCQkJbWFwcGluZyA9IG1hcHBpbmcgfHwgZnVuY3Rpb24gKGl0ZW0pIHsgcmV0dXJuIGl0ZW07IH07DQoJCQkJLy8gZW5zdXJlIHdlIGhhdmUgbGF0ZXN0IGNoYW5nZXMNCgkJCQlyZXN1bHQoKTsNCg0KCQkJCXJldHVybiBrb1V0aWxzLmFycmF5TWFwKGNvbnRleHQudmFsaWRhdGFibGVzLCBtYXBwaW5nKTsNCgkJCX07DQoNCgkJCS8qKg0KCQkJICogQHByaXZhdGUgWW91IHNob3VsZCBub3QgcmVseSBvbiB0aGlzIG1ldGhvZCBiZWluZyBoZXJlLg0KCQkJICogSXQncyBhIHByaXZhdGUgbWV0aG9kIGFuZCBpdCBtYXkgY2hhbmdlIGluIHRoZSBmdXR1cmUuDQoJCQkgKg0KCQkJICogQGRlc2NyaXB0aW9uIFVwZGF0ZXMgdGhlIHZhbGlkYXRlZCBvYmplY3QgYW5kIGNvbGxlY3RzIGVycm9ycyBmcm9tIGl0Lg0KCQkJICovDQoJCQlyZXN1bHQuX3VwZGF0ZVN0YXRlID0gZnVuY3Rpb24obmV3VmFsdWUpIHsNCgkJCQlpZiAoIXV0aWxzLmlzT2JqZWN0KG5ld1ZhbHVlKSkgew0KCQkJCQl0aHJvdyBuZXcgRXJyb3IoJ0FuIG9iamVjdCBpcyByZXF1aXJlZC4nKTsNCgkJCQl9DQoJCQkJb2JqID0gbmV3VmFsdWU7DQoJCQkJaWYgKG9wdGlvbnMub2JzZXJ2YWJsZSkgew0KCQkJCQljb250ZXh0LmdyYXBoTW9uaXRvci52YWx1ZUhhc011dGF0ZWQoKTsNCgkJCQl9DQoJCQkJZWxzZSB7DQoJCQkJCXJ1blRyYXZlcnNhbChuZXdWYWx1ZSwgY29udGV4dCk7DQoJCQkJCXJldHVybiBjb2xsZWN0RXJyb3JzKGNvbnRleHQudmFsaWRhdGFibGVzKTsNCgkJCQl9DQoJCQl9Ow0KCQkJcmV0dXJuIHJlc3VsdDsNCgkJfSwNCg0KCQlmb3JtYXRNZXNzYWdlOiBmdW5jdGlvbiAobWVzc2FnZSwgcGFyYW1zLCBvYnNlcnZhYmxlKSB7DQoJCQlpZiAodXRpbHMuaXNPYmplY3QocGFyYW1zKSAmJiBwYXJhbXMudHlwZUF0dHIpIHsNCgkJCQlwYXJhbXMgPSBwYXJhbXMudmFsdWU7DQoJCQl9DQoJCQlpZiAodHlwZW9mIChtZXNzYWdlKSA9PT0gJ2Z1bmN0aW9uJykgew0KCQkJCXJldHVybiBtZXNzYWdlKHBhcmFtcywgb2JzZXJ2YWJsZSk7DQoJCQl9DQoJCQl2YXIgcmVwbGFjZW1lbnRzID0gdW53cmFwKHBhcmFtcykgfHwgW107DQoJCQlpZiAoIXV0aWxzLmlzQXJyYXkocmVwbGFjZW1lbnRzKSkgew0KCQkJCXJlcGxhY2VtZW50cyA9IFtyZXBsYWNlbWVudHNdOw0KCQkJfQ0KCQkJcmV0dXJuIG1lc3NhZ2UucmVwbGFjZSgveyhcZCspfS9naSwgZnVuY3Rpb24obWF0Y2gsIGluZGV4KSB7DQoJCQkJaWYgKHR5cGVvZiByZXBsYWNlbWVudHNbaW5kZXhdICE9PSAndW5kZWZpbmVkJykgew0KCQkJCQlyZXR1cm4gcmVwbGFjZW1lbnRzW2luZGV4XTsNCgkJCQl9DQoJCQkJcmV0dXJuIG1hdGNoOw0KCQkJfSk7DQoJCX0sDQoNCgkJLy8gYWRkUnVsZToNCgkJLy8gVGhpcyB0YWtlcyBpbiBhIGtvLm9ic2VydmFibGUgYW5kIGEgUnVsZSBDb250ZXh0IC0gd2hpY2ggaXMganVzdCBhIHJ1bGUgbmFtZSBhbmQgcGFyYW1zIHRvIHN1cHBseSB0byB0aGUgdmFsaWRhdG9yDQoJCS8vIGllOiBrdi5hZGRSdWxlKG15T2JzZXJ2YWJsZSwgew0KCQkvLwkJICBydWxlOiAncmVxdWlyZWQnLA0KCQkvLwkJICBwYXJhbXM6IHRydWUNCgkJLy8JICB9KTsNCgkJLy8NCgkJYWRkUnVsZTogZnVuY3Rpb24gKG9ic2VydmFibGUsIHJ1bGUpIHsNCgkJCW9ic2VydmFibGUuZXh0ZW5kKHsgdmFsaWRhdGFibGU6IHRydWUgfSk7DQoNCgkJCXZhciBoYXNSdWxlID0gISFrb1V0aWxzLmFycmF5Rmlyc3Qob2JzZXJ2YWJsZS5ydWxlcygpLCBmdW5jdGlvbihpdGVtKSB7DQoJCQkJcmV0dXJuIGl0ZW0ucnVsZSAmJiBpdGVtLnJ1bGUgPT09IHJ1bGUucnVsZTsNCgkJCX0pOw0KDQoJCQlpZiAoIWhhc1J1bGUpIHsNCgkJCQkvL3B1c2ggYSBSdWxlIENvbnRleHQgdG8gdGhlIG9ic2VydmFibGVzIGxvY2FsIGFycmF5IG9mIFJ1bGUgQ29udGV4dHMNCgkJCQlvYnNlcnZhYmxlLnJ1bGVzLnB1c2gocnVsZSk7DQoJCQl9DQoJCQlyZXR1cm4gb2JzZXJ2YWJsZTsNCgkJfSwNCg0KCQkvLyBhZGRBbm9ueW1vdXNSdWxlOg0KCQkvLyBBbm9ueW1vdXMgUnVsZXMgZXNzZW50aWFsbHkgaGF2ZSBhbGwgdGhlIHByb3BlcnRpZXMgb2YgYSBSdWxlLCBidXQgYXJlIG9ubHkgc3BlY2lmaWMgZm9yIGEgY2VydGFpbiBwcm9wZXJ0eQ0KCQkvLyBhbmQgZGV2ZWxvcGVycyB0eXBpY2FsbHkgYXJlIHdhbnRpbmcgdG8gYWRkIHRoZW0gb24gdGhlIGZseSBvciBub3QgcmVnaXN0ZXIgYSBydWxlIHdpdGggdGhlICdrdi5ydWxlcycgb2JqZWN0DQoJCS8vDQoJCS8vIEV4YW1wbGU6DQoJCS8vIHZhciB0ZXN0ID0ga28ub2JzZXJ2YWJsZSgnc29tZXRoaW5nJykuZXh0ZW5keygNCgkJLy8JICB2YWxpZGF0aW9uOiB7DQoJCS8vCQkgIHZhbGlkYXRvcjogZnVuY3Rpb24odmFsLCBzb21lT3RoZXJWYWwpew0KCQkvLwkJCSAgcmV0dXJuIHRydWU7DQoJCS8vCQkgIH0sDQoJCS8vCQkgIG1lc3NhZ2U6ICJTb21ldGhpbmcgbXVzdCBiZSByZWFsbHkgd3JvbmchJywNCgkJLy8JCSAgcGFyYW1zOiB0cnVlDQoJCS8vCSAgfQ0KCQkvLyAgKX07DQoJCWFkZEFub255bW91c1J1bGU6IGZ1bmN0aW9uIChvYnNlcnZhYmxlLCBydWxlT2JqKSB7DQoJCQlpZiAocnVsZU9ialsnbWVzc2FnZSddID09PSB1bmRlZmluZWQpIHsNCgkJCQlydWxlT2JqWydtZXNzYWdlJ10gPSAnRXJyb3InOw0KCQkJfQ0KDQoJCQkvL21ha2Ugc3VyZSBvbmx5SWYgaXMgaG9ub3VyZWQNCgkJCWlmIChydWxlT2JqLm9ubHlJZikgew0KCQkJCXJ1bGVPYmouY29uZGl0aW9uID0gcnVsZU9iai5vbmx5SWY7DQoJCQl9DQoNCgkJCS8vYWRkIHRoZSBhbm9ueW1vdXMgcnVsZSB0byB0aGUgb2JzZXJ2YWJsZQ0KCQkJa3YuYWRkUnVsZShvYnNlcnZhYmxlLCBydWxlT2JqKTsNCgkJfSwNCg0KCQlhZGRFeHRlbmRlcjogZnVuY3Rpb24gKHJ1bGVOYW1lKSB7DQoJCQlrby5leHRlbmRlcnNbcnVsZU5hbWVdID0gZnVuY3Rpb24gKG9ic2VydmFibGUsIHBhcmFtcykgew0KCQkJCS8vcGFyYW1zIGNhbiBjb21lIGluIGEgZmV3IGZsYXZvcnMNCgkJCQkvLyAxLiBKdXN0IHRoZSBwYXJhbXMgdG8gYmUgcGFzc2VkIHRvIHRoZSB2YWxpZGF0b3INCgkJCQkvLyAyLiBBbiBvYmplY3QgY29udGFpbmluZyB0aGUgTWVzc2FnZSB0byBiZSB1c2VkIGFuZCB0aGUgUGFyYW1zIHRvIHBhc3MgdG8gdGhlIHZhbGlkYXRvcg0KCQkJCS8vIDMuIEEgY29uZGl0aW9uIHdoZW4gdGhlIHZhbGlkYXRpb24gcnVsZSB0byBiZSBhcHBsaWVkDQoJCQkJLy8NCgkJCQkvLyBFeGFtcGxlOg0KCQkJCS8vIHZhciB0ZXN0ID0ga28ub2JzZXJ2YWJsZSgzKS5leHRlbmQoew0KCQkJCS8vCSAgbWF4OiB7DQoJCQkJLy8JCSAgbWVzc2FnZTogJ1RoaXMgc3BlY2lhbCBmaWVsZCBoYXMgYSBNYXggb2YgezB9JywNCgkJCQkvLwkJICBwYXJhbXM6IDIsDQoJCQkJLy8JCSAgb25seUlmOiBmdW5jdGlvbigpIHsNCgkJCQkvLwkJCQkJICByZXR1cm4gc3BlY2lhbEZpZWxkLklzVmlzaWJsZSgpOw0KCQkJCS8vCQkJCSAgfQ0KCQkJCS8vCSAgfQ0KCQkJCS8vICApfTsNCgkJCQkvLw0KCQkJCWlmIChwYXJhbXMgJiYgKHBhcmFtcy5tZXNzYWdlIHx8IHBhcmFtcy5vbmx5SWYpKSB7IC8vaWYgaXQgaGFzIGEgbWVzc2FnZSBvciBjb25kaXRpb24gb2JqZWN0LCB0aGVuIGl0cyBhbiBvYmplY3QgbGl0ZXJhbCB0byB1c2UNCgkJCQkJcmV0dXJuIGt2LmFkZFJ1bGUob2JzZXJ2YWJsZSwgew0KCQkJCQkJcnVsZTogcnVsZU5hbWUsDQoJCQkJCQltZXNzYWdlOiBwYXJhbXMubWVzc2FnZSwNCgkJCQkJCXBhcmFtczogdXRpbHMuaXNFbXB0eVZhbChwYXJhbXMucGFyYW1zKSA/IHRydWUgOiBwYXJhbXMucGFyYW1zLA0KCQkJCQkJY29uZGl0aW9uOiBwYXJhbXMub25seUlmDQoJCQkJCX0pOw0KCQkJCX0gZWxzZSB7DQoJCQkJCXJldHVybiBrdi5hZGRSdWxlKG9ic2VydmFibGUsIHsNCgkJCQkJCXJ1bGU6IHJ1bGVOYW1lLA0KCQkJCQkJcGFyYW1zOiBwYXJhbXMNCgkJCQkJfSk7DQoJCQkJfQ0KCQkJfTsNCgkJfSwNCg0KCQkvLyBsb29wcyB0aHJvdWdoIGFsbCBrdi5ydWxlcyBhbmQgYWRkcyB0aGVtIGFzIGV4dGVuZGVycyB0bw0KCQkvLyBrby5leHRlbmRlcnMNCgkJcmVnaXN0ZXJFeHRlbmRlcnM6IGZ1bmN0aW9uICgpIHsgLy8gcm9vdCBleHRlbmRlcnMgb3B0aW9uYWwsIHVzZSAndmFsaWRhdGlvbicgZXh0ZW5kZXIgaWYgd291bGQgY2F1c2UgY29uZmxpY3RzDQoJCQlpZiAoY29uZmlndXJhdGlvbi5yZWdpc3RlckV4dGVuZGVycykgew0KCQkJCWZvciAodmFyIHJ1bGVOYW1lIGluIGt2LnJ1bGVzKSB7DQoJCQkJCWlmIChrdi5ydWxlcy5oYXNPd25Qcm9wZXJ0eShydWxlTmFtZSkpIHsNCgkJCQkJCWlmICgha28uZXh0ZW5kZXJzW3J1bGVOYW1lXSkgew0KCQkJCQkJCWt2LmFkZEV4dGVuZGVyKHJ1bGVOYW1lKTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCgkJfSwNCg0KCQkvL2NyZWF0ZXMgYSBzcGFuIG5leHQgdG8gdGhlIEBlbGVtZW50IHdpdGggdGhlIHNwZWNpZmllZCBlcnJvciBjbGFzcw0KCQlpbnNlcnRWYWxpZGF0aW9uTWVzc2FnZTogZnVuY3Rpb24gKGVsZW1lbnQpIHsNCgkJCXZhciBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnU1BBTicpOw0KCQkJc3Bhbi5jbGFzc05hbWUgPSB1dGlscy5nZXRDb25maWdPcHRpb25zKGVsZW1lbnQpLmVycm9yTWVzc2FnZUNsYXNzOw0KCQkJdXRpbHMuaW5zZXJ0QWZ0ZXIoZWxlbWVudCwgc3Bhbik7DQoJCQlyZXR1cm4gc3BhbjsNCgkJfSwNCg0KCQkvLyBpZiBodG1sLTUgdmFsaWRhdGlvbiBhdHRyaWJ1dGVzIGhhdmUgYmVlbiBzcGVjaWZpZWQsIHRoaXMgcGFyc2VzDQoJCS8vIHRoZSBhdHRyaWJ1dGVzIG9uIEBlbGVtZW50DQoJCXBhcnNlSW5wdXRWYWxpZGF0aW9uQXR0cmlidXRlczogZnVuY3Rpb24gKGVsZW1lbnQsIHZhbHVlQWNjZXNzb3IpIHsNCgkJCWZvckVhY2goa3YuY29uZmlndXJhdGlvbi5odG1sNUF0dHJpYnV0ZXMsIGZ1bmN0aW9uIChhdHRyKSB7DQoJCQkJaWYgKHV0aWxzLmhhc0F0dHJpYnV0ZShlbGVtZW50LCBhdHRyKSkgew0KDQoJCQkJCXZhciBwYXJhbXMgPSBlbGVtZW50LmdldEF0dHJpYnV0ZShhdHRyKSB8fCB0cnVlOw0KDQoJCQkJCWlmIChhdHRyID09PSAnbWluJyB8fCBhdHRyID09PSAnbWF4JykNCgkJCQkJew0KCQkJCQkJLy8gSWYgd2UncmUgdmFsaWRhdGluZyBiYXNlZCBvbiB0aGUgbWluIGFuZCBtYXggYXR0cmlidXRlcywgd2UnbGwNCgkJCQkJCS8vIG5lZWQgdG8ga25vdyB3aGF0IHRoZSAndHlwZScgYXR0cmlidXRlIGlzIHNldCB0bw0KCQkJCQkJdmFyIHR5cGVBdHRyID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ3R5cGUnKTsNCgkJCQkJCWlmICh0eXBlb2YgdHlwZUF0dHIgPT09ICJ1bmRlZmluZWQiIHx8ICF0eXBlQXR0cikNCgkJCQkJCXsNCgkJCQkJCQkvLyBGcm9tIGh0dHA6Ly93d3cudzMub3JnL1RSL2h0bWwtbWFya3VwL2lucHV0Og0KCQkJCQkJCS8vICAgQW4gaW5wdXQgZWxlbWVudCB3aXRoIG5vIHR5cGUgYXR0cmlidXRlIHNwZWNpZmllZCByZXByZXNlbnRzIHRoZQ0KCQkJCQkJCS8vICAgc2FtZSB0aGluZyBhcyBhbiBpbnB1dCBlbGVtZW50IHdpdGggaXRzIHR5cGUgYXR0cmlidXRlIHNldCB0byAidGV4dCIuDQoJCQkJCQkJdHlwZUF0dHIgPSAidGV4dCI7DQoJCQkJCQl9DQoJCQkJCQlwYXJhbXMgPSB7dHlwZUF0dHI6IHR5cGVBdHRyLCB2YWx1ZTogcGFyYW1zfTsNCgkJCQkJfQ0KDQoJCQkJCWt2LmFkZFJ1bGUodmFsdWVBY2Nlc3NvcigpLCB7DQoJCQkJCQlydWxlOiBhdHRyLA0KCQkJCQkJcGFyYW1zOiBwYXJhbXMNCgkJCQkJfSk7DQoJCQkJfQ0KCQkJfSk7DQoNCgkJCXZhciBjdXJyZW50VHlwZSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCd0eXBlJyk7DQoJCQlmb3JFYWNoKGt2LmNvbmZpZ3VyYXRpb24uaHRtbDVJbnB1dFR5cGVzLCBmdW5jdGlvbiAodHlwZSkgew0KCQkJCWlmICh0eXBlID09PSBjdXJyZW50VHlwZSkgew0KCQkJCQlrdi5hZGRSdWxlKHZhbHVlQWNjZXNzb3IoKSwgew0KCQkJCQkJcnVsZTogKHR5cGUgPT09ICdkYXRlJykgPyAnZGF0ZUlTTycgOiB0eXBlLA0KCQkJCQkJcGFyYW1zOiB0cnVlDQoJCQkJCX0pOw0KCQkJCX0NCgkJCX0pOw0KCQl9LA0KDQoJCS8vIHdyaXRlcyBodG1sNSB2YWxpZGF0aW9uIGF0dHJpYnV0ZXMgb24gdGhlIGVsZW1lbnQgcGFzc2VkIGluDQoJCXdyaXRlSW5wdXRWYWxpZGF0aW9uQXR0cmlidXRlczogZnVuY3Rpb24gKGVsZW1lbnQsIHZhbHVlQWNjZXNzb3IpIHsNCgkJCXZhciBvYnNlcnZhYmxlID0gdmFsdWVBY2Nlc3NvcigpOw0KDQoJCQlpZiAoIW9ic2VydmFibGUgfHwgIW9ic2VydmFibGUucnVsZXMpIHsNCgkJCQlyZXR1cm47DQoJCQl9DQoNCgkJCXZhciBjb250ZXh0cyA9IG9ic2VydmFibGUucnVsZXMoKTsgLy8gb2JzZXJ2YWJsZSBhcnJheQ0KDQoJCQkvLyBsb29wIHRocm91Z2ggdGhlIGF0dHJpYnV0ZXMgYW5kIGFkZCB0aGUgaW5mb3JtYXRpb24gbmVlZGVkDQoJCQlmb3JFYWNoKGt2LmNvbmZpZ3VyYXRpb24uaHRtbDVBdHRyaWJ1dGVzLCBmdW5jdGlvbiAoYXR0cikgew0KCQkJCXZhciBjdHggPSBrb1V0aWxzLmFycmF5Rmlyc3QoY29udGV4dHMsIGZ1bmN0aW9uIChjdHgpIHsNCgkJCQkJcmV0dXJuIGN0eC5ydWxlICYmIGN0eC5ydWxlLnRvTG93ZXJDYXNlKCkgPT09IGF0dHIudG9Mb3dlckNhc2UoKTsNCgkJCQl9KTsNCg0KCQkJCWlmICghY3R4KSB7DQoJCQkJCXJldHVybjsNCgkJCQl9DQoNCgkJCQkvLyB3ZSBoYXZlIGEgcnVsZSBtYXRjaGluZyBhIHZhbGlkYXRpb24gYXR0cmlidXRlIGF0IHRoaXMgcG9pbnQNCgkJCQkvLyBzbyBsZXRzIGFkZCBpdCB0byB0aGUgZWxlbWVudCBhbG9uZyB3aXRoIHRoZSBwYXJhbXMNCgkJCQlrby5jb21wdXRlZCh7DQoJCQkJCXJlYWQ6IGZ1bmN0aW9uKCkgew0KCQkJCQkJdmFyIHBhcmFtcyA9IGtvLnVud3JhcChjdHgucGFyYW1zKTsNCg0KCQkJCQkJLy8gd2UgaGF2ZSB0byBkbyBzb21lIHNwZWNpYWwgdGhpbmdzIGZvciB0aGUgcGF0dGVybiB2YWxpZGF0aW9uDQoJCQkJCQlpZiAoY3R4LnJ1bGUgPT09ICJwYXR0ZXJuIiAmJiBwYXJhbXMgaW5zdGFuY2VvZiBSZWdFeHApIHsNCgkJCQkJCQkvLyB3ZSBuZWVkIHRoZSBwdXJlIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgUmVnRXhwciB3aXRob3V0IHRoZSAvL2dpIHN0dWZmDQoJCQkJCQkJcGFyYW1zID0gcGFyYW1zLnNvdXJjZTsNCgkJCQkJCX0NCg0KCQkJCQkJZWxlbWVudC5zZXRBdHRyaWJ1dGUoYXR0ciwgcGFyYW1zKTsNCgkJCQkJfSwNCgkJCQkJZGlzcG9zZVdoZW5Ob2RlSXNSZW1vdmVkOiBlbGVtZW50DQoJCQkJfSk7DQoJCQl9KTsNCg0KCQkJY29udGV4dHMgPSBudWxsOw0KCQl9LA0KDQoJCS8vdGFrZSBhbiBleGlzdGluZyBiaW5kaW5nIGhhbmRsZXIgYW5kIG1ha2UgaXQgY2F1c2UgYXV0b21hdGljIHZhbGlkYXRpb25zDQoJCW1ha2VCaW5kaW5nSGFuZGxlclZhbGlkYXRhYmxlOiBmdW5jdGlvbiAoaGFuZGxlck5hbWUpIHsNCgkJCXZhciBpbml0ID0ga28uYmluZGluZ0hhbmRsZXJzW2hhbmRsZXJOYW1lXS5pbml0Ow0KDQoJCQlrby5iaW5kaW5nSGFuZGxlcnNbaGFuZGxlck5hbWVdLmluaXQgPSBmdW5jdGlvbiAoZWxlbWVudCwgdmFsdWVBY2Nlc3NvciwgYWxsQmluZGluZ3NBY2Nlc3Nvciwgdmlld01vZGVsLCBiaW5kaW5nQ29udGV4dCkgew0KDQoJCQkJaW5pdChlbGVtZW50LCB2YWx1ZUFjY2Vzc29yLCBhbGxCaW5kaW5nc0FjY2Vzc29yLCB2aWV3TW9kZWwsIGJpbmRpbmdDb250ZXh0KTsNCg0KCQkJCXJldHVybiBrby5iaW5kaW5nSGFuZGxlcnNbJ3ZhbGlkYXRpb25Db3JlJ10uaW5pdChlbGVtZW50LCB2YWx1ZUFjY2Vzc29yLCBhbGxCaW5kaW5nc0FjY2Vzc29yLCB2aWV3TW9kZWwsIGJpbmRpbmdDb250ZXh0KTsNCgkJCX07DQoJCX0sDQoNCgkJLy8gdmlzaXQgYW4gb2JqZWN0cyBwcm9wZXJ0aWVzIGFuZCBhcHBseSB2YWxpZGF0aW9uIHJ1bGVzIGZyb20gYSBkZWZpbml0aW9uDQoJCXNldFJ1bGVzOiBmdW5jdGlvbiAodGFyZ2V0LCBkZWZpbml0aW9uKSB7DQoJCQl2YXIgc2V0UnVsZXMgPSBmdW5jdGlvbiAodGFyZ2V0LCBkZWZpbml0aW9uKSB7DQoJCQkJaWYgKCF0YXJnZXQgfHwgIWRlZmluaXRpb24pIHsgcmV0dXJuOyB9DQoNCgkJCQlmb3IgKHZhciBwcm9wIGluIGRlZmluaXRpb24pIHsNCgkJCQkJaWYgKCFkZWZpbml0aW9uLmhhc093blByb3BlcnR5KHByb3ApKSB7IGNvbnRpbnVlOyB9DQoJCQkJCXZhciBydWxlRGVmaW5pdGlvbnMgPSBkZWZpbml0aW9uW3Byb3BdOw0KDQoJCQkJCS8vY2hlY2sgdGhlIHRhcmdldCBwcm9wZXJ0eSBleGlzdHMgYW5kIGhhcyBhIHZhbHVlDQoJCQkJCWlmICghdGFyZ2V0W3Byb3BdKSB7IGNvbnRpbnVlOyB9DQoJCQkJCXZhciB0YXJnZXRWYWx1ZSA9IHRhcmdldFtwcm9wXSwNCgkJCQkJCXVud3JhcHBlZFRhcmdldFZhbHVlID0gdW53cmFwKHRhcmdldFZhbHVlKSwNCgkJCQkJCXJ1bGVzID0ge30sDQoJCQkJCQlub25SdWxlcyA9IHt9Ow0KDQoJCQkJCWZvciAodmFyIHJ1bGUgaW4gcnVsZURlZmluaXRpb25zKSB7DQoJCQkJCQlpZiAoIXJ1bGVEZWZpbml0aW9ucy5oYXNPd25Qcm9wZXJ0eShydWxlKSkgeyBjb250aW51ZTsgfQ0KCQkJCQkJaWYgKGt2LnJ1bGVzW3J1bGVdKSB7DQoJCQkJCQkJcnVsZXNbcnVsZV0gPSBydWxlRGVmaW5pdGlvbnNbcnVsZV07DQoJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCW5vblJ1bGVzW3J1bGVdID0gcnVsZURlZmluaXRpb25zW3J1bGVdOw0KCQkJCQkJfQ0KCQkJCQl9DQoNCgkJCQkJLy9hcHBseSBydWxlcw0KCQkJCQlpZiAoa28uaXNPYnNlcnZhYmxlKHRhcmdldFZhbHVlKSkgew0KCQkJCQkJdGFyZ2V0VmFsdWUuZXh0ZW5kKHJ1bGVzKTsNCgkJCQkJfQ0KDQoJCQkJCS8vdGhlbiBhcHBseSBjaGlsZCBydWxlcw0KCQkJCQkvL2lmIGl0J3MgYW4gYXJyYXksIGFwcGx5IHJ1bGVzIHRvIGFsbCBjaGlsZHJlbg0KCQkJCQlpZiAodW53cmFwcGVkVGFyZ2V0VmFsdWUgJiYgdXRpbHMuaXNBcnJheSh1bndyYXBwZWRUYXJnZXRWYWx1ZSkpIHsNCgkJCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgdW53cmFwcGVkVGFyZ2V0VmFsdWUubGVuZ3RoOyBpKyspIHsNCgkJCQkJCQlzZXRSdWxlcyh1bndyYXBwZWRUYXJnZXRWYWx1ZVtpXSwgbm9uUnVsZXMpOw0KCQkJCQkJfQ0KCQkJCQkJLy9vdGhlcndpc2UsIGp1c3QgYXBwbHkgdG8gdGhpcyBwcm9wZXJ0eQ0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJc2V0UnVsZXModW53cmFwcGVkVGFyZ2V0VmFsdWUsIG5vblJ1bGVzKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX07DQoJCQlzZXRSdWxlcyh0YXJnZXQsIGRlZmluaXRpb24pOw0KCQl9DQoJfTsNCg0KfSgpKTsNCg0KLy8gZXhwb3NlIGFwaSBwdWJsaWNseQ0KZXh0ZW5kKGtvLnZhbGlkYXRpb24sIGFwaSk7DQo7Ly9WYWxpZGF0aW9uIFJ1bGVzOg0KLy8gWW91IGNhbiB2aWV3IGFuZCBvdmVycmlkZSBtZXNzYWdlcyBvciBydWxlcyB2aWE6DQovLyBrdi5ydWxlc1tydWxlTmFtZV0NCi8vDQovLyBUbyBpbXBsZW1lbnQgYSBjdXN0b20gUnVsZSwgc2ltcGx5IHVzZSB0aGlzIHRlbXBsYXRlOg0KLy8ga3YucnVsZXNbJzxjdXN0b20gcnVsZSBuYW1lPiddID0gew0KLy8gICAgICB2YWxpZGF0b3I6IGZ1bmN0aW9uICh2YWwsIHBhcmFtKSB7DQovLyAgICAgICAgICA8Y3VzdG9tIGxvZ2ljPg0KLy8gICAgICAgICAgcmV0dXJuIDx0cnVlIG9yIGZhbHNlPjsNCi8vICAgICAgfSwNCi8vICAgICAgbWVzc2FnZTogJzxjdXN0b20gdmFsaWRhdGlvbiBtZXNzYWdlPicgLy9vcHRpb25hbGx5IHlvdSBjYW4gYWxzbyB1c2UgYSAnezB9JyB0byBkZW5vdGUgYSBwbGFjZWhvbGRlciB0aGF0IHdpbGwgYmUgcmVwbGFjZWQgd2l0aCB5b3VyICdwYXJhbScNCi8vIH07DQovLw0KLy8gRXhhbXBsZToNCi8vIGt2LnJ1bGVzWydtdXN0RXF1YWwnXSA9IHsNCi8vICAgICAgdmFsaWRhdG9yOiBmdW5jdGlvbiggdmFsLCBtdXN0RXF1YWxWYWwgKXsNCi8vICAgICAgICAgIHJldHVybiB2YWwgPT09IG11c3RFcXVhbFZhbDsNCi8vICAgICAgfSwNCi8vICAgICAgbWVzc2FnZTogJ1RoaXMgZmllbGQgbXVzdCBlcXVhbCB7MH0nDQovLyB9Ow0KLy8NCmt2LnJ1bGVzID0ge307DQprdi5ydWxlc1sncmVxdWlyZWQnXSA9IHsNCgl2YWxpZGF0b3I6IGZ1bmN0aW9uICh2YWwsIHJlcXVpcmVkKSB7DQoJCXZhciB0ZXN0VmFsOw0KDQoJCWlmICh2YWwgPT09IHVuZGVmaW5lZCB8fCB2YWwgPT09IG51bGwpIHsNCgkJCXJldHVybiAhcmVxdWlyZWQ7DQoJCX0NCg0KCQl0ZXN0VmFsID0gdmFsOw0KCQlpZiAodHlwZW9mICh2YWwpID09PSAnc3RyaW5nJykgew0KCQkJaWYgKFN0cmluZy5wcm90b3R5cGUudHJpbSkgew0KCQkJCXRlc3RWYWwgPSB2YWwudHJpbSgpOw0KCQkJfQ0KCQkJZWxzZSB7DQoJCQkJdGVzdFZhbCA9IHZhbC5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpOw0KCQkJfQ0KCQl9DQoNCgkJaWYgKCFyZXF1aXJlZCkgey8vIGlmIHRoZXkgcGFzc2VkOiB7IHJlcXVpcmVkOiBmYWxzZSB9LCB0aGVuIGRvbid0IHJlcXVpcmUgdGhpcw0KCQkJcmV0dXJuIHRydWU7DQoJCX0NCg0KCQlyZXR1cm4gKCh0ZXN0VmFsICsgJycpLmxlbmd0aCA+IDApOw0KCX0sDQoJbWVzc2FnZTogJ1RoaXMgZmllbGQgaXMgcmVxdWlyZWQuJw0KfTsNCg0KZnVuY3Rpb24gbWluTWF4VmFsaWRhdG9yRmFjdG9yeSh2YWxpZGF0b3JOYW1lKSB7DQogICAgdmFyIGlzTWF4VmFsaWRhdGlvbiA9IHZhbGlkYXRvck5hbWUgPT09ICJtYXgiOw0KDQogICAgcmV0dXJuIGZ1bmN0aW9uICh2YWwsIG9wdGlvbnMpIHsNCiAgICAgICAgaWYgKGt2LnV0aWxzLmlzRW1wdHlWYWwodmFsKSkgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCg0KICAgICAgICB2YXIgY29tcGFyaXNvblZhbHVlLCB0eXBlOw0KICAgICAgICBpZiAob3B0aW9ucy50eXBlQXR0ciA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAvLyBUaGlzIHZhbGlkYXRvciBpcyBiZWluZyBjYWxsZWQgZnJvbSBqYXZhc2NyaXB0IHJhdGhlciB0aGFuDQogICAgICAgICAgICAvLyBiZWluZyBib3VuZCBmcm9tIG1hcmt1cA0KICAgICAgICAgICAgdHlwZSA9ICJ0ZXh0IjsNCiAgICAgICAgICAgIGNvbXBhcmlzb25WYWx1ZSA9IG9wdGlvbnM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB0eXBlID0gb3B0aW9ucy50eXBlQXR0cjsNCiAgICAgICAgICAgIGNvbXBhcmlzb25WYWx1ZSA9IG9wdGlvbnMudmFsdWU7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBGcm9tIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMTIvV0QtaHRtbDUtMjAxMjEwMjUvY29tbW9uLWlucHV0LWVsZW1lbnQtYXR0cmlidXRlcy5odG1sI2F0dHItaW5wdXQtbWluLA0KICAgICAgICAvLyBpZiB0aGUgdmFsdWUgaXMgcGFyc2VhYmxlIHRvIGEgbnVtYmVyLCB0aGVuIHRoZSBtaW5pbXVtIHNob3VsZCBiZSBudW1lcmljDQogICAgICAgIGlmICghaXNOYU4oY29tcGFyaXNvblZhbHVlKSAmJiAhKGNvbXBhcmlzb25WYWx1ZSBpbnN0YW5jZW9mIERhdGUpKSB7DQogICAgICAgICAgICB0eXBlID0gIm51bWJlciI7DQogICAgICAgIH0NCg0KICAgICAgICB2YXIgcmVnZXgsIHZhbE1hdGNoZXMsIGNvbXBhcmlzb25WYWx1ZU1hdGNoZXM7DQogICAgICAgIHN3aXRjaCAodHlwZS50b0xvd2VyQ2FzZSgpKSB7DQogICAgICAgICAgICBjYXNlICJ3ZWVrIjoNCiAgICAgICAgICAgICAgICByZWdleCA9IC9eKFxkezR9KS1XKFxkezJ9KSQvOw0KICAgICAgICAgICAgICAgIHZhbE1hdGNoZXMgPSB2YWwubWF0Y2gocmVnZXgpOw0KICAgICAgICAgICAgICAgIGlmICh2YWxNYXRjaGVzID09PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCB2YWx1ZSBmb3IgIiArIHZhbGlkYXRvck5hbWUgKyAiIGF0dHJpYnV0ZSBmb3Igd2VlayBpbnB1dC4gIFNob3VsZCBsb29rIGxpa2UgIiArDQogICAgICAgICAgICAgICAgICAgICAgICAiJzIwMDAtVzMzJyBodHRwOi8vd3d3LnczLm9yZy9UUi9odG1sLW1hcmt1cC9pbnB1dC53ZWVrLmh0bWwjaW5wdXQud2Vlay5hdHRycy5taW4iKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY29tcGFyaXNvblZhbHVlTWF0Y2hlcyA9IGNvbXBhcmlzb25WYWx1ZS5tYXRjaChyZWdleCk7DQogICAgICAgICAgICAgICAgLy8gSWYgbm8gcmVnZXggbWF0Y2hlcyB3ZXJlIGZvdW5kLCB2YWxpZGF0aW9uIGZhaWxzDQogICAgICAgICAgICAgICAgaWYgKCFjb21wYXJpc29uVmFsdWVNYXRjaGVzKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZiAoaXNNYXhWYWxpZGF0aW9uKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAodmFsTWF0Y2hlc1sxXSA8IGNvbXBhcmlzb25WYWx1ZU1hdGNoZXNbMV0pIHx8IC8vIG9sZGVyIHllYXINCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNhbWUgeWVhciwgb2xkZXIgd2Vlaw0KICAgICAgICAgICAgICAgICAgICAgICAgKCh2YWxNYXRjaGVzWzFdID09PSBjb21wYXJpc29uVmFsdWVNYXRjaGVzWzFdKSAmJiAodmFsTWF0Y2hlc1syXSA8PSBjb21wYXJpc29uVmFsdWVNYXRjaGVzWzJdKSk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICh2YWxNYXRjaGVzWzFdID4gY29tcGFyaXNvblZhbHVlTWF0Y2hlc1sxXSkgfHwgLy8gbmV3ZXIgeWVhcg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2FtZSB5ZWFyLCBuZXdlciB3ZWVrDQogICAgICAgICAgICAgICAgICAgICAgICAoKHZhbE1hdGNoZXNbMV0gPT09IGNvbXBhcmlzb25WYWx1ZU1hdGNoZXNbMV0pICYmICh2YWxNYXRjaGVzWzJdID49IGNvbXBhcmlzb25WYWx1ZU1hdGNoZXNbMl0pKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGNhc2UgIm1vbnRoIjoNCiAgICAgICAgICAgICAgICByZWdleCA9IC9eKFxkezR9KS0oXGR7Mn0pJC87DQogICAgICAgICAgICAgICAgdmFsTWF0Y2hlcyA9IHZhbC5tYXRjaChyZWdleCk7DQogICAgICAgICAgICAgICAgaWYgKHZhbE1hdGNoZXMgPT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHZhbHVlIGZvciAiICsgdmFsaWRhdG9yTmFtZSArICIgYXR0cmlidXRlIGZvciBtb250aCBpbnB1dC4gIFNob3VsZCBsb29rIGxpa2UgIiArDQogICAgICAgICAgICAgICAgICAgICAgICAiJzIwMDAtMDMnIGh0dHA6Ly93d3cudzMub3JnL1RSL2h0bWwtbWFya3VwL2lucHV0Lm1vbnRoLmh0bWwjaW5wdXQubW9udGguYXR0cnMubWluIik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNvbXBhcmlzb25WYWx1ZU1hdGNoZXMgPSBjb21wYXJpc29uVmFsdWUubWF0Y2gocmVnZXgpOw0KICAgICAgICAgICAgICAgIC8vIElmIG5vIHJlZ2V4IG1hdGNoZXMgd2VyZSBmb3VuZCwgdmFsaWRhdGlvbiBmYWlscw0KICAgICAgICAgICAgICAgIGlmICghY29tcGFyaXNvblZhbHVlTWF0Y2hlcykgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKGlzTWF4VmFsaWRhdGlvbikgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gKCh2YWxNYXRjaGVzWzFdIDwgY29tcGFyaXNvblZhbHVlTWF0Y2hlc1sxXSkgfHwgLy8gb2xkZXIgeWVhcg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2FtZSB5ZWFyLCBvbGRlciBtb250aA0KICAgICAgICAgICAgICAgICAgICAgICAgKCh2YWxNYXRjaGVzWzFdID09PSBjb21wYXJpc29uVmFsdWVNYXRjaGVzWzFdKSAmJiAodmFsTWF0Y2hlc1syXSA8PSBjb21wYXJpc29uVmFsdWVNYXRjaGVzWzJdKSkpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAodmFsTWF0Y2hlc1sxXSA+IGNvbXBhcmlzb25WYWx1ZU1hdGNoZXNbMV0pIHx8IC8vIG5ld2VyIHllYXINCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNhbWUgeWVhciwgbmV3ZXIgbW9udGgNCiAgICAgICAgICAgICAgICAgICAgICAgICgodmFsTWF0Y2hlc1sxXSA9PT0gY29tcGFyaXNvblZhbHVlTWF0Y2hlc1sxXSkgJiYgKHZhbE1hdGNoZXNbMl0gPj0gY29tcGFyaXNvblZhbHVlTWF0Y2hlc1syXSkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSAibnVtYmVyIjoNCiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoNCiAgICAgICAgICAgICAgICBpZiAoaXNNYXhWYWxpZGF0aW9uKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAoIWlzTmFOKHZhbCkgJiYgcGFyc2VGbG9hdCh2YWwpIDw9IHBhcnNlRmxvYXQoY29tcGFyaXNvblZhbHVlKSk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICghaXNOYU4odmFsKSAmJiBwYXJzZUZsb2F0KHZhbCkgPj0gcGFyc2VGbG9hdChjb21wYXJpc29uVmFsdWUpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgaWYgKGlzTWF4VmFsaWRhdGlvbikgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsIDw9IGNvbXBhcmlzb25WYWx1ZTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsID49IGNvbXBhcmlzb25WYWx1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9Ow0KfQ0KDQprdi5ydWxlc1snbWluJ10gPSB7DQoJdmFsaWRhdG9yOiBtaW5NYXhWYWxpZGF0b3JGYWN0b3J5KCJtaW4iKSwNCgltZXNzYWdlOiAnUGxlYXNlIGVudGVyIGEgdmFsdWUgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIHswfS4nDQp9Ow0KDQprdi5ydWxlc1snbWF4J10gPSB7DQoJdmFsaWRhdG9yOiBtaW5NYXhWYWxpZGF0b3JGYWN0b3J5KCJtYXgiKSwNCgltZXNzYWdlOiAnUGxlYXNlIGVudGVyIGEgdmFsdWUgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIHswfS4nDQp9Ow0KDQprdi5ydWxlc1snbWluTGVuZ3RoJ10gPSB7DQoJdmFsaWRhdG9yOiBmdW5jdGlvbiAodmFsLCBtaW5MZW5ndGgpIHsNCgkJaWYoa3YudXRpbHMuaXNFbXB0eVZhbCh2YWwpKSB7IHJldHVybiB0cnVlOyB9DQoJCXZhciBub3JtYWxpemVkVmFsID0ga3YudXRpbHMuaXNOdW1iZXIodmFsKSA/ICgnJyArIHZhbCkgOiB2YWw7DQoJCXJldHVybiBub3JtYWxpemVkVmFsLmxlbmd0aCA+PSBtaW5MZW5ndGg7DQoJfSwNCgltZXNzYWdlOiAnUGxlYXNlIGVudGVyIGF0IGxlYXN0IHswfSBjaGFyYWN0ZXJzLicNCn07DQoNCmt2LnJ1bGVzWydtYXhMZW5ndGgnXSA9IHsNCgl2YWxpZGF0b3I6IGZ1bmN0aW9uICh2YWwsIG1heExlbmd0aCkgew0KCQlpZihrdi51dGlscy5pc0VtcHR5VmFsKHZhbCkpIHsgcmV0dXJuIHRydWU7IH0NCgkJdmFyIG5vcm1hbGl6ZWRWYWwgPSBrdi51dGlscy5pc051bWJlcih2YWwpID8gKCcnICsgdmFsKSA6IHZhbDsNCgkJcmV0dXJuIG5vcm1hbGl6ZWRWYWwubGVuZ3RoIDw9IG1heExlbmd0aDsNCgl9LA0KCW1lc3NhZ2U6ICdQbGVhc2UgZW50ZXIgbm8gbW9yZSB0aGFuIHswfSBjaGFyYWN0ZXJzLicNCn07DQoNCmt2LnJ1bGVzWydwYXR0ZXJuJ10gPSB7DQoJdmFsaWRhdG9yOiBmdW5jdGlvbiAodmFsLCByZWdleCkgew0KCQlyZXR1cm4ga3YudXRpbHMuaXNFbXB0eVZhbCh2YWwpIHx8IHZhbC50b1N0cmluZygpLm1hdGNoKHJlZ2V4KSAhPT0gbnVsbDsNCgl9LA0KCW1lc3NhZ2U6ICdQbGVhc2UgY2hlY2sgdGhpcyB2YWx1ZS4nDQp9Ow0KDQprdi5ydWxlc1snc3RlcCddID0gew0KCXZhbGlkYXRvcjogZnVuY3Rpb24gKHZhbCwgc3RlcCkgew0KDQoJCS8vIGluIG9yZGVyIHRvIGhhbmRsZSBzdGVwcyBvZiAuMSAmIC4wMSBldGMuLiBNb2R1bHVzIHdvbid0IHdvcmsNCgkJLy8gaWYgdGhlIHZhbHVlIGlzIGEgZGVjaW1hbCwgc28gd2UgaGF2ZSB0byBjb3JyZWN0IGZvciB0aGF0DQoJCWlmIChrdi51dGlscy5pc0VtcHR5VmFsKHZhbCkgfHwgc3RlcCA9PT0gJ2FueScpIHsgcmV0dXJuIHRydWU7IH0NCgkJdmFyIGRpZiA9ICh2YWwgKiAxMDApICUgKHN0ZXAgKiAxMDApOw0KCQlyZXR1cm4gTWF0aC5hYnMoZGlmKSA8IDAuMDAwMDEgfHwgTWF0aC5hYnMoMSAtIGRpZikgPCAwLjAwMDAxOw0KCX0sDQoJbWVzc2FnZTogJ1RoZSB2YWx1ZSBtdXN0IGluY3JlbWVudCBieSB7MH0uJw0KfTsNCg0Ka3YucnVsZXNbJ2VtYWlsJ10gPSB7DQoJdmFsaWRhdG9yOiBmdW5jdGlvbiAodmFsLCB2YWxpZGF0ZSkgew0KCQlpZiAoIXZhbGlkYXRlKSB7IHJldHVybiB0cnVlOyB9DQoNCgkJLy9JIHRoaW5rIGFuIGVtcHR5IGVtYWlsIGFkZHJlc3MgaXMgYWxzbyBhIHZhbGlkIGVudHJ5DQoJCS8vaWYgb25lIHdhbnQncyB0byBlbmZvcmNlIGVudHJ5IGl0IHNob3VsZCBiZSBkb25lIHdpdGggJ3JlcXVpcmVkOiB0cnVlJw0KCQlyZXR1cm4ga3YudXRpbHMuaXNFbXB0eVZhbCh2YWwpIHx8ICgNCgkJCS8vIGpxdWVyeSB2YWxpZGF0ZSByZWdleCAtIHRoYW5rcyBTY290dCBHb256YWxleg0KCQkJdmFsaWRhdGUgJiYgL14oKChbYS16XXxcZHxbISNcJCUmJ1wqXCtcLVwvPVw/XF5fYHtcfH1+XXxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSkrKFwuKFthLXpdfFxkfFshI1wkJSYnXCpcK1wtXC89XD9cXl9ge1x8fX5dfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKSspKil8KChceDIyKSgoKChceDIwfFx4MDkpKihceDBkXHgwYSkpPyhceDIwfFx4MDkpKyk/KChbXHgwMS1ceDA4XHgwYlx4MGNceDBlLVx4MWZceDdmXXxceDIxfFtceDIzLVx4NWJdfFtceDVkLVx4N2VdfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKXwoXFwoW1x4MDEtXHgwOVx4MGJceDBjXHgwZC1ceDdmXXxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSkpKSkqKCgoXHgyMHxceDA5KSooXHgwZFx4MGEpKT8oXHgyMHxceDA5KSspPyhceDIyKSkpQCgoKFthLXpdfFxkfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKXwoKFthLXpdfFxkfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKShbYS16XXxcZHwtfFwufF98fnxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSkqKFthLXpdfFxkfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKSkpXC4pKygoW2Etel18W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pfCgoW2Etel18W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pKFthLXpdfFxkfC18XC58X3x+fFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKSooW2Etel18W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pKSkkL2kudGVzdCh2YWwpDQoJCSk7DQoJfSwNCgltZXNzYWdlOiAnUGxlYXNlIGVudGVyIGEgcHJvcGVyIGVtYWlsIGFkZHJlc3MuJw0KfTsNCg0Ka3YucnVsZXNbJ2RhdGUnXSA9IHsNCgl2YWxpZGF0b3I6IGZ1bmN0aW9uICh2YWx1ZSwgdmFsaWRhdGUpIHsNCgkJaWYgKCF2YWxpZGF0ZSkgeyByZXR1cm4gdHJ1ZTsgfQ0KCQlyZXR1cm4ga3YudXRpbHMuaXNFbXB0eVZhbCh2YWx1ZSkgfHwgKHZhbGlkYXRlICYmICEvSW52YWxpZHxOYU4vLnRlc3QobmV3IERhdGUodmFsdWUpKSk7DQoJfSwNCgltZXNzYWdlOiAnUGxlYXNlIGVudGVyIGEgcHJvcGVyIGRhdGUuJw0KfTsNCg0Ka3YucnVsZXNbJ2RhdGVJU08nXSA9IHsNCgl2YWxpZGF0b3I6IGZ1bmN0aW9uICh2YWx1ZSwgdmFsaWRhdGUpIHsNCgkJaWYgKCF2YWxpZGF0ZSkgeyByZXR1cm4gdHJ1ZTsgfQ0KCQlyZXR1cm4ga3YudXRpbHMuaXNFbXB0eVZhbCh2YWx1ZSkgfHwgKHZhbGlkYXRlICYmIC9eXGR7NH1bLS9dKD86MD9bMS05XXwxWzAxMl0pWy0vXSg/OjA/WzEtOV18WzEyXVswLTldfDNbMDFdKSQvLnRlc3QodmFsdWUpKTsNCgl9LA0KCW1lc3NhZ2U6ICdQbGVhc2UgZW50ZXIgYSBwcm9wZXIgZGF0ZS4nDQp9Ow0KDQprdi5ydWxlc1snbnVtYmVyJ10gPSB7DQoJdmFsaWRhdG9yOiBmdW5jdGlvbiAodmFsdWUsIHZhbGlkYXRlKSB7DQoJCWlmICghdmFsaWRhdGUpIHsgcmV0dXJuIHRydWU7IH0NCgkJcmV0dXJuIGt2LnV0aWxzLmlzRW1wdHlWYWwodmFsdWUpIHx8ICh2YWxpZGF0ZSAmJiAvXi0/KD86XGQrfFxkezEsM30oPzosXGR7M30pKyk/KD86XC5cZCspPyQvLnRlc3QodmFsdWUpKTsNCgl9LA0KCW1lc3NhZ2U6ICdQbGVhc2UgZW50ZXIgYSBudW1iZXIuJw0KfTsNCg0Ka3YucnVsZXNbJ2RpZ2l0J10gPSB7DQoJdmFsaWRhdG9yOiBmdW5jdGlvbiAodmFsdWUsIHZhbGlkYXRlKSB7DQoJCWlmICghdmFsaWRhdGUpIHsgcmV0dXJuIHRydWU7IH0NCgkJcmV0dXJuIGt2LnV0aWxzLmlzRW1wdHlWYWwodmFsdWUpIHx8ICh2YWxpZGF0ZSAmJiAvXlxkKyQvLnRlc3QodmFsdWUpKTsNCgl9LA0KCW1lc3NhZ2U6ICdQbGVhc2UgZW50ZXIgYSBkaWdpdC4nDQp9Ow0KDQprdi5ydWxlc1sncGhvbmVVUyddID0gew0KCXZhbGlkYXRvcjogZnVuY3Rpb24gKHBob25lTnVtYmVyLCB2YWxpZGF0ZSkgew0KCQlpZiAoIXZhbGlkYXRlKSB7IHJldHVybiB0cnVlOyB9DQoJCWlmIChrdi51dGlscy5pc0VtcHR5VmFsKHBob25lTnVtYmVyKSkgeyByZXR1cm4gdHJ1ZTsgfSAvLyBtYWtlcyBpdCBvcHRpb25hbCwgdXNlICdyZXF1aXJlZCcgcnVsZSBpZiBpdCBzaG91bGQgYmUgcmVxdWlyZWQNCgkJaWYgKHR5cGVvZiAocGhvbmVOdW1iZXIpICE9PSAnc3RyaW5nJykgeyByZXR1cm4gZmFsc2U7IH0NCgkJcGhvbmVOdW1iZXIgPSBwaG9uZU51bWJlci5yZXBsYWNlKC9ccysvZywgIiIpOw0KCQlyZXR1cm4gdmFsaWRhdGUgJiYgcGhvbmVOdW1iZXIubGVuZ3RoID4gOSAmJiBwaG9uZU51bWJlci5tYXRjaCgvXigxLT8pPyhcKFsyLTldXGR7Mn1cKXxbMi05XVxkezJ9KS0/WzItOV1cZHsyfS0/XGR7NH0kLyk7DQoJfSwNCgltZXNzYWdlOiAnUGxlYXNlIHNwZWNpZnkgYSB2YWxpZCBwaG9uZSBudW1iZXIuJw0KfTsNCg0Ka3YucnVsZXNbJ2VxdWFsJ10gPSB7DQoJdmFsaWRhdG9yOiBmdW5jdGlvbiAodmFsLCBwYXJhbXMpIHsNCgkJdmFyIG90aGVyVmFsdWUgPSBwYXJhbXM7DQoJCXJldHVybiB2YWwgPT09IGt2LnV0aWxzLmdldFZhbHVlKG90aGVyVmFsdWUpOw0KCX0sDQoJbWVzc2FnZTogJ1ZhbHVlcyBtdXN0IGVxdWFsLicNCn07DQoNCmt2LnJ1bGVzWydub3RFcXVhbCddID0gew0KCXZhbGlkYXRvcjogZnVuY3Rpb24gKHZhbCwgcGFyYW1zKSB7DQoJCXZhciBvdGhlclZhbHVlID0gcGFyYW1zOw0KCQlyZXR1cm4gdmFsICE9PSBrdi51dGlscy5nZXRWYWx1ZShvdGhlclZhbHVlKTsNCgl9LA0KCW1lc3NhZ2U6ICdQbGVhc2UgY2hvb3NlIGFub3RoZXIgdmFsdWUuJw0KfTsNCg0KLy91bmlxdWUgaW4gY29sbGVjdGlvbg0KLy8gb3B0aW9ucyBhcmU6DQovLyAgICBjb2xsZWN0aW9uOiBhcnJheSBvciBmdW5jdGlvbiByZXR1cm5pbmcgKG9ic2VydmFibGUpIGFycmF5DQovLyAgICAgICAgICAgICAgaW4gd2hpY2ggdGhlIHZhbHVlIGhhcyB0byBiZSB1bmlxdWUNCi8vICAgIHZhbHVlQWNjZXNzb3I6IGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB2YWx1ZSBmcm9tIGFuIG9iamVjdCBzdG9yZWQgaW4gY29sbGVjdGlvbg0KLy8gICAgICAgICAgICAgIGlmIGl0IGlzIG51bGwgdGhlIHZhbHVlIGlzIGNvbXBhcmVkIGRpcmVjdGx5DQovLyAgICBleHRlcm5hbDogc2V0IHRvIHRydWUgd2hlbiBvYmplY3QgeW91IGFyZSB2YWxpZGF0aW5nIGlzIGF1dG9tYXRpY2FsbHkgdXBkYXRpbmcgY29sbGVjdGlvbg0Ka3YucnVsZXNbJ3VuaXF1ZSddID0gew0KCXZhbGlkYXRvcjogZnVuY3Rpb24gKHZhbCwgb3B0aW9ucykgew0KCQl2YXIgYyA9IGt2LnV0aWxzLmdldFZhbHVlKG9wdGlvbnMuY29sbGVjdGlvbiksDQoJCQlleHRlcm5hbCA9IGt2LnV0aWxzLmdldFZhbHVlKG9wdGlvbnMuZXh0ZXJuYWxWYWx1ZSksDQoJCQljb3VudGVyID0gMDsNCg0KCQlpZiAoIXZhbCB8fCAhYykgeyByZXR1cm4gdHJ1ZTsgfQ0KDQoJCWtvVXRpbHMuYXJyYXlGaWx0ZXIoYywgZnVuY3Rpb24gKGl0ZW0pIHsNCgkJCWlmICh2YWwgPT09IChvcHRpb25zLnZhbHVlQWNjZXNzb3IgPyBvcHRpb25zLnZhbHVlQWNjZXNzb3IoaXRlbSkgOiBpdGVtKSkgeyBjb3VudGVyKys7IH0NCgkJfSk7DQoJCS8vIGlmIHZhbHVlIGlzIGV4dGVybmFsIGV2ZW4gMSBzYW1lIHZhbHVlIGluIGNvbGxlY3Rpb24gbWVhbnMgdGhlIHZhbHVlIGlzIG5vdCB1bmlxdWUNCgkJcmV0dXJuIGNvdW50ZXIgPCAoISFleHRlcm5hbCA/IDEgOiAyKTsNCgl9LA0KCW1lc3NhZ2U6ICdQbGVhc2UgbWFrZSBzdXJlIHRoZSB2YWx1ZSBpcyB1bmlxdWUuJw0KfTsNCg0KDQovL25vdyByZWdpc3RlciBhbGwgb2YgdGhlc2UhDQooZnVuY3Rpb24gKCkgew0KCWt2LnJlZ2lzdGVyRXh0ZW5kZXJzKCk7DQp9KCkpOw0KOy8vIFRoZSBjb3JlIGJpbmRpbmcgaGFuZGxlcg0KLy8gdGhpcyBhbGxvd3MgdXMgdG8gc2V0dXAgYW55IHZhbHVlIGJpbmRpbmcgdGhhdCBpbnRlcm5hbGx5IGFsd2F5cw0KLy8gcGVyZm9ybXMgdGhlIHNhbWUgZnVuY3Rpb25hbGl0eQ0Ka28uYmluZGluZ0hhbmRsZXJzWyd2YWxpZGF0aW9uQ29yZSddID0gKGZ1bmN0aW9uICgpIHsNCg0KCXJldHVybiB7DQoJCWluaXQ6IGZ1bmN0aW9uIChlbGVtZW50LCB2YWx1ZUFjY2Vzc29yLCBhbGxCaW5kaW5nc0FjY2Vzc29yLCB2aWV3TW9kZWwsIGJpbmRpbmdDb250ZXh0KSB7DQoJCQl2YXIgY29uZmlnID0ga3YudXRpbHMuZ2V0Q29uZmlnT3B0aW9ucyhlbGVtZW50KTsNCgkJCXZhciBvYnNlcnZhYmxlID0gdmFsdWVBY2Nlc3NvcigpOw0KDQoJCQkvLyBwYXJzZSBodG1sNSBpbnB1dCB2YWxpZGF0aW9uIGF0dHJpYnV0ZXMsIG9wdGlvbmFsIGZlYXR1cmUNCgkJCWlmIChjb25maWcucGFyc2VJbnB1dEF0dHJpYnV0ZXMpIHsNCgkJCQlrdi51dGlscy5hc3luYyhmdW5jdGlvbiAoKSB7IGt2LnBhcnNlSW5wdXRWYWxpZGF0aW9uQXR0cmlidXRlcyhlbGVtZW50LCB2YWx1ZUFjY2Vzc29yKTsgfSk7DQoJCQl9DQoNCgkJCS8vIGlmIHJlcXVlc3RlZCBpbnNlcnQgbWVzc2FnZSBlbGVtZW50IGFuZCBhcHBseSBiaW5kaW5ncw0KCQkJaWYgKGNvbmZpZy5pbnNlcnRNZXNzYWdlcyAmJiBrdi51dGlscy5pc1ZhbGlkYXRhYmxlKG9ic2VydmFibGUpKSB7DQoNCgkJCQkvLyBpbnNlcnQgdGhlIDxzcGFuPjwvc3Bhbj4NCgkJCQl2YXIgdmFsaWRhdGlvbk1lc3NhZ2VFbGVtZW50ID0ga3YuaW5zZXJ0VmFsaWRhdGlvbk1lc3NhZ2UoZWxlbWVudCk7DQoNCgkJCQkvLyBpZiB3ZSdyZSB0b2xkIHRvIHVzZSBhIHRlbXBsYXRlLCBtYWtlIHN1cmUgdGhhdCBnZXRzIHJlbmRlcmVkDQoJCQkJaWYgKGNvbmZpZy5tZXNzYWdlVGVtcGxhdGUpIHsNCgkJCQkJa28ucmVuZGVyVGVtcGxhdGUoY29uZmlnLm1lc3NhZ2VUZW1wbGF0ZSwgeyBmaWVsZDogb2JzZXJ2YWJsZSB9LCBudWxsLCB2YWxpZGF0aW9uTWVzc2FnZUVsZW1lbnQsICdyZXBsYWNlTm9kZScpOw0KCQkJCX0gZWxzZSB7DQoJCQkJCWtvLmFwcGx5QmluZGluZ3NUb05vZGUodmFsaWRhdGlvbk1lc3NhZ2VFbGVtZW50LCB7IHZhbGlkYXRpb25NZXNzYWdlOiBvYnNlcnZhYmxlIH0pOw0KCQkJCX0NCgkJCX0NCg0KCQkJLy8gd3JpdGUgdGhlIGh0bWw1IGF0dHJpYnV0ZXMgaWYgaW5kaWNhdGVkIGJ5IHRoZSBjb25maWcNCgkJCWlmIChjb25maWcud3JpdGVJbnB1dEF0dHJpYnV0ZXMgJiYga3YudXRpbHMuaXNWYWxpZGF0YWJsZShvYnNlcnZhYmxlKSkgew0KDQoJCQkJa3Yud3JpdGVJbnB1dFZhbGlkYXRpb25BdHRyaWJ1dGVzKGVsZW1lbnQsIHZhbHVlQWNjZXNzb3IpOw0KCQkJfQ0KDQoJCQkvLyBpZiByZXF1ZXN0ZWQsIGFkZCBiaW5kaW5nIHRvIGRlY29yYXRlIGVsZW1lbnQNCgkJCWlmIChjb25maWcuZGVjb3JhdGVJbnB1dEVsZW1lbnQgJiYga3YudXRpbHMuaXNWYWxpZGF0YWJsZShvYnNlcnZhYmxlKSkgew0KCQkJCWtvLmFwcGx5QmluZGluZ3NUb05vZGUoZWxlbWVudCwgeyB2YWxpZGF0aW9uRWxlbWVudDogb2JzZXJ2YWJsZSB9KTsNCgkJCX0NCgkJfQ0KCX07DQoNCn0oKSk7DQoNCi8vIG92ZXJyaWRlIGZvciBLTydzIGRlZmF1bHQgJ3ZhbHVlJywgJ2NoZWNrZWQnLCAndGV4dElucHV0JyBhbmQgc2VsZWN0ZWRPcHRpb25zIGJpbmRpbmdzDQprdi5tYWtlQmluZGluZ0hhbmRsZXJWYWxpZGF0YWJsZSgidmFsdWUiKTsNCmt2Lm1ha2VCaW5kaW5nSGFuZGxlclZhbGlkYXRhYmxlKCJjaGVja2VkIik7DQppZiAoa28uYmluZGluZ0hhbmRsZXJzLnRleHRJbnB1dCkgew0KCWt2Lm1ha2VCaW5kaW5nSGFuZGxlclZhbGlkYXRhYmxlKCJ0ZXh0SW5wdXQiKTsNCn0NCmt2Lm1ha2VCaW5kaW5nSGFuZGxlclZhbGlkYXRhYmxlKCJzZWxlY3RlZE9wdGlvbnMiKTsNCg0KDQprby5iaW5kaW5nSGFuZGxlcnNbJ3ZhbGlkYXRpb25NZXNzYWdlJ10gPSB7IC8vIGluZGl2aWR1YWwgZXJyb3IgbWVzc2FnZSwgaWYgbW9kaWZpZWQgb3IgcG9zdCBiaW5kaW5nDQoJdXBkYXRlOiBmdW5jdGlvbiAoZWxlbWVudCwgdmFsdWVBY2Nlc3Nvcikgew0KCQl2YXIgb2JzdiA9IHZhbHVlQWNjZXNzb3IoKSwNCgkJCWNvbmZpZyA9IGt2LnV0aWxzLmdldENvbmZpZ09wdGlvbnMoZWxlbWVudCksDQoJCQl2YWwgPSB1bndyYXAob2JzdiksDQoJCQltc2cgPSBudWxsLA0KCQkJaXNNb2RpZmllZCA9IGZhbHNlLA0KCQkJaXNWYWxpZCA9IGZhbHNlOw0KDQoJCWlmIChvYnN2ID09PSBudWxsIHx8IHR5cGVvZiBvYnN2ID09PSAndW5kZWZpbmVkJykgew0KCQkJdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgYmluZCB2YWxpZGF0aW9uTWVzc2FnZSB0byB1bmRlZmluZWQgdmFsdWUuIGRhdGEtYmluZCBleHByZXNzaW9uOiAnICsNCgkJCQllbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1iaW5kJykpOw0KCQl9DQoNCgkJaWYgKCFvYnN2LmlzVmFsaWQgfHwgIW9ic3YuaXNNb2RpZmllZCkgew0KCQkJdGhyb3cgbmV3IEVycm9yKCJPYnNlcnZhYmxlIGlzIG5vdCB2YWxpZGF0YWJsZSIpOw0KCQl9DQoNCgkJaXNNb2RpZmllZCA9IG9ic3YuaXNNb2RpZmllZCgpOw0KCQlpc1ZhbGlkID0gb2Jzdi5pc1ZhbGlkKCk7DQoNCgkJdmFyIGVycm9yID0gbnVsbDsNCgkJaWYgKCFjb25maWcubWVzc2FnZXNPbk1vZGlmaWVkIHx8IGlzTW9kaWZpZWQpIHsNCgkJCWVycm9yID0gaXNWYWxpZCA/IG51bGwgOiBvYnN2LmVycm9yOw0KCQl9DQoNCgkJdmFyIGlzVmlzaWJsZSA9ICFjb25maWcubWVzc2FnZXNPbk1vZGlmaWVkIHx8IGlzTW9kaWZpZWQgPyAhaXNWYWxpZCA6IGZhbHNlOw0KCQl2YXIgaXNDdXJyZW50bHlWaXNpYmxlID0gZWxlbWVudC5zdHlsZS5kaXNwbGF5ICE9PSAibm9uZSI7DQoNCgkJaWYgKGNvbmZpZy5hbGxvd0h0bWxNZXNzYWdlcykgew0KCQkJa29VdGlscy5zZXRIdG1sKGVsZW1lbnQsIGVycm9yKTsNCgkJfSBlbHNlIHsNCgkJCWtvLmJpbmRpbmdIYW5kbGVycy50ZXh0LnVwZGF0ZShlbGVtZW50LCBmdW5jdGlvbiAoKSB7IHJldHVybiBlcnJvcjsgfSk7DQoJCX0NCg0KCQlpZiAoaXNDdXJyZW50bHlWaXNpYmxlICYmICFpc1Zpc2libGUpIHsNCgkJCWVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCgkJfSBlbHNlIGlmICghaXNDdXJyZW50bHlWaXNpYmxlICYmIGlzVmlzaWJsZSkgew0KCQkJZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJyc7DQoJCX0NCgl9DQp9Ow0KDQprby5iaW5kaW5nSGFuZGxlcnNbJ3ZhbGlkYXRpb25FbGVtZW50J10gPSB7DQoJdXBkYXRlOiBmdW5jdGlvbiAoZWxlbWVudCwgdmFsdWVBY2Nlc3NvciwgYWxsQmluZGluZ3NBY2Nlc3Nvcikgew0KCQl2YXIgb2JzdiA9IHZhbHVlQWNjZXNzb3IoKSwNCgkJCWNvbmZpZyA9IGt2LnV0aWxzLmdldENvbmZpZ09wdGlvbnMoZWxlbWVudCksDQoJCQl2YWwgPSB1bndyYXAob2JzdiksDQoJCQltc2cgPSBudWxsLA0KCQkJaXNNb2RpZmllZCA9IGZhbHNlLA0KCQkJaXNWYWxpZCA9IGZhbHNlOw0KDQoJCWlmIChvYnN2ID09PSBudWxsIHx8IHR5cGVvZiBvYnN2ID09PSAndW5kZWZpbmVkJykgew0KCQkJdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgYmluZCB2YWxpZGF0aW9uRWxlbWVudCB0byB1bmRlZmluZWQgdmFsdWUuIGRhdGEtYmluZCBleHByZXNzaW9uOiAnICsNCgkJCQllbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1iaW5kJykpOw0KCQl9DQoNCgkJaWYgKCFvYnN2LmlzVmFsaWQgfHwgIW9ic3YuaXNNb2RpZmllZCkgew0KCQkJdGhyb3cgbmV3IEVycm9yKCJPYnNlcnZhYmxlIGlzIG5vdCB2YWxpZGF0YWJsZSIpOw0KCQl9DQoNCgkJaXNNb2RpZmllZCA9IG9ic3YuaXNNb2RpZmllZCgpOw0KCQlpc1ZhbGlkID0gb2Jzdi5pc1ZhbGlkKCk7DQoNCgkJLy8gY3JlYXRlIGFuIGV2YWx1YXRvciBmdW5jdGlvbiB0aGF0IHdpbGwgcmV0dXJuIHNvbWV0aGluZyBsaWtlOg0KCQkvLyBjc3M6IHsgdmFsaWRhdGlvbkVsZW1lbnQ6IHRydWUgfQ0KCQl2YXIgY3NzU2V0dGluZ3NBY2Nlc3NvciA9IGZ1bmN0aW9uICgpIHsNCgkJCXZhciBjc3MgPSB7fTsNCg0KCQkJdmFyIHNob3VsZFNob3cgPSAoKCFjb25maWcuZGVjb3JhdGVFbGVtZW50T25Nb2RpZmllZCB8fCBpc01vZGlmaWVkKSA/ICFpc1ZhbGlkIDogZmFsc2UpOw0KDQoJCQkvLyBjc3M6IHsgdmFsaWRhdGlvbkVsZW1lbnQ6IGZhbHNlIH0NCgkJCWNzc1tjb25maWcuZXJyb3JFbGVtZW50Q2xhc3NdID0gc2hvdWxkU2hvdzsNCg0KCQkJcmV0dXJuIGNzczsNCgkJfTsNCg0KCQkvL2FkZCBvciByZW1vdmUgY2xhc3Mgb24gdGhlIGVsZW1lbnQ7DQoJCWtvLmJpbmRpbmdIYW5kbGVycy5jc3MudXBkYXRlKGVsZW1lbnQsIGNzc1NldHRpbmdzQWNjZXNzb3IsIGFsbEJpbmRpbmdzQWNjZXNzb3IpOw0KCQlpZiAoIWNvbmZpZy5lcnJvcnNBc1RpdGxlKSB7IHJldHVybjsgfQ0KDQoJCWtvLmJpbmRpbmdIYW5kbGVycy5hdHRyLnVwZGF0ZShlbGVtZW50LCBmdW5jdGlvbiAoKSB7DQoJCQl2YXINCgkJCQloYXNNb2RpZmljYXRpb24gPSAhY29uZmlnLmVycm9yc0FzVGl0bGVPbk1vZGlmaWVkIHx8IGlzTW9kaWZpZWQsDQoJCQkJdGl0bGUgPSBrdi51dGlscy5nZXRPcmlnaW5hbEVsZW1lbnRUaXRsZShlbGVtZW50KTsNCg0KCQkJaWYgKGhhc01vZGlmaWNhdGlvbiAmJiAhaXNWYWxpZCkgew0KCQkJCXJldHVybiB7IHRpdGxlOiBvYnN2LmVycm9yLCAnZGF0YS1vcmlnLXRpdGxlJzogdGl0bGUgfTsNCgkJCX0gZWxzZSBpZiAoIWhhc01vZGlmaWNhdGlvbiB8fCBpc1ZhbGlkKSB7DQoJCQkJcmV0dXJuIHsgdGl0bGU6IHRpdGxlLCAnZGF0YS1vcmlnLXRpdGxlJzogbnVsbCB9Ow0KCQkJfQ0KCQl9KTsNCgl9DQp9Ow0KDQovLyBWYWxpZGF0aW9uT3B0aW9uczoNCi8vIFRoaXMgYmluZGluZyBoYW5kbGVyIGFsbG93cyB5b3UgdG8gb3ZlcnJpZGUgdGhlIGluaXRpYWwgY29uZmlnIGJ5IHNldHRpbmcgYW55IG9mIHRoZSBvcHRpb25zIGZvciBhIHNwZWNpZmljIGVsZW1lbnQgb3IgY29udGV4dCBvZiBlbGVtZW50cw0KLy8NCi8vIEV4YW1wbGU6DQovLyA8ZGl2IGRhdGEtYmluZD0idmFsaWRhdGlvbk9wdGlvbnM6IHsgaW5zZXJ0TWVzc2FnZXM6IHRydWUsIG1lc3NhZ2VUZW1wbGF0ZTogJ2N1c3RvbVRlbXBsYXRlJywgZXJyb3JNZXNzYWdlQ2xhc3M6ICdteVNwZWNpYWxDbGFzcyd9Ij4NCi8vICAgICAgPGlucHV0IHR5cGU9InRleHQiIGRhdGEtYmluZD0idmFsdWU6IHNvbWVWYWx1ZSIvPg0KLy8gICAgICA8aW5wdXQgdHlwZT0idGV4dCIgZGF0YS1iaW5kPSJ2YWx1ZTogc29tZVZhbHVlMiIvPg0KLy8gPC9kaXY+DQprby5iaW5kaW5nSGFuZGxlcnNbJ3ZhbGlkYXRpb25PcHRpb25zJ10gPSAoZnVuY3Rpb24gKCkgew0KCXJldHVybiB7DQoJCWluaXQ6IGZ1bmN0aW9uIChlbGVtZW50LCB2YWx1ZUFjY2Vzc29yLCBhbGxCaW5kaW5nc0FjY2Vzc29yLCB2aWV3TW9kZWwsIGJpbmRpbmdDb250ZXh0KSB7DQoJCQl2YXIgb3B0aW9ucyA9IHVud3JhcCh2YWx1ZUFjY2Vzc29yKCkpOw0KCQkJaWYgKG9wdGlvbnMpIHsNCgkJCQl2YXIgbmV3Q29uZmlnID0gZXh0ZW5kKHt9LCBrdi5jb25maWd1cmF0aW9uKTsNCgkJCQlleHRlbmQobmV3Q29uZmlnLCBvcHRpb25zKTsNCg0KCQkJCS8vc3RvcmUgdGhlIHZhbGlkYXRpb24gb3B0aW9ucyBvbiB0aGUgbm9kZSBzbyB3ZSBjYW4gcmV0cmlldmUgaXQgbGF0ZXINCgkJCQlrdi51dGlscy5zZXREb21EYXRhKGVsZW1lbnQsIG5ld0NvbmZpZyk7DQoJCQl9DQoJCX0NCgl9Ow0KfSgpKTsNCjsvLyBWYWxpZGF0aW9uIEV4dGVuZGVyOg0KLy8gVGhpcyBpcyBmb3IgY3JlYXRpbmcgY3VzdG9tIHZhbGlkYXRpb24gbG9naWMgb24gdGhlIGZseQ0KLy8gRXhhbXBsZToNCi8vIHZhciB0ZXN0ID0ga28ub2JzZXJ2YWJsZSgnc29tZXRoaW5nJykuZXh0ZW5keygNCi8vICAgICAgdmFsaWRhdGlvbjogew0KLy8gICAgICAgICAgdmFsaWRhdG9yOiBmdW5jdGlvbih2YWwsIHNvbWVPdGhlclZhbCl7DQovLyAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQovLyAgICAgICAgICB9LA0KLy8gICAgICAgICAgbWVzc2FnZTogIlNvbWV0aGluZyBtdXN0IGJlIHJlYWxseSB3cm9uZyEnLA0KLy8gICAgICAgICAgcGFyYW1zOiB0cnVlDQovLyAgICAgIH0NCi8vICApfTsNCmtvLmV4dGVuZGVyc1sndmFsaWRhdGlvbiddID0gZnVuY3Rpb24gKG9ic2VydmFibGUsIHJ1bGVzKSB7IC8vIGFsbG93IHNpbmdsZSBydWxlIG9yIGFycmF5DQoJZm9yRWFjaChrdi51dGlscy5pc0FycmF5KHJ1bGVzKSA/IHJ1bGVzIDogW3J1bGVzXSwgZnVuY3Rpb24gKHJ1bGUpIHsNCgkJLy8gdGhlICdydWxlJyBiZWluZyBwYXNzZWQgaW4gaGVyZSBoYXMgbm8gbmFtZSB0byBpZGVudGlmeSBhIGNvcmUgUnVsZSwNCgkJLy8gc28gd2UgYWRkIGl0IGFzIGFuIGFub255bW91cyBydWxlDQoJCS8vIElmIHRoZSBkZXZlbG9wZXIgaXMgd2FudGluZyB0byB1c2UgYSBjb3JlIFJ1bGUsIGJ1dCB1c2UgYSBkaWZmZXJlbnQgbWVzc2FnZSBzZWUgdGhlICdhZGRFeHRlbmRlcicgbG9naWMgZm9yIGV4YW1wbGVzDQoJCWt2LmFkZEFub255bW91c1J1bGUob2JzZXJ2YWJsZSwgcnVsZSk7DQoJfSk7DQoJcmV0dXJuIG9ic2VydmFibGU7DQp9Ow0KDQovL1RoaXMgaXMgdGhlIGV4dGVuZGVyIHRoYXQgbWFrZXMgYSBLbm9ja291dCBPYnNlcnZhYmxlIGFsc28gJ1ZhbGlkYXRhYmxlJw0KLy9leGFtcGxlcyBpbmNsdWRlOg0KLy8gMS4gdmFyIHRlc3QgPSBrby5vYnNlcnZhYmxlKCdzb21ldGhpbmcnKS5leHRlbmQoe3ZhbGlkYXRhYmxlOiB0cnVlfSk7DQovLyB0aGlzIHdpbGwgZW5zdXJlIHRoYXQgdGhlIE9ic2VydmFibGUgb2JqZWN0IGlzIHNldHVwIHByb3Blcmx5IHRvIHJlc3BvbmQgdG8gcnVsZXMNCi8vDQovLyAyLiB0ZXN0LmV4dGVuZCh7dmFsaWRhdGFibGU6IGZhbHNlfSk7DQovLyB0aGlzIHdpbGwgcmVtb3ZlIHRoZSB2YWxpZGF0aW9uIHByb3BlcnRpZXMgZnJvbSB0aGUgT2JzZXJ2YWJsZSBvYmplY3Qgc2hvdWxkIHlvdSBuZWVkIHRvIGRvIHRoYXQuDQprby5leHRlbmRlcnNbJ3ZhbGlkYXRhYmxlJ10gPSBmdW5jdGlvbiAob2JzZXJ2YWJsZSwgb3B0aW9ucykgew0KCWlmICgha3YudXRpbHMuaXNPYmplY3Qob3B0aW9ucykpIHsNCgkJb3B0aW9ucyA9IHsgZW5hYmxlOiBvcHRpb25zIH07DQoJfQ0KDQoJaWYgKCEoJ2VuYWJsZScgaW4gb3B0aW9ucykpIHsNCgkJb3B0aW9ucy5lbmFibGUgPSB0cnVlOw0KCX0NCg0KCWlmIChvcHRpb25zLmVuYWJsZSAmJiAha3YudXRpbHMuaXNWYWxpZGF0YWJsZShvYnNlcnZhYmxlKSkgew0KCQl2YXIgY29uZmlnID0ga3YuY29uZmlndXJhdGlvbi52YWxpZGF0ZSB8fCB7fTsNCgkJdmFyIHZhbGlkYXRpb25PcHRpb25zID0gew0KCQkJdGhyb3R0bGVFdmFsdWF0aW9uIDogb3B0aW9ucy50aHJvdHRsZSB8fCBjb25maWcudGhyb3R0bGUNCgkJfTsNCg0KCQlvYnNlcnZhYmxlLmVycm9yID0ga28ub2JzZXJ2YWJsZShudWxsKTsgLy8gaG9sZHMgdGhlIGVycm9yIG1lc3NhZ2UsIHdlIG9ubHkgbmVlZCBvbmUgc2luY2Ugd2Ugc3RvcCBwcm9jZXNzaW5nIHZhbGlkYXRvcnMgd2hlbiBvbmUgaXMgaW52YWxpZA0KDQoJCS8vIG9ic2VydmFibGUucnVsZXM6DQoJCS8vIE9ic2VydmFibGVBcnJheSBvZiBSdWxlIENvbnRleHRzLCB3aGVyZSBhIFJ1bGUgQ29udGV4dCBpcyBzaW1wbHkgdGhlIG5hbWUgb2YgYSBydWxlIGFuZCB0aGUgcGFyYW1zIHRvIHN1cHBseSB0byBpdA0KCQkvLw0KCQkvLyBSdWxlIENvbnRleHQgPSB7IHJ1bGU6ICc8cnVsZSBuYW1lPicsIHBhcmFtczogJzxwYXNzZWQgaW4gcGFyYW1zPicsIG1lc3NhZ2U6ICc8T3ZlcnJpZGUgb2YgZGVmYXVsdCBNZXNzYWdlPicgfQ0KCQlvYnNlcnZhYmxlLnJ1bGVzID0ga28ub2JzZXJ2YWJsZUFycmF5KCk7IC8vaG9sZHMgdGhlIHJ1bGUgQ29udGV4dHMgdG8gdXNlIGFzIHBhcnQgb2YgdmFsaWRhdGlvbg0KDQoJCS8vaW4gY2FzZSBhc3luYyB2YWxpZGF0aW9uIGlzIG9jY3VycmluZw0KCQlvYnNlcnZhYmxlLmlzVmFsaWRhdGluZyA9IGtvLm9ic2VydmFibGUoZmFsc2UpOw0KDQoJCS8vdGhlIHRydWUgaG9sZGVyIG9mIHdoZXRoZXIgdGhlIG9ic2VydmFibGUgaXMgdmFsaWQgb3Igbm90DQoJCW9ic2VydmFibGUuX192YWxpZF9fID0ga28ub2JzZXJ2YWJsZSh0cnVlKTsNCg0KCQlvYnNlcnZhYmxlLmlzTW9kaWZpZWQgPSBrby5vYnNlcnZhYmxlKGZhbHNlKTsNCg0KCQkvLyBhIHNlbWktcHJvdGVjdGVkIG9ic2VydmFibGUNCgkJb2JzZXJ2YWJsZS5pc1ZhbGlkID0ga28uY29tcHV0ZWQob2JzZXJ2YWJsZS5fX3ZhbGlkX18pOw0KDQoJCS8vbWFudWFsbHkgc2V0IGVycm9yIHN0YXRlDQoJCW9ic2VydmFibGUuc2V0RXJyb3IgPSBmdW5jdGlvbiAoZXJyb3IpIHsNCgkJCXZhciBwcmV2aW91c0Vycm9yID0gb2JzZXJ2YWJsZS5lcnJvci5wZWVrKCk7DQoJCQl2YXIgcHJldmlvdXNJc1ZhbGlkID0gb2JzZXJ2YWJsZS5fX3ZhbGlkX18ucGVlaygpOw0KDQoJCQlvYnNlcnZhYmxlLmVycm9yKGVycm9yKTsNCgkJCW9ic2VydmFibGUuX192YWxpZF9fKGZhbHNlKTsNCg0KCQkJaWYgKHByZXZpb3VzRXJyb3IgIT09IGVycm9yICYmICFwcmV2aW91c0lzVmFsaWQpIHsNCgkJCQkvLyBpZiB0aGUgb2JzZXJ2YWJsZSB3YXMgbm90IHZhbGlkIGJlZm9yZSB0aGVuIGlzVmFsaWQgd2lsbCBub3QgbXV0YXRlLA0KCQkJCS8vIGhlbmNlIGNhdXNpbmcgYW55IGdyb3VwaW5nIHRvIG5vdCBkaXNwbGF5IHRoZSBsYXRlc3QgZXJyb3IuDQoJCQkJb2JzZXJ2YWJsZS5pc1ZhbGlkLm5vdGlmeVN1YnNjcmliZXJzKCk7DQoJCQl9DQoJCX07DQoNCgkJLy9tYW51YWxseSBjbGVhciBlcnJvciBzdGF0ZQ0KCQlvYnNlcnZhYmxlLmNsZWFyRXJyb3IgPSBmdW5jdGlvbiAoKSB7DQoJCQlvYnNlcnZhYmxlLmVycm9yKG51bGwpOw0KCQkJb2JzZXJ2YWJsZS5fX3ZhbGlkX18odHJ1ZSk7DQoJCQlyZXR1cm4gb2JzZXJ2YWJsZTsNCgkJfTsNCg0KCQkvL3N1YnNjcmliZSB0byBjaGFuZ2VzIGluIHRoZSBvYnNlcnZhYmxlDQoJCXZhciBoX2NoYW5nZSA9IG9ic2VydmFibGUuc3Vic2NyaWJlKGZ1bmN0aW9uICgpIHsNCgkJCW9ic2VydmFibGUuaXNNb2RpZmllZCh0cnVlKTsNCgkJfSk7DQoNCgkJLy8gd2UgdXNlIGEgY29tcHV0ZWQgaGVyZSB0byBlbnN1cmUgdGhhdCBhbnl0aW1lIGEgZGVwZW5kZW5jeSBjaGFuZ2VzLCB0aGUNCgkJLy8gdmFsaWRhdGlvbiBsb2dpYyBldmFsdWF0ZXMNCgkJdmFyIGhfb2JzVmFsaWRhdGlvblRyaWdnZXIgPSBrby5jb21wdXRlZChleHRlbmQoew0KCQkJcmVhZDogZnVuY3Rpb24gKCkgew0KCQkJCXZhciBvYnMgPSBvYnNlcnZhYmxlKCksDQoJCQkJCXJ1bGVDb250ZXh0cyA9IG9ic2VydmFibGUucnVsZXMoKTsNCg0KCQkJCWt2LnZhbGlkYXRlT2JzZXJ2YWJsZShvYnNlcnZhYmxlKTsNCg0KCQkJCXJldHVybiB0cnVlOw0KCQkJfQ0KCQl9LCB2YWxpZGF0aW9uT3B0aW9ucykpOw0KDQoJCWV4dGVuZChoX29ic1ZhbGlkYXRpb25UcmlnZ2VyLCB2YWxpZGF0aW9uT3B0aW9ucyk7DQoNCgkJb2JzZXJ2YWJsZS5fZGlzcG9zZVZhbGlkYXRpb24gPSBmdW5jdGlvbiAoKSB7DQoJCQkvL2ZpcnN0IGRpc3Bvc2Ugb2YgdGhlIHN1YnNjcmlwdGlvbnMNCgkJCW9ic2VydmFibGUuaXNWYWxpZC5kaXNwb3NlKCk7DQoJCQlvYnNlcnZhYmxlLnJ1bGVzLnJlbW92ZUFsbCgpOw0KCQkJaWYgKG9ic2VydmFibGUuaXNNb2RpZmllZC5nZXRTdWJzY3JpcHRpb25zQ291bnQoKSA+IDApIHsNCgkJCQlvYnNlcnZhYmxlLmlzTW9kaWZpZWQuX3N1YnNjcmlwdGlvbnNbJ2NoYW5nZSddID0gW107DQoJCQl9DQoJCQlpZiAob2JzZXJ2YWJsZS5pc1ZhbGlkYXRpbmcuZ2V0U3Vic2NyaXB0aW9uc0NvdW50KCkgPiAwKSB7DQoJCQkJb2JzZXJ2YWJsZS5pc1ZhbGlkYXRpbmcuX3N1YnNjcmlwdGlvbnNbJ2NoYW5nZSddID0gW107DQoJCQl9DQoJCQlpZiAob2JzZXJ2YWJsZS5fX3ZhbGlkX18uZ2V0U3Vic2NyaXB0aW9uc0NvdW50KCkgPiAwKSB7DQoJCQkJb2JzZXJ2YWJsZS5fX3ZhbGlkX18uX3N1YnNjcmlwdGlvbnNbJ2NoYW5nZSddID0gW107DQoJCQl9DQoJCQloX2NoYW5nZS5kaXNwb3NlKCk7DQoJCQloX29ic1ZhbGlkYXRpb25UcmlnZ2VyLmRpc3Bvc2UoKTsNCg0KCQkJZGVsZXRlIG9ic2VydmFibGVbJ3J1bGVzJ107DQoJCQlkZWxldGUgb2JzZXJ2YWJsZVsnZXJyb3InXTsNCgkJCWRlbGV0ZSBvYnNlcnZhYmxlWydpc1ZhbGlkJ107DQoJCQlkZWxldGUgb2JzZXJ2YWJsZVsnaXNWYWxpZGF0aW5nJ107DQoJCQlkZWxldGUgb2JzZXJ2YWJsZVsnX192YWxpZF9fJ107DQoJCQlkZWxldGUgb2JzZXJ2YWJsZVsnaXNNb2RpZmllZCddOw0KCQl9Ow0KCX0gZWxzZSBpZiAob3B0aW9ucy5lbmFibGUgPT09IGZhbHNlICYmIG9ic2VydmFibGUuX2Rpc3Bvc2VWYWxpZGF0aW9uKSB7DQoJCW9ic2VydmFibGUuX2Rpc3Bvc2VWYWxpZGF0aW9uKCk7DQoJfQ0KCXJldHVybiBvYnNlcnZhYmxlOw0KfTsNCg0KZnVuY3Rpb24gdmFsaWRhdGVTeW5jKG9ic2VydmFibGUsIHJ1bGUsIGN0eCkgew0KCS8vRXhlY3V0ZSB0aGUgdmFsaWRhdG9yIGFuZCBzZWUgaWYgaXRzIHZhbGlkDQoJaWYgKCFydWxlLnZhbGlkYXRvcihvYnNlcnZhYmxlKCksIChjdHgucGFyYW1zID09PSB1bmRlZmluZWQgPyB0cnVlIDogdW53cmFwKGN0eC5wYXJhbXMpKSkpIHsgLy8gZGVmYXVsdCBwYXJhbSBpcyB0cnVlLCBlZy4gcmVxdWlyZWQgPSB0cnVlDQoNCgkJLy9ub3QgdmFsaWQsIHNvIGZvcm1hdCB0aGUgZXJyb3IgbWVzc2FnZSBhbmQgc3RpY2sgaXQgaW4gdGhlICdlcnJvcicgdmFyaWFibGUNCgkJb2JzZXJ2YWJsZS5zZXRFcnJvcihrdi5mb3JtYXRNZXNzYWdlKA0KCQkJCQljdHgubWVzc2FnZSB8fCBydWxlLm1lc3NhZ2UsDQoJCQkJCXVud3JhcChjdHgucGFyYW1zKSwNCgkJCQkJb2JzZXJ2YWJsZSkpOw0KCQlyZXR1cm4gZmFsc2U7DQoJfSBlbHNlIHsNCgkJcmV0dXJuIHRydWU7DQoJfQ0KfQ0KDQpmdW5jdGlvbiB2YWxpZGF0ZUFzeW5jKG9ic2VydmFibGUsIHJ1bGUsIGN0eCkgew0KCW9ic2VydmFibGUuaXNWYWxpZGF0aW5nKHRydWUpOw0KDQoJdmFyIGNhbGxCYWNrID0gZnVuY3Rpb24gKHZhbE9iaikgew0KCQl2YXIgaXNWYWxpZCA9IGZhbHNlLA0KCQkJbXNnID0gJyc7DQoNCgkJaWYgKCFvYnNlcnZhYmxlLl9fdmFsaWRfXygpKSB7DQoNCgkJCS8vIHNpbmNlIHdlJ3JlIHJldHVybmluZyBlYXJseSwgbWFrZSBzdXJlIHdlIHR1cm4gdGhpcyBvZmYNCgkJCW9ic2VydmFibGUuaXNWYWxpZGF0aW5nKGZhbHNlKTsNCg0KCQkJcmV0dXJuOyAvL2lmIGl0cyBhbHJlYWR5IE5PVCB2YWxpZCwgZG9uJ3QgYWRkIHRvIHRoYXQNCgkJfQ0KDQoJCS8vd2Ugd2VyZSBoYW5kZWQgYmFjayBhIGNvbXBsZXggb2JqZWN0DQoJCWlmICh2YWxPYmpbJ21lc3NhZ2UnXSkgew0KCQkJaXNWYWxpZCA9IHZhbE9iai5pc1ZhbGlkOw0KCQkJbXNnID0gdmFsT2JqLm1lc3NhZ2U7DQoJCX0gZWxzZSB7DQoJCQlpc1ZhbGlkID0gdmFsT2JqOw0KCQl9DQoNCgkJaWYgKCFpc1ZhbGlkKSB7DQoJCQkvL25vdCB2YWxpZCwgc28gZm9ybWF0IHRoZSBlcnJvciBtZXNzYWdlIGFuZCBzdGljayBpdCBpbiB0aGUgJ2Vycm9yJyB2YXJpYWJsZQ0KCQkJb2JzZXJ2YWJsZS5lcnJvcihrdi5mb3JtYXRNZXNzYWdlKA0KCQkJCW1zZyB8fCBjdHgubWVzc2FnZSB8fCBydWxlLm1lc3NhZ2UsDQoJCQkJdW53cmFwKGN0eC5wYXJhbXMpLA0KCQkJCW9ic2VydmFibGUpKTsNCgkJCW9ic2VydmFibGUuX192YWxpZF9fKGlzVmFsaWQpOw0KCQl9DQoNCgkJLy8gdGVsbCBpdCB0aGF0IHdlJ3JlIGRvbmUNCgkJb2JzZXJ2YWJsZS5pc1ZhbGlkYXRpbmcoZmFsc2UpOw0KCX07DQoNCgkvL2ZpcmUgdGhlIHZhbGlkYXRvciBhbmQgaGFuZCBpdCB0aGUgY2FsbGJhY2sNCglydWxlLnZhbGlkYXRvcihvYnNlcnZhYmxlKCksIHVud3JhcChjdHgucGFyYW1zIHx8IHRydWUpLCBjYWxsQmFjayk7DQp9DQoNCmt2LnZhbGlkYXRlT2JzZXJ2YWJsZSA9IGZ1bmN0aW9uIChvYnNlcnZhYmxlKSB7DQoJdmFyIGkgPSAwLA0KCQlydWxlLCAvLyB0aGUgcnVsZSB2YWxpZGF0b3IgdG8gZXhlY3V0ZQ0KCQljdHgsIC8vIHRoZSBjdXJyZW50IFJ1bGUgQ29udGV4dCBmb3IgdGhlIGxvb3ANCgkJcnVsZUNvbnRleHRzID0gb2JzZXJ2YWJsZS5ydWxlcygpLCAvL2NhY2hlIGZvciBpdGVyYXRvcg0KCQlsZW4gPSBydWxlQ29udGV4dHMubGVuZ3RoOyAvL2NhY2hlIGZvciBpdGVyYXRvcg0KDQoJZm9yICg7IGkgPCBsZW47IGkrKykgew0KDQoJCS8vZ2V0IHRoZSBSdWxlIENvbnRleHQgaW5mbyB0byBnaXZlIHRvIHRoZSBjb3JlIFJ1bGUNCgkJY3R4ID0gcnVsZUNvbnRleHRzW2ldOw0KDQoJCS8vIGNoZWNrcyBhbiAnb25seUlmJyBjb25kaXRpb24NCgkJaWYgKGN0eC5jb25kaXRpb24gJiYgIWN0eC5jb25kaXRpb24oKSkgew0KCQkJY29udGludWU7DQoJCX0NCg0KCQkvL2dldCB0aGUgY29yZSBSdWxlIHRvIHVzZSBmb3IgdmFsaWRhdGlvbg0KCQlydWxlID0gY3R4LnJ1bGUgPyBrdi5ydWxlc1tjdHgucnVsZV0gOiBjdHg7DQoNCgkJaWYgKHJ1bGVbJ2FzeW5jJ10gfHwgY3R4Wydhc3luYyddKSB7DQoJCQkvL3J1biBhc3luYyB2YWxpZGF0aW9uDQoJCQl2YWxpZGF0ZUFzeW5jKG9ic2VydmFibGUsIHJ1bGUsIGN0eCk7DQoNCgkJfSBlbHNlIHsNCgkJCS8vcnVuIG5vcm1hbCBzeW5jIHZhbGlkYXRpb24NCgkJCWlmICghdmFsaWRhdGVTeW5jKG9ic2VydmFibGUsIHJ1bGUsIGN0eCkpIHsNCgkJCQlyZXR1cm4gZmFsc2U7IC8vYnJlYWsgb3V0IG9mIHRoZSBsb29wDQoJCQl9DQoJCX0NCgl9DQoJLy9maW5hbGx5IGlmIHdlIGdvdCB0aGlzIGZhciwgbWFrZSB0aGUgb2JzZXJ2YWJsZSB2YWxpZCBhZ2FpbiENCglvYnNlcnZhYmxlLmNsZWFyRXJyb3IoKTsNCglyZXR1cm4gdHJ1ZTsNCn07DQo7DQp2YXIgX2xvY2FsZXMgPSB7fTsNCnZhciBfY3VycmVudExvY2FsZTsNCg0Ka3YuZGVmaW5lTG9jYWxlID0gZnVuY3Rpb24obmFtZSwgdmFsdWVzKSB7DQoJaWYgKG5hbWUgJiYgdmFsdWVzKSB7DQoJCV9sb2NhbGVzW25hbWUudG9Mb3dlckNhc2UoKV0gPSB2YWx1ZXM7DQoJCXJldHVybiB2YWx1ZXM7DQoJfQ0KCXJldHVybiBudWxsOw0KfTsNCg0Ka3YubG9jYWxlID0gZnVuY3Rpb24obmFtZSkgew0KCWlmIChuYW1lKSB7DQoJCW5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7DQoNCgkJaWYgKF9sb2NhbGVzLmhhc093blByb3BlcnR5KG5hbWUpKSB7DQoJCQlrdi5sb2NhbGl6ZShfbG9jYWxlc1tuYW1lXSk7DQoJCQlfY3VycmVudExvY2FsZSA9IG5hbWU7DQoJCX0NCgkJZWxzZSB7DQoJCQl0aHJvdyBuZXcgRXJyb3IoJ0xvY2FsaXphdGlvbiAnICsgbmFtZSArICcgaGFzIG5vdCBiZWVuIGxvYWRlZC4nKTsNCgkJfQ0KCX0NCglyZXR1cm4gX2N1cnJlbnRMb2NhbGU7DQp9Ow0KDQovL3F1aWNrIGZ1bmN0aW9uIHRvIG92ZXJyaWRlIHJ1bGUgbWVzc2FnZXMNCmt2LmxvY2FsaXplID0gZnVuY3Rpb24gKG1zZ1RyYW5zbGF0aW9ucykgew0KCXZhciBydWxlcyA9IGt2LnJ1bGVzOw0KDQoJLy9sb29wIHRoZSBwcm9wZXJ0aWVzIGluIHRoZSBvYmplY3QgYW5kIGFzc2lnbiB0aGUgbXNnIHRvIHRoZSBydWxlDQoJZm9yICh2YXIgcnVsZU5hbWUgaW4gbXNnVHJhbnNsYXRpb25zKSB7DQoJCWlmIChydWxlcy5oYXNPd25Qcm9wZXJ0eShydWxlTmFtZSkpIHsNCgkJCXJ1bGVzW3J1bGVOYW1lXS5tZXNzYWdlID0gbXNnVHJhbnNsYXRpb25zW3J1bGVOYW1lXTsNCgkJfQ0KCX0NCn07DQoNCi8vIFBvcHVsYXRlIGRlZmF1bHQgbG9jYWxlICh0aGlzIHdpbGwgbWFrZSBlbi1VUy5qcyBzb21ld2hhdCByZWR1bmRhbnQpDQooZnVuY3Rpb24oKSB7DQoJdmFyIGxvY2FsZURhdGEgPSB7fTsNCgl2YXIgcnVsZXMgPSBrdi5ydWxlczsNCg0KCWZvciAodmFyIHJ1bGVOYW1lIGluIHJ1bGVzKSB7DQoJCWlmIChydWxlcy5oYXNPd25Qcm9wZXJ0eShydWxlTmFtZSkpIHsNCgkJCWxvY2FsZURhdGFbcnVsZU5hbWVdID0gcnVsZXNbcnVsZU5hbWVdLm1lc3NhZ2U7DQoJCX0NCgl9DQoJa3YuZGVmaW5lTG9jYWxlKCdlbi11cycsIGxvY2FsZURhdGEpOw0KfSkoKTsNCg0KLy8gTm8gbmVlZCB0byBpbnZva2UgbG9jYWxlIGJlY2F1c2UgdGhlIG1lc3NhZ2VzIGFyZSBhbHJlYWR5IGRlZmluZWQgYWxvbmcgd2l0aCB0aGUgcnVsZXMgZm9yIGVuLVVTDQpfY3VycmVudExvY2FsZSA9ICdlbi11cyc7DQo7LyoqDQogKiBQb3NzaWJsZSBpbnZvY2F0aW9uczoNCiAqIAkJYXBwbHlCaW5kaW5nc1dpdGhWYWxpZGF0aW9uKHZpZXdNb2RlbCkNCiAqIAkJYXBwbHlCaW5kaW5nc1dpdGhWYWxpZGF0aW9uKHZpZXdNb2RlbCwgb3B0aW9ucykNCiAqIAkJYXBwbHlCaW5kaW5nc1dpdGhWYWxpZGF0aW9uKHZpZXdNb2RlbCwgcm9vdE5vZGUpDQogKgkJYXBwbHlCaW5kaW5nc1dpdGhWYWxpZGF0aW9uKHZpZXdNb2RlbCwgcm9vdE5vZGUsIG9wdGlvbnMpDQogKi8NCmtvLmFwcGx5QmluZGluZ3NXaXRoVmFsaWRhdGlvbiA9IGZ1bmN0aW9uICh2aWV3TW9kZWwsIHJvb3ROb2RlLCBvcHRpb25zKSB7DQoJdmFyIG5vZGUgPSBkb2N1bWVudC5ib2R5LA0KCQljb25maWc7DQoNCglpZiAocm9vdE5vZGUgJiYgcm9vdE5vZGUubm9kZVR5cGUpIHsNCgkJbm9kZSA9IHJvb3ROb2RlOw0KCQljb25maWcgPSBvcHRpb25zOw0KCX0NCgllbHNlIHsNCgkJY29uZmlnID0gcm9vdE5vZGU7DQoJfQ0KDQoJa3YuaW5pdCgpOw0KDQoJaWYgKGNvbmZpZykgew0KCQljb25maWcgPSBleHRlbmQoZXh0ZW5kKHt9LCBrdi5jb25maWd1cmF0aW9uKSwgY29uZmlnKTsNCgkJa3YudXRpbHMuc2V0RG9tRGF0YShub2RlLCBjb25maWcpOw0KCX0NCg0KCWtvLmFwcGx5QmluZGluZ3Modmlld01vZGVsLCBub2RlKTsNCn07DQoNCi8vb3ZlcnJpZGUgdGhlIG9yaWdpbmFsIGFwcGx5QmluZGluZ3Mgc28gdGhhdCB3ZSBjYW4gZW5zdXJlIGFsbCBuZXcgcnVsZXMgYW5kIHdoYXQgbm90IGFyZSBjb3JyZWN0bHkgcmVnaXN0ZXJlZA0KdmFyIG9yaWdBcHBseUJpbmRpbmdzID0ga28uYXBwbHlCaW5kaW5nczsNCmtvLmFwcGx5QmluZGluZ3MgPSBmdW5jdGlvbiAodmlld01vZGVsLCByb290Tm9kZSkgew0KDQoJa3YuaW5pdCgpOw0KDQoJb3JpZ0FwcGx5QmluZGluZ3Modmlld01vZGVsLCByb290Tm9kZSk7DQp9Ow0KDQprby52YWxpZGF0ZWRPYnNlcnZhYmxlID0gZnVuY3Rpb24gKGluaXRpYWxWYWx1ZSwgb3B0aW9ucykgew0KCWlmICghb3B0aW9ucyAmJiAha3YudXRpbHMuaXNPYmplY3QoaW5pdGlhbFZhbHVlKSkgew0KCQlyZXR1cm4ga28ub2JzZXJ2YWJsZShpbml0aWFsVmFsdWUpLmV4dGVuZCh7IHZhbGlkYXRhYmxlOiB0cnVlIH0pOw0KCX0NCg0KCXZhciBvYnN2ID0ga28ub2JzZXJ2YWJsZShpbml0aWFsVmFsdWUpOw0KCW9ic3YuZXJyb3JzID0ga3YuZ3JvdXAoa3YudXRpbHMuaXNPYmplY3QoaW5pdGlhbFZhbHVlKSA/IGluaXRpYWxWYWx1ZSA6IHt9LCBvcHRpb25zKTsNCglvYnN2LmlzVmFsaWQgPSBrby5vYnNlcnZhYmxlKG9ic3YuZXJyb3JzKCkubGVuZ3RoID09PSAwKTsNCg0KCWlmIChrby5pc09ic2VydmFibGUob2Jzdi5lcnJvcnMpKSB7DQoJCW9ic3YuZXJyb3JzLnN1YnNjcmliZShmdW5jdGlvbihlcnJvcnMpIHsNCgkJCW9ic3YuaXNWYWxpZChlcnJvcnMubGVuZ3RoID09PSAwKTsNCgkJfSk7DQoJfQ0KCWVsc2Ugew0KCQlrby5jb21wdXRlZChvYnN2LmVycm9ycykuc3Vic2NyaWJlKGZ1bmN0aW9uIChlcnJvcnMpIHsNCgkJCW9ic3YuaXNWYWxpZChlcnJvcnMubGVuZ3RoID09PSAwKTsNCgkJfSk7DQoJfQ0KDQoJb2Jzdi5zdWJzY3JpYmUoZnVuY3Rpb24obmV3VmFsdWUpIHsNCgkJaWYgKCFrdi51dGlscy5pc09iamVjdChuZXdWYWx1ZSkpIHsNCgkJCS8qDQoJCQkgKiBUaGUgdmFsaWRhdGlvbiBncm91cCB3b3JrcyBvbiBvYmplY3RzLg0KCQkJICogU2luY2UgdGhlIG5ldyB2YWx1ZSBpcyBhIHByaW1pdGl2ZSAoc2NhbGFyLCBudWxsIG9yIHVuZGVmaW5lZCkgd2UgbmVlZA0KCQkJICogdG8gY3JlYXRlIGFuIGVtcHR5IG9iamVjdCB0byBwYXNzIGFsb25nLg0KCQkJICovDQoJCQluZXdWYWx1ZSA9IHt9Ow0KCQl9DQoJCS8vIEZvcmNlIHRoZSBncm91cCB0byByZWZyZXNoDQoJCW9ic3YuZXJyb3JzLl91cGRhdGVTdGF0ZShuZXdWYWx1ZSk7DQoJCW9ic3YuaXNWYWxpZChvYnN2LmVycm9ycygpLmxlbmd0aCA9PT0gMCk7DQoJfSk7DQoNCglyZXR1cm4gb2JzdjsNCn07DQo7fSkpOw==
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 49513
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "ba3f86a2-4a1c-4d78-b63d-91c2779c1b5e"
  Hint: __Sortorder
  Value: 800
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20171120T053119Z
- Language: "ja-JP"
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20171120T053119Z
    - ID: "5dd74568-4d4b-44c1-b513-0af5f4cda34f"
      Hint: __Created by
      Value: |
        sitecore\admin
