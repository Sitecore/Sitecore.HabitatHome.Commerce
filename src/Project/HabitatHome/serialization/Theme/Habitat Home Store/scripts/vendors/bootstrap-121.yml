---
ID: "c07fab41-2bfd-4c62-96ad-4d76e8915a1b"
Parent: "0f96d50a-ce5f-456f-837d-a416b6d71b99"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: "/sitecore/media library/Themes/Habitat Sites/Habitat Home Store/scripts/vendors/bootstrap-121"
DB: master
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/7F522A5BE0074D56BB6161CBEEE5114A.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  BlobID: "072ef580-586f-4c86-b4ac-7d8d6e3ef052"
  Value: LyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogKiBib290c3RyYXAtdHJhbnNpdGlvbi5qcyB2Mi4xLjENCiAqIGh0dHA6Ly90d2l0dGVyLmdpdGh1Yi5jb20vYm9vdHN0cmFwL2phdmFzY3JpcHQuaHRtbCN0cmFuc2l0aW9ucw0KICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogKiBDb3B5cmlnaHQgMjAxMiBUd2l0dGVyLCBJbmMuDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8NCg0KDQohZnVuY3Rpb24gKCQpIHsNCg0KICAkKGZ1bmN0aW9uICgpIHsNCg0KICAgICJ1c2Ugc3RyaWN0IjsgLy8ganNoaW50IDtfOw0KDQoNCiAgICAvKiBDU1MgVFJBTlNJVElPTiBTVVBQT1JUIChodHRwOi8vd3d3Lm1vZGVybml6ci5jb20vKQ0KICAgICAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8NCg0KICAgICQuc3VwcG9ydC50cmFuc2l0aW9uID0gKGZ1bmN0aW9uICgpIHsNCg0KICAgICAgdmFyIHRyYW5zaXRpb25FbmQgPSAoZnVuY3Rpb24gKCkgew0KDQogICAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Jvb3RzdHJhcCcpDQogICAgICAgICAgLCB0cmFuc0VuZEV2ZW50TmFtZXMgPSB7DQogICAgICAgICAgICAgICAnV2Via2l0VHJhbnNpdGlvbicgOiAnd2Via2l0VHJhbnNpdGlvbkVuZCcNCiAgICAgICAgICAgICwgICdNb3pUcmFuc2l0aW9uJyAgICA6ICd0cmFuc2l0aW9uZW5kJw0KICAgICAgICAgICAgLCAgJ09UcmFuc2l0aW9uJyAgICAgIDogJ29UcmFuc2l0aW9uRW5kIG90cmFuc2l0aW9uZW5kJw0KICAgICAgICAgICAgLCAgJ3RyYW5zaXRpb24nICAgICAgIDogJ3RyYW5zaXRpb25lbmQnDQogICAgICAgICAgICB9DQogICAgICAgICAgLCBuYW1lDQoNCiAgICAgICAgZm9yIChuYW1lIGluIHRyYW5zRW5kRXZlbnROYW1lcyl7DQogICAgICAgICAgaWYgKGVsLnN0eWxlW25hbWVdICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIHJldHVybiB0cmFuc0VuZEV2ZW50TmFtZXNbbmFtZV0NCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgfSgpKQ0KDQogICAgICByZXR1cm4gdHJhbnNpdGlvbkVuZCAmJiB7DQogICAgICAgIGVuZDogdHJhbnNpdGlvbkVuZA0KICAgICAgfQ0KDQogICAgfSkoKQ0KDQogIH0pDQoNCn0od2luZG93LmpRdWVyeSk7LyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICogYm9vdHN0cmFwLWFsZXJ0LmpzIHYyLjEuMQ0KICogaHR0cDovL3R3aXR0ZXIuZ2l0aHViLmNvbS9ib290c3RyYXAvamF2YXNjcmlwdC5odG1sI2FsZXJ0cw0KICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICogQ29weXJpZ2h0IDIwMTIgVHdpdHRlciwgSW5jLg0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovDQoNCg0KIWZ1bmN0aW9uICgkKSB7DQoNCiAgInVzZSBzdHJpY3QiOyAvLyBqc2hpbnQgO187DQoNCg0KIC8qIEFMRVJUIENMQVNTIERFRklOSVRJT04NCiAgKiA9PT09PT09PT09PT09PT09PT09PT09ICovDQoNCiAgdmFyIGRpc21pc3MgPSAnW2RhdGEtZGlzbWlzcz0iYWxlcnQiXScNCiAgICAsIEFsZXJ0ID0gZnVuY3Rpb24gKGVsKSB7DQogICAgICAgICQoZWwpLm9uKCdjbGljaycsIGRpc21pc3MsIHRoaXMuY2xvc2UpDQogICAgICB9DQoNCiAgQWxlcnQucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKGUpIHsNCiAgICB2YXIgJHRoaXMgPSAkKHRoaXMpDQogICAgICAsIHNlbGVjdG9yID0gJHRoaXMuYXR0cignZGF0YS10YXJnZXQnKQ0KICAgICAgLCAkcGFyZW50DQoNCiAgICBpZiAoIXNlbGVjdG9yKSB7DQogICAgICBzZWxlY3RvciA9ICR0aGlzLmF0dHIoJ2hyZWYnKQ0KICAgICAgc2VsZWN0b3IgPSBzZWxlY3RvciAmJiBzZWxlY3Rvci5yZXBsYWNlKC8uKig/PSNbXlxzXSokKS8sICcnKSAvL3N0cmlwIGZvciBpZTcNCiAgICB9DQoNCiAgICAkcGFyZW50ID0gJChzZWxlY3RvcikNCg0KICAgIGUgJiYgZS5wcmV2ZW50RGVmYXVsdCgpDQoNCiAgICAkcGFyZW50Lmxlbmd0aCB8fCAoJHBhcmVudCA9ICR0aGlzLmhhc0NsYXNzKCdhbGVydCcpID8gJHRoaXMgOiAkdGhpcy5wYXJlbnQoKSkNCg0KICAgICRwYXJlbnQudHJpZ2dlcihlID0gJC5FdmVudCgnY2xvc2UnKSkNCg0KICAgIGlmIChlLmlzRGVmYXVsdFByZXZlbnRlZCgpKSByZXR1cm4NCg0KICAgICRwYXJlbnQucmVtb3ZlQ2xhc3MoJ2luJykNCg0KICAgIGZ1bmN0aW9uIHJlbW92ZUVsZW1lbnQoKSB7DQogICAgICAkcGFyZW50DQogICAgICAgIC50cmlnZ2VyKCdjbG9zZWQnKQ0KICAgICAgICAucmVtb3ZlKCkNCiAgICB9DQoNCiAgICAkLnN1cHBvcnQudHJhbnNpdGlvbiAmJiAkcGFyZW50Lmhhc0NsYXNzKCdmYWRlJykgPw0KICAgICAgJHBhcmVudC5vbigkLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsIHJlbW92ZUVsZW1lbnQpIDoNCiAgICAgIHJlbW92ZUVsZW1lbnQoKQ0KICB9DQoNCg0KIC8qIEFMRVJUIFBMVUdJTiBERUZJTklUSU9ODQogICogPT09PT09PT09PT09PT09PT09PT09PT0gKi8NCg0KICAkLmZuLmFsZXJ0ID0gZnVuY3Rpb24gKG9wdGlvbikgew0KICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgew0KICAgICAgdmFyICR0aGlzID0gJCh0aGlzKQ0KICAgICAgICAsIGRhdGEgPSAkdGhpcy5kYXRhKCdhbGVydCcpDQogICAgICBpZiAoIWRhdGEpICR0aGlzLmRhdGEoJ2FsZXJ0JywgKGRhdGEgPSBuZXcgQWxlcnQodGhpcykpKQ0KICAgICAgaWYgKHR5cGVvZiBvcHRpb24gPT0gJ3N0cmluZycpIGRhdGFbb3B0aW9uXS5jYWxsKCR0aGlzKQ0KICAgIH0pDQogIH0NCg0KICAkLmZuLmFsZXJ0LkNvbnN0cnVjdG9yID0gQWxlcnQNCg0KDQogLyogQUxFUlQgREFUQS1BUEkNCiAgKiA9PT09PT09PT09PT09PSAqLw0KDQogICQoZnVuY3Rpb24gKCkgew0KICAgICQoJ2JvZHknKS5vbignY2xpY2suYWxlcnQuZGF0YS1hcGknLCBkaXNtaXNzLCBBbGVydC5wcm90b3R5cGUuY2xvc2UpDQogIH0pDQoNCn0od2luZG93LmpRdWVyeSk7LyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogKiBib290c3RyYXAtYnV0dG9uLmpzIHYyLjEuMQ0KICogaHR0cDovL3R3aXR0ZXIuZ2l0aHViLmNvbS9ib290c3RyYXAvamF2YXNjcmlwdC5odG1sI2J1dHRvbnMNCiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICogQ29weXJpZ2h0IDIwMTIgVHdpdHRlciwgSW5jLg0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8NCg0KDQohZnVuY3Rpb24gKCQpIHsNCg0KICAidXNlIHN0cmljdCI7IC8vIGpzaGludCA7XzsNCg0KDQogLyogQlVUVE9OIFBVQkxJQyBDTEFTUyBERUZJTklUSU9ODQogICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovDQoNCiAgdmFyIEJ1dHRvbiA9IGZ1bmN0aW9uIChlbGVtZW50LCBvcHRpb25zKSB7DQogICAgdGhpcy4kZWxlbWVudCA9ICQoZWxlbWVudCkNCiAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgJC5mbi5idXR0b24uZGVmYXVsdHMsIG9wdGlvbnMpDQogIH0NCg0KICBCdXR0b24ucHJvdG90eXBlLnNldFN0YXRlID0gZnVuY3Rpb24gKHN0YXRlKSB7DQogICAgdmFyIGQgPSAnZGlzYWJsZWQnDQogICAgICAsICRlbCA9IHRoaXMuJGVsZW1lbnQNCiAgICAgICwgZGF0YSA9ICRlbC5kYXRhKCkNCiAgICAgICwgdmFsID0gJGVsLmlzKCdpbnB1dCcpID8gJ3ZhbCcgOiAnaHRtbCcNCg0KICAgIHN0YXRlID0gc3RhdGUgKyAnVGV4dCcNCiAgICBkYXRhLnJlc2V0VGV4dCB8fCAkZWwuZGF0YSgncmVzZXRUZXh0JywgJGVsW3ZhbF0oKSkNCg0KICAgICRlbFt2YWxdKGRhdGFbc3RhdGVdIHx8IHRoaXMub3B0aW9uc1tzdGF0ZV0pDQoNCiAgICAvLyBwdXNoIHRvIGV2ZW50IGxvb3AgdG8gYWxsb3cgZm9ybXMgdG8gc3VibWl0DQogICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQogICAgICBzdGF0ZSA9PSAnbG9hZGluZ1RleHQnID8NCiAgICAgICAgJGVsLmFkZENsYXNzKGQpLmF0dHIoZCwgZCkgOg0KICAgICAgICAkZWwucmVtb3ZlQ2xhc3MoZCkucmVtb3ZlQXR0cihkKQ0KICAgIH0sIDApDQogIH0NCg0KICBCdXR0b24ucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgJHBhcmVudCA9IHRoaXMuJGVsZW1lbnQuY2xvc2VzdCgnW2RhdGEtdG9nZ2xlPSJidXR0b25zLXJhZGlvIl0nKQ0KDQogICAgJHBhcmVudCAmJiAkcGFyZW50DQogICAgICAuZmluZCgnLmFjdGl2ZScpDQogICAgICAucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpDQoNCiAgICB0aGlzLiRlbGVtZW50LnRvZ2dsZUNsYXNzKCdhY3RpdmUnKQ0KICB9DQoNCg0KIC8qIEJVVFRPTiBQTFVHSU4gREVGSU5JVElPTg0KICAqID09PT09PT09PT09PT09PT09PT09PT09PSAqLw0KDQogICQuZm4uYnV0dG9uID0gZnVuY3Rpb24gKG9wdGlvbikgew0KICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgew0KICAgICAgdmFyICR0aGlzID0gJCh0aGlzKQ0KICAgICAgICAsIGRhdGEgPSAkdGhpcy5kYXRhKCdidXR0b24nKQ0KICAgICAgICAsIG9wdGlvbnMgPSB0eXBlb2Ygb3B0aW9uID09ICdvYmplY3QnICYmIG9wdGlvbg0KICAgICAgaWYgKCFkYXRhKSAkdGhpcy5kYXRhKCdidXR0b24nLCAoZGF0YSA9IG5ldyBCdXR0b24odGhpcywgb3B0aW9ucykpKQ0KICAgICAgaWYgKG9wdGlvbiA9PSAndG9nZ2xlJykgZGF0YS50b2dnbGUoKQ0KICAgICAgZWxzZSBpZiAob3B0aW9uKSBkYXRhLnNldFN0YXRlKG9wdGlvbikNCiAgICB9KQ0KICB9DQoNCiAgJC5mbi5idXR0b24uZGVmYXVsdHMgPSB7DQogICAgbG9hZGluZ1RleHQ6ICdsb2FkaW5nLi4uJw0KICB9DQoNCiAgJC5mbi5idXR0b24uQ29uc3RydWN0b3IgPSBCdXR0b24NCg0KDQogLyogQlVUVE9OIERBVEEtQVBJDQogICogPT09PT09PT09PT09PT09ICovDQoNCiAgJChmdW5jdGlvbiAoKSB7DQogICAgJCgnYm9keScpLm9uKCdjbGljay5idXR0b24uZGF0YS1hcGknLCAnW2RhdGEtdG9nZ2xlXj1idXR0b25dJywgZnVuY3Rpb24gKCBlICkgew0KICAgICAgdmFyICRidG4gPSAkKGUudGFyZ2V0KQ0KICAgICAgaWYgKCEkYnRuLmhhc0NsYXNzKCdidG4nKSkgJGJ0biA9ICRidG4uY2xvc2VzdCgnLmJ0bicpDQogICAgICAkYnRuLmJ1dHRvbigndG9nZ2xlJykNCiAgICB9KQ0KICB9KQ0KDQp9KHdpbmRvdy5qUXVlcnkpOy8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAqIGJvb3RzdHJhcC1jYXJvdXNlbC5qcyB2Mi4xLjENCiAqIGh0dHA6Ly90d2l0dGVyLmdpdGh1Yi5jb20vYm9vdHN0cmFwL2phdmFzY3JpcHQuaHRtbCNjYXJvdXNlbA0KICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICogQ29weXJpZ2h0IDIwMTIgVHdpdHRlciwgSW5jLg0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovDQoNCg0KIWZ1bmN0aW9uICgkKSB7DQoNCiAgInVzZSBzdHJpY3QiOyAvLyBqc2hpbnQgO187DQoNCg0KIC8qIENBUk9VU0VMIENMQVNTIERFRklOSVRJT04NCiAgKiA9PT09PT09PT09PT09PT09PT09PT09PT09ICovDQoNCiAgdmFyIENhcm91c2VsID0gZnVuY3Rpb24gKGVsZW1lbnQsIG9wdGlvbnMpIHsNCiAgICB0aGlzLiRlbGVtZW50ID0gJChlbGVtZW50KQ0KICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnMNCiAgICB0aGlzLm9wdGlvbnMuc2xpZGUgJiYgdGhpcy5zbGlkZSh0aGlzLm9wdGlvbnMuc2xpZGUpDQogICAgdGhpcy5vcHRpb25zLnBhdXNlID09ICdob3ZlcicgJiYgdGhpcy4kZWxlbWVudA0KICAgICAgLm9uKCdtb3VzZWVudGVyJywgJC5wcm94eSh0aGlzLnBhdXNlLCB0aGlzKSkNCiAgICAgIC5vbignbW91c2VsZWF2ZScsICQucHJveHkodGhpcy5jeWNsZSwgdGhpcykpDQogIH0NCg0KICBDYXJvdXNlbC5wcm90b3R5cGUgPSB7DQoNCiAgICBjeWNsZTogZnVuY3Rpb24gKGUpIHsNCiAgICAgIGlmICghZSkgdGhpcy5wYXVzZWQgPSBmYWxzZQ0KICAgICAgdGhpcy5vcHRpb25zLmludGVydmFsDQogICAgICAgICYmICF0aGlzLnBhdXNlZA0KICAgICAgICAmJiAodGhpcy5pbnRlcnZhbCA9IHNldEludGVydmFsKCQucHJveHkodGhpcy5uZXh0LCB0aGlzKSwgdGhpcy5vcHRpb25zLmludGVydmFsKSkNCiAgICAgIHJldHVybiB0aGlzDQogICAgfQ0KDQogICwgdG86IGZ1bmN0aW9uIChwb3MpIHsNCiAgICAgIHZhciAkYWN0aXZlID0gdGhpcy4kZWxlbWVudC5maW5kKCcuaXRlbS5hY3RpdmUnKQ0KICAgICAgICAsIGNoaWxkcmVuID0gJGFjdGl2ZS5wYXJlbnQoKS5jaGlsZHJlbigpDQogICAgICAgICwgYWN0aXZlUG9zID0gY2hpbGRyZW4uaW5kZXgoJGFjdGl2ZSkNCiAgICAgICAgLCB0aGF0ID0gdGhpcw0KDQogICAgICBpZiAocG9zID4gKGNoaWxkcmVuLmxlbmd0aCAtIDEpIHx8IHBvcyA8IDApIHJldHVybg0KDQogICAgICBpZiAodGhpcy5zbGlkaW5nKSB7DQogICAgICAgIHJldHVybiB0aGlzLiRlbGVtZW50Lm9uZSgnc2xpZCcsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICB0aGF0LnRvKHBvcykNCiAgICAgICAgfSkNCiAgICAgIH0NCg0KICAgICAgaWYgKGFjdGl2ZVBvcyA9PSBwb3MpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMucGF1c2UoKS5jeWNsZSgpDQogICAgICB9DQoNCiAgICAgIHJldHVybiB0aGlzLnNsaWRlKHBvcyA+IGFjdGl2ZVBvcyA/ICduZXh0JyA6ICdwcmV2JywgJChjaGlsZHJlbltwb3NdKSkNCiAgICB9DQoNCiAgLCBwYXVzZTogZnVuY3Rpb24gKGUpIHsNCiAgICAgIGlmICghZSkgdGhpcy5wYXVzZWQgPSB0cnVlDQogICAgICBpZiAodGhpcy4kZWxlbWVudC5maW5kKCcubmV4dCwgLnByZXYnKS5sZW5ndGggJiYgJC5zdXBwb3J0LnRyYW5zaXRpb24uZW5kKSB7DQogICAgICAgIHRoaXMuJGVsZW1lbnQudHJpZ2dlcigkLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQpDQogICAgICAgIHRoaXMuY3ljbGUoKQ0KICAgICAgfQ0KICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsKQ0KICAgICAgdGhpcy5pbnRlcnZhbCA9IG51bGwNCiAgICAgIHJldHVybiB0aGlzDQogICAgfQ0KDQogICwgbmV4dDogZnVuY3Rpb24gKCkgew0KICAgICAgaWYgKHRoaXMuc2xpZGluZykgcmV0dXJuDQogICAgICByZXR1cm4gdGhpcy5zbGlkZSgnbmV4dCcpDQogICAgfQ0KDQogICwgcHJldjogZnVuY3Rpb24gKCkgew0KICAgICAgaWYgKHRoaXMuc2xpZGluZykgcmV0dXJuDQogICAgICByZXR1cm4gdGhpcy5zbGlkZSgncHJldicpDQogICAgfQ0KDQogICwgc2xpZGU6IGZ1bmN0aW9uICh0eXBlLCBuZXh0KSB7DQogICAgICB2YXIgJGFjdGl2ZSA9IHRoaXMuJGVsZW1lbnQuZmluZCgnLml0ZW0uYWN0aXZlJykNCiAgICAgICAgLCAkbmV4dCA9IG5leHQgfHwgJGFjdGl2ZVt0eXBlXSgpDQogICAgICAgICwgaXNDeWNsaW5nID0gdGhpcy5pbnRlcnZhbA0KICAgICAgICAsIGRpcmVjdGlvbiA9IHR5cGUgPT0gJ25leHQnID8gJ2xlZnQnIDogJ3JpZ2h0Jw0KICAgICAgICAsIGZhbGxiYWNrICA9IHR5cGUgPT0gJ25leHQnID8gJ2ZpcnN0JyA6ICdsYXN0Jw0KICAgICAgICAsIHRoYXQgPSB0aGlzDQogICAgICAgICwgZSA9ICQuRXZlbnQoJ3NsaWRlJywgew0KICAgICAgICAgICAgcmVsYXRlZFRhcmdldDogJG5leHRbMF0NCiAgICAgICAgICB9KQ0KDQogICAgICB0aGlzLnNsaWRpbmcgPSB0cnVlDQoNCiAgICAgIGlzQ3ljbGluZyAmJiB0aGlzLnBhdXNlKCkNCg0KICAgICAgJG5leHQgPSAkbmV4dC5sZW5ndGggPyAkbmV4dCA6IHRoaXMuJGVsZW1lbnQuZmluZCgnLml0ZW0nKVtmYWxsYmFja10oKQ0KDQogICAgICBpZiAoJG5leHQuaGFzQ2xhc3MoJ2FjdGl2ZScpKSByZXR1cm4NCg0KICAgICAgaWYgKCQuc3VwcG9ydC50cmFuc2l0aW9uICYmIHRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoJ3NsaWRlJykpIHsNCiAgICAgICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKGUpDQogICAgICAgIGlmIChlLmlzRGVmYXVsdFByZXZlbnRlZCgpKSByZXR1cm4NCiAgICAgICAgJG5leHQuYWRkQ2xhc3ModHlwZSkNCiAgICAgICAgJG5leHRbMF0ub2Zmc2V0V2lkdGggLy8gZm9yY2UgcmVmbG93DQogICAgICAgICRhY3RpdmUuYWRkQ2xhc3MoZGlyZWN0aW9uKQ0KICAgICAgICAkbmV4dC5hZGRDbGFzcyhkaXJlY3Rpb24pDQogICAgICAgIHRoaXMuJGVsZW1lbnQub25lKCQuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICRuZXh0LnJlbW92ZUNsYXNzKFt0eXBlLCBkaXJlY3Rpb25dLmpvaW4oJyAnKSkuYWRkQ2xhc3MoJ2FjdGl2ZScpDQogICAgICAgICAgJGFjdGl2ZS5yZW1vdmVDbGFzcyhbJ2FjdGl2ZScsIGRpcmVjdGlvbl0uam9pbignICcpKQ0KICAgICAgICAgIHRoYXQuc2xpZGluZyA9IGZhbHNlDQogICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHRoYXQuJGVsZW1lbnQudHJpZ2dlcignc2xpZCcpIH0sIDApDQogICAgICAgIH0pDQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLiRlbGVtZW50LnRyaWdnZXIoZSkNCiAgICAgICAgaWYgKGUuaXNEZWZhdWx0UHJldmVudGVkKCkpIHJldHVybg0KICAgICAgICAkYWN0aXZlLnJlbW92ZUNsYXNzKCdhY3RpdmUnKQ0KICAgICAgICAkbmV4dC5hZGRDbGFzcygnYWN0aXZlJykNCiAgICAgICAgdGhpcy5zbGlkaW5nID0gZmFsc2UNCiAgICAgICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKCdzbGlkJykNCiAgICAgIH0NCg0KICAgICAgaXNDeWNsaW5nICYmIHRoaXMuY3ljbGUoKQ0KDQogICAgICByZXR1cm4gdGhpcw0KICAgIH0NCg0KICB9DQoNCg0KIC8qIENBUk9VU0VMIFBMVUdJTiBERUZJTklUSU9ODQogICogPT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8NCg0KICAkLmZuLmNhcm91c2VsID0gZnVuY3Rpb24gKG9wdGlvbikgew0KICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgew0KICAgICAgdmFyICR0aGlzID0gJCh0aGlzKQ0KICAgICAgICAsIGRhdGEgPSAkdGhpcy5kYXRhKCdjYXJvdXNlbCcpDQogICAgICAgICwgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCAkLmZuLmNhcm91c2VsLmRlZmF1bHRzLCB0eXBlb2Ygb3B0aW9uID09ICdvYmplY3QnICYmIG9wdGlvbikNCiAgICAgICAgLCBhY3Rpb24gPSB0eXBlb2Ygb3B0aW9uID09ICdzdHJpbmcnID8gb3B0aW9uIDogb3B0aW9ucy5zbGlkZQ0KICAgICAgaWYgKCFkYXRhKSAkdGhpcy5kYXRhKCdjYXJvdXNlbCcsIChkYXRhID0gbmV3IENhcm91c2VsKHRoaXMsIG9wdGlvbnMpKSkNCiAgICAgIGlmICh0eXBlb2Ygb3B0aW9uID09ICdudW1iZXInKSBkYXRhLnRvKG9wdGlvbikNCiAgICAgIGVsc2UgaWYgKGFjdGlvbikgZGF0YVthY3Rpb25dKCkNCiAgICAgIGVsc2UgaWYgKG9wdGlvbnMuaW50ZXJ2YWwpIGRhdGEuY3ljbGUoKQ0KICAgIH0pDQogIH0NCg0KICAkLmZuLmNhcm91c2VsLmRlZmF1bHRzID0gew0KICAgIGludGVydmFsOiA1MDAwDQogICwgcGF1c2U6ICdob3ZlcicNCiAgfQ0KDQogICQuZm4uY2Fyb3VzZWwuQ29uc3RydWN0b3IgPSBDYXJvdXNlbA0KDQoNCiAvKiBDQVJPVVNFTCBEQVRBLUFQSQ0KICAqID09PT09PT09PT09PT09PT09ICovDQoNCiAgJChmdW5jdGlvbiAoKSB7DQogICAgJCgnYm9keScpLm9uKCdjbGljay5jYXJvdXNlbC5kYXRhLWFwaScsICdbZGF0YS1zbGlkZV0nLCBmdW5jdGlvbiAoIGUgKSB7DQogICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLCBocmVmDQogICAgICAgICwgJHRhcmdldCA9ICQoJHRoaXMuYXR0cignZGF0YS10YXJnZXQnKSB8fCAoaHJlZiA9ICR0aGlzLmF0dHIoJ2hyZWYnKSkgJiYgaHJlZi5yZXBsYWNlKC8uKig/PSNbXlxzXSskKS8sICcnKSkgLy9zdHJpcCBmb3IgaWU3DQogICAgICAgICwgb3B0aW9ucyA9ICEkdGFyZ2V0LmRhdGEoJ21vZGFsJykgJiYgJC5leHRlbmQoe30sICR0YXJnZXQuZGF0YSgpLCAkdGhpcy5kYXRhKCkpDQogICAgICAkdGFyZ2V0LmNhcm91c2VsKG9wdGlvbnMpDQogICAgICBlLnByZXZlbnREZWZhdWx0KCkNCiAgICB9KQ0KICB9KQ0KDQp9KHdpbmRvdy5qUXVlcnkpOy8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAqIGJvb3RzdHJhcC1jb2xsYXBzZS5qcyB2Mi4xLjENCiAqIGh0dHA6Ly90d2l0dGVyLmdpdGh1Yi5jb20vYm9vdHN0cmFwL2phdmFzY3JpcHQuaHRtbCNjb2xsYXBzZQ0KICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICogQ29weXJpZ2h0IDIwMTIgVHdpdHRlciwgSW5jLg0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8NCg0KDQohZnVuY3Rpb24gKCQpIHsNCg0KICAidXNlIHN0cmljdCI7IC8vIGpzaGludCA7XzsNCg0KDQogLyogQ09MTEFQU0UgUFVCTElDIENMQVNTIERFRklOSVRJT04NCiAgKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLw0KDQogIHZhciBDb2xsYXBzZSA9IGZ1bmN0aW9uIChlbGVtZW50LCBvcHRpb25zKSB7DQogICAgdGhpcy4kZWxlbWVudCA9ICQoZWxlbWVudCkNCiAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgJC5mbi5jb2xsYXBzZS5kZWZhdWx0cywgb3B0aW9ucykNCg0KICAgIGlmICh0aGlzLm9wdGlvbnMucGFyZW50KSB7DQogICAgICB0aGlzLiRwYXJlbnQgPSAkKHRoaXMub3B0aW9ucy5wYXJlbnQpDQogICAgfQ0KDQogICAgdGhpcy5vcHRpb25zLnRvZ2dsZSAmJiB0aGlzLnRvZ2dsZSgpDQogIH0NCg0KICBDb2xsYXBzZS5wcm90b3R5cGUgPSB7DQoNCiAgICBjb25zdHJ1Y3RvcjogQ29sbGFwc2UNCg0KICAsIGRpbWVuc2lvbjogZnVuY3Rpb24gKCkgew0KICAgICAgdmFyIGhhc1dpZHRoID0gdGhpcy4kZWxlbWVudC5oYXNDbGFzcygnd2lkdGgnKQ0KICAgICAgcmV0dXJuIGhhc1dpZHRoID8gJ3dpZHRoJyA6ICdoZWlnaHQnDQogICAgfQ0KDQogICwgc2hvdzogZnVuY3Rpb24gKCkgew0KICAgICAgdmFyIGRpbWVuc2lvbg0KICAgICAgICAsIHNjcm9sbA0KICAgICAgICAsIGFjdGl2ZXMNCiAgICAgICAgLCBoYXNEYXRhDQoNCiAgICAgIGlmICh0aGlzLnRyYW5zaXRpb25pbmcpIHJldHVybg0KDQogICAgICBkaW1lbnNpb24gPSB0aGlzLmRpbWVuc2lvbigpDQogICAgICBzY3JvbGwgPSAkLmNhbWVsQ2FzZShbJ3Njcm9sbCcsIGRpbWVuc2lvbl0uam9pbignLScpKQ0KICAgICAgYWN0aXZlcyA9IHRoaXMuJHBhcmVudCAmJiB0aGlzLiRwYXJlbnQuZmluZCgnPiAuYWNjb3JkaW9uLWdyb3VwID4gLmluJykNCg0KICAgICAgaWYgKGFjdGl2ZXMgJiYgYWN0aXZlcy5sZW5ndGgpIHsNCiAgICAgICAgaGFzRGF0YSA9IGFjdGl2ZXMuZGF0YSgnY29sbGFwc2UnKQ0KICAgICAgICBpZiAoaGFzRGF0YSAmJiBoYXNEYXRhLnRyYW5zaXRpb25pbmcpIHJldHVybg0KICAgICAgICBhY3RpdmVzLmNvbGxhcHNlKCdoaWRlJykNCiAgICAgICAgaGFzRGF0YSB8fCBhY3RpdmVzLmRhdGEoJ2NvbGxhcHNlJywgbnVsbCkNCiAgICAgIH0NCg0KICAgICAgdGhpcy4kZWxlbWVudFtkaW1lbnNpb25dKDApDQogICAgICB0aGlzLnRyYW5zaXRpb24oJ2FkZENsYXNzJywgJC5FdmVudCgnc2hvdycpLCAnc2hvd24nKQ0KICAgICAgJC5zdXBwb3J0LnRyYW5zaXRpb24gJiYgdGhpcy4kZWxlbWVudFtkaW1lbnNpb25dKHRoaXMuJGVsZW1lbnRbMF1bc2Nyb2xsXSkNCiAgICB9DQoNCiAgLCBoaWRlOiBmdW5jdGlvbiAoKSB7DQogICAgICB2YXIgZGltZW5zaW9uDQogICAgICBpZiAodGhpcy50cmFuc2l0aW9uaW5nKSByZXR1cm4NCiAgICAgIGRpbWVuc2lvbiA9IHRoaXMuZGltZW5zaW9uKCkNCiAgICAgIHRoaXMucmVzZXQodGhpcy4kZWxlbWVudFtkaW1lbnNpb25dKCkpDQogICAgICB0aGlzLnRyYW5zaXRpb24oJ3JlbW92ZUNsYXNzJywgJC5FdmVudCgnaGlkZScpLCAnaGlkZGVuJykNCiAgICAgIHRoaXMuJGVsZW1lbnRbZGltZW5zaW9uXSgwKQ0KICAgIH0NCg0KICAsIHJlc2V0OiBmdW5jdGlvbiAoc2l6ZSkgew0KICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuZGltZW5zaW9uKCkNCg0KICAgICAgdGhpcy4kZWxlbWVudA0KICAgICAgICAucmVtb3ZlQ2xhc3MoJ2NvbGxhcHNlJykNCiAgICAgICAgW2RpbWVuc2lvbl0oc2l6ZSB8fCAnYXV0bycpDQogICAgICAgIFswXS5vZmZzZXRXaWR0aA0KDQogICAgICB0aGlzLiRlbGVtZW50W3NpemUgIT09IG51bGwgPyAnYWRkQ2xhc3MnIDogJ3JlbW92ZUNsYXNzJ10oJ2NvbGxhcHNlJykNCg0KICAgICAgcmV0dXJuIHRoaXMNCiAgICB9DQoNCiAgLCB0cmFuc2l0aW9uOiBmdW5jdGlvbiAobWV0aG9kLCBzdGFydEV2ZW50LCBjb21wbGV0ZUV2ZW50KSB7DQogICAgICB2YXIgdGhhdCA9IHRoaXMNCiAgICAgICAgLCBjb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGlmIChzdGFydEV2ZW50LnR5cGUgPT0gJ3Nob3cnKSB0aGF0LnJlc2V0KCkNCiAgICAgICAgICAgIHRoYXQudHJhbnNpdGlvbmluZyA9IDANCiAgICAgICAgICAgIHRoYXQuJGVsZW1lbnQudHJpZ2dlcihjb21wbGV0ZUV2ZW50KQ0KICAgICAgICAgIH0NCg0KICAgICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKHN0YXJ0RXZlbnQpDQoNCiAgICAgIGlmIChzdGFydEV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpKSByZXR1cm4NCg0KICAgICAgdGhpcy50cmFuc2l0aW9uaW5nID0gMQ0KDQogICAgICB0aGlzLiRlbGVtZW50W21ldGhvZF0oJ2luJykNCg0KICAgICAgJC5zdXBwb3J0LnRyYW5zaXRpb24gJiYgdGhpcy4kZWxlbWVudC5oYXNDbGFzcygnY29sbGFwc2UnKSA/DQogICAgICAgIHRoaXMuJGVsZW1lbnQub25lKCQuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCwgY29tcGxldGUpIDoNCiAgICAgICAgY29tcGxldGUoKQ0KICAgIH0NCg0KICAsIHRvZ2dsZTogZnVuY3Rpb24gKCkgew0KICAgICAgdGhpc1t0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCdpbicpID8gJ2hpZGUnIDogJ3Nob3cnXSgpDQogICAgfQ0KDQogIH0NCg0KDQogLyogQ09MTEFQU0lCTEUgUExVR0lOIERFRklOSVRJT04NCiAgKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8NCg0KICAkLmZuLmNvbGxhcHNlID0gZnVuY3Rpb24gKG9wdGlvbikgew0KICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgew0KICAgICAgdmFyICR0aGlzID0gJCh0aGlzKQ0KICAgICAgICAsIGRhdGEgPSAkdGhpcy5kYXRhKCdjb2xsYXBzZScpDQogICAgICAgICwgb3B0aW9ucyA9IHR5cGVvZiBvcHRpb24gPT0gJ29iamVjdCcgJiYgb3B0aW9uDQogICAgICBpZiAoIWRhdGEpICR0aGlzLmRhdGEoJ2NvbGxhcHNlJywgKGRhdGEgPSBuZXcgQ29sbGFwc2UodGhpcywgb3B0aW9ucykpKQ0KICAgICAgaWYgKHR5cGVvZiBvcHRpb24gPT0gJ3N0cmluZycpIGRhdGFbb3B0aW9uXSgpDQogICAgfSkNCiAgfQ0KDQogICQuZm4uY29sbGFwc2UuZGVmYXVsdHMgPSB7DQogICAgdG9nZ2xlOiB0cnVlDQogIH0NCg0KICAkLmZuLmNvbGxhcHNlLkNvbnN0cnVjdG9yID0gQ29sbGFwc2UNCg0KDQogLyogQ09MTEFQU0lCTEUgREFUQS1BUEkNCiAgKiA9PT09PT09PT09PT09PT09PT09PSAqLw0KDQogICQoZnVuY3Rpb24gKCkgew0KICAgICQoJ2JvZHknKS5vbignY2xpY2suY29sbGFwc2UuZGF0YS1hcGknLCAnW2RhdGEtdG9nZ2xlPWNvbGxhcHNlXScsIGZ1bmN0aW9uIChlKSB7DQogICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLCBocmVmDQogICAgICAgICwgdGFyZ2V0ID0gJHRoaXMuYXR0cignZGF0YS10YXJnZXQnKQ0KICAgICAgICAgIHx8IGUucHJldmVudERlZmF1bHQoKQ0KICAgICAgICAgIHx8IChocmVmID0gJHRoaXMuYXR0cignaHJlZicpKSAmJiBocmVmLnJlcGxhY2UoLy4qKD89I1teXHNdKyQpLywgJycpIC8vc3RyaXAgZm9yIGllNw0KICAgICAgICAsIG9wdGlvbiA9ICQodGFyZ2V0KS5kYXRhKCdjb2xsYXBzZScpID8gJ3RvZ2dsZScgOiAkdGhpcy5kYXRhKCkNCiAgICAgICR0aGlzWyQodGFyZ2V0KS5oYXNDbGFzcygnaW4nKSA/ICdhZGRDbGFzcycgOiAncmVtb3ZlQ2xhc3MnXSgnY29sbGFwc2VkJykNCiAgICAgICQodGFyZ2V0KS5jb2xsYXBzZShvcHRpb24pDQogICAgfSkNCiAgfSkNCg0KfSh3aW5kb3cualF1ZXJ5KTsvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAqIGJvb3RzdHJhcC1kcm9wZG93bi5qcyB2Mi4xLjENCiAqIGh0dHA6Ly90d2l0dGVyLmdpdGh1Yi5jb20vYm9vdHN0cmFwL2phdmFzY3JpcHQuaHRtbCNkcm9wZG93bnMNCiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICogQ29weXJpZ2h0IDIwMTIgVHdpdHRlciwgSW5jLg0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8NCg0KDQohZnVuY3Rpb24gKCQpIHsNCg0KICAidXNlIHN0cmljdCI7IC8vIGpzaGludCA7XzsNCg0KDQogLyogRFJPUERPV04gQ0xBU1MgREVGSU5JVElPTg0KICAqID09PT09PT09PT09PT09PT09PT09PT09PT0gKi8NCg0KICB2YXIgdG9nZ2xlID0gJ1tkYXRhLXRvZ2dsZT1kcm9wZG93bl0nDQogICAgLCBEcm9wZG93biA9IGZ1bmN0aW9uIChlbGVtZW50KSB7DQogICAgICAgIHZhciAkZWwgPSAkKGVsZW1lbnQpLm9uKCdjbGljay5kcm9wZG93bi5kYXRhLWFwaScsIHRoaXMudG9nZ2xlKQ0KICAgICAgICAkKCdodG1sJykub24oJ2NsaWNrLmRyb3Bkb3duLmRhdGEtYXBpJywgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICRlbC5wYXJlbnQoKS5yZW1vdmVDbGFzcygnb3BlbicpDQogICAgICAgIH0pDQogICAgICB9DQoNCiAgRHJvcGRvd24ucHJvdG90eXBlID0gew0KDQogICAgY29uc3RydWN0b3I6IERyb3Bkb3duDQoNCiAgLCB0b2dnbGU6IGZ1bmN0aW9uIChlKSB7DQogICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpDQogICAgICAgICwgJHBhcmVudA0KICAgICAgICAsIGlzQWN0aXZlDQoNCiAgICAgIGlmICgkdGhpcy5pcygnLmRpc2FibGVkLCA6ZGlzYWJsZWQnKSkgcmV0dXJuDQoNCiAgICAgICRwYXJlbnQgPSBnZXRQYXJlbnQoJHRoaXMpDQoNCiAgICAgIGlzQWN0aXZlID0gJHBhcmVudC5oYXNDbGFzcygnb3BlbicpDQoNCiAgICAgIGNsZWFyTWVudXMoKQ0KDQogICAgICBpZiAoIWlzQWN0aXZlKSB7DQogICAgICAgICRwYXJlbnQudG9nZ2xlQ2xhc3MoJ29wZW4nKQ0KICAgICAgICAkdGhpcy5mb2N1cygpDQogICAgICB9DQoNCiAgICAgIHJldHVybiBmYWxzZQ0KICAgIH0NCg0KICAsIGtleWRvd246IGZ1bmN0aW9uIChlKSB7DQogICAgICB2YXIgJHRoaXMNCiAgICAgICAgLCAkaXRlbXMNCiAgICAgICAgLCAkYWN0aXZlDQogICAgICAgICwgJHBhcmVudA0KICAgICAgICAsIGlzQWN0aXZlDQogICAgICAgICwgaW5kZXgNCg0KICAgICAgaWYgKCEvKDM4fDQwfDI3KS8udGVzdChlLmtleUNvZGUpKSByZXR1cm4NCg0KICAgICAgJHRoaXMgPSAkKHRoaXMpDQoNCiAgICAgIGUucHJldmVudERlZmF1bHQoKQ0KICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKQ0KDQogICAgICBpZiAoJHRoaXMuaXMoJy5kaXNhYmxlZCwgOmRpc2FibGVkJykpIHJldHVybg0KDQogICAgICAkcGFyZW50ID0gZ2V0UGFyZW50KCR0aGlzKQ0KDQogICAgICBpc0FjdGl2ZSA9ICRwYXJlbnQuaGFzQ2xhc3MoJ29wZW4nKQ0KDQogICAgICBpZiAoIWlzQWN0aXZlIHx8IChpc0FjdGl2ZSAmJiBlLmtleUNvZGUgPT0gMjcpKSByZXR1cm4gJHRoaXMuY2xpY2soKQ0KDQogICAgICAkaXRlbXMgPSAkKCdbcm9sZT1tZW51XSBsaTpub3QoLmRpdmlkZXIpIGEnLCAkcGFyZW50KQ0KDQogICAgICBpZiAoISRpdGVtcy5sZW5ndGgpIHJldHVybg0KDQogICAgICBpbmRleCA9ICRpdGVtcy5pbmRleCgkaXRlbXMuZmlsdGVyKCc6Zm9jdXMnKSkNCg0KICAgICAgaWYgKGUua2V5Q29kZSA9PSAzOCAmJiBpbmRleCA+IDApIGluZGV4LS0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdXANCiAgICAgIGlmIChlLmtleUNvZGUgPT0gNDAgJiYgaW5kZXggPCAkaXRlbXMubGVuZ3RoIC0gMSkgaW5kZXgrKyAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRvd24NCiAgICAgIGlmICghfmluZGV4KSBpbmRleCA9IDANCg0KICAgICAgJGl0ZW1zDQogICAgICAgIC5lcShpbmRleCkNCiAgICAgICAgLmZvY3VzKCkNCiAgICB9DQoNCiAgfQ0KDQogIGZ1bmN0aW9uIGNsZWFyTWVudXMoKSB7DQogICAgZ2V0UGFyZW50KCQodG9nZ2xlKSkNCiAgICAgIC5yZW1vdmVDbGFzcygnb3BlbicpDQogIH0NCg0KICBmdW5jdGlvbiBnZXRQYXJlbnQoJHRoaXMpIHsNCiAgICB2YXIgc2VsZWN0b3IgPSAkdGhpcy5hdHRyKCdkYXRhLXRhcmdldCcpDQogICAgICAsICRwYXJlbnQNCg0KICAgIGlmICghc2VsZWN0b3IpIHsNCiAgICAgIHNlbGVjdG9yID0gJHRoaXMuYXR0cignaHJlZicpDQogICAgICBzZWxlY3RvciA9IHNlbGVjdG9yICYmIC8jLy50ZXN0KHNlbGVjdG9yKSAmJiBzZWxlY3Rvci5yZXBsYWNlKC8uKig/PSNbXlxzXSokKS8sICcnKSAvL3N0cmlwIGZvciBpZTcNCiAgICB9DQoNCiAgICAkcGFyZW50ID0gJChzZWxlY3RvcikNCiAgICAkcGFyZW50Lmxlbmd0aCB8fCAoJHBhcmVudCA9ICR0aGlzLnBhcmVudCgpKQ0KDQogICAgcmV0dXJuICRwYXJlbnQNCiAgfQ0KDQoNCiAgLyogRFJPUERPV04gUExVR0lOIERFRklOSVRJT04NCiAgICogPT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8NCg0KICAkLmZuLmRyb3Bkb3duID0gZnVuY3Rpb24gKG9wdGlvbikgew0KICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgew0KICAgICAgdmFyICR0aGlzID0gJCh0aGlzKQ0KICAgICAgICAsIGRhdGEgPSAkdGhpcy5kYXRhKCdkcm9wZG93bicpDQogICAgICBpZiAoIWRhdGEpICR0aGlzLmRhdGEoJ2Ryb3Bkb3duJywgKGRhdGEgPSBuZXcgRHJvcGRvd24odGhpcykpKQ0KICAgICAgaWYgKHR5cGVvZiBvcHRpb24gPT0gJ3N0cmluZycpIGRhdGFbb3B0aW9uXS5jYWxsKCR0aGlzKQ0KICAgIH0pDQogIH0NCg0KICAkLmZuLmRyb3Bkb3duLkNvbnN0cnVjdG9yID0gRHJvcGRvd24NCg0KDQogIC8qIEFQUExZIFRPIFNUQU5EQVJEIERST1BET1dOIEVMRU1FTlRTDQogICAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovDQoNCiAgJChmdW5jdGlvbiAoKSB7DQogICAgJCgnaHRtbCcpDQogICAgICAub24oJ2NsaWNrLmRyb3Bkb3duLmRhdGEtYXBpIHRvdWNoc3RhcnQuZHJvcGRvd24uZGF0YS1hcGknLCBjbGVhck1lbnVzKQ0KICAgICQoJ2JvZHknKQ0KICAgICAgLm9uKCdjbGljay5kcm9wZG93biB0b3VjaHN0YXJ0LmRyb3Bkb3duLmRhdGEtYXBpJywgJy5kcm9wZG93biBmb3JtJywgZnVuY3Rpb24gKGUpIHsgZS5zdG9wUHJvcGFnYXRpb24oKSB9KQ0KICAgICAgLm9uKCdjbGljay5kcm9wZG93bi5kYXRhLWFwaSB0b3VjaHN0YXJ0LmRyb3Bkb3duLmRhdGEtYXBpJyAgLCB0b2dnbGUsIERyb3Bkb3duLnByb3RvdHlwZS50b2dnbGUpDQogICAgICAub24oJ2tleWRvd24uZHJvcGRvd24uZGF0YS1hcGkgdG91Y2hzdGFydC5kcm9wZG93bi5kYXRhLWFwaScsIHRvZ2dsZSArICcsIFtyb2xlPW1lbnVdJyAsIERyb3Bkb3duLnByb3RvdHlwZS5rZXlkb3duKQ0KICB9KQ0KDQp9KHdpbmRvdy5qUXVlcnkpOy8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICogYm9vdHN0cmFwLW1vZGFsLmpzIHYyLjEuMQ0KICogaHR0cDovL3R3aXR0ZXIuZ2l0aHViLmNvbS9ib290c3RyYXAvamF2YXNjcmlwdC5odG1sI21vZGFscw0KICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogKiBDb3B5cmlnaHQgMjAxMiBUd2l0dGVyLCBJbmMuDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLw0KDQoNCiFmdW5jdGlvbiAoJCkgew0KDQogICJ1c2Ugc3RyaWN0IjsgLy8ganNoaW50IDtfOw0KDQoNCiAvKiBNT0RBTCBDTEFTUyBERUZJTklUSU9ODQogICogPT09PT09PT09PT09PT09PT09PT09PSAqLw0KDQogIHZhciBNb2RhbCA9IGZ1bmN0aW9uIChlbGVtZW50LCBvcHRpb25zKSB7DQogICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucw0KICAgIHRoaXMuJGVsZW1lbnQgPSAkKGVsZW1lbnQpDQogICAgICAuZGVsZWdhdGUoJ1tkYXRhLWRpc21pc3M9Im1vZGFsIl0nLCAnY2xpY2suZGlzbWlzcy5tb2RhbCcsICQucHJveHkodGhpcy5oaWRlLCB0aGlzKSkNCiAgICB0aGlzLm9wdGlvbnMucmVtb3RlICYmIHRoaXMuJGVsZW1lbnQuZmluZCgnLm1vZGFsLWJvZHknKS5sb2FkKHRoaXMub3B0aW9ucy5yZW1vdGUpDQogIH0NCg0KICBNb2RhbC5wcm90b3R5cGUgPSB7DQoNCiAgICAgIGNvbnN0cnVjdG9yOiBNb2RhbA0KDQogICAgLCB0b2dnbGU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXNbIXRoaXMuaXNTaG93biA/ICdzaG93JyA6ICdoaWRlJ10oKQ0KICAgICAgfQ0KDQogICAgLCBzaG93OiBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciB0aGF0ID0gdGhpcw0KICAgICAgICAgICwgZSA9ICQuRXZlbnQoJ3Nob3cnKQ0KDQogICAgICAgIHRoaXMuJGVsZW1lbnQudHJpZ2dlcihlKQ0KDQogICAgICAgIGlmICh0aGlzLmlzU2hvd24gfHwgZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgcmV0dXJuDQoNCiAgICAgICAgJCgnYm9keScpLmFkZENsYXNzKCdtb2RhbC1vcGVuJykNCg0KICAgICAgICB0aGlzLmlzU2hvd24gPSB0cnVlDQoNCiAgICAgICAgdGhpcy5lc2NhcGUoKQ0KDQogICAgICAgIHRoaXMuYmFja2Ryb3AoZnVuY3Rpb24gKCkgew0KICAgICAgICAgIHZhciB0cmFuc2l0aW9uID0gJC5zdXBwb3J0LnRyYW5zaXRpb24gJiYgdGhhdC4kZWxlbWVudC5oYXNDbGFzcygnZmFkZScpDQoNCiAgICAgICAgICBpZiAoIXRoYXQuJGVsZW1lbnQucGFyZW50KCkubGVuZ3RoKSB7DQogICAgICAgICAgICB0aGF0LiRlbGVtZW50LmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpIC8vZG9uJ3QgbW92ZSBtb2RhbHMgZG9tIHBvc2l0aW9uDQogICAgICAgICAgfQ0KDQogICAgICAgICAgdGhhdC4kZWxlbWVudA0KICAgICAgICAgICAgLnNob3coKQ0KDQogICAgICAgICAgaWYgKHRyYW5zaXRpb24pIHsNCiAgICAgICAgICAgIHRoYXQuJGVsZW1lbnRbMF0ub2Zmc2V0V2lkdGggLy8gZm9yY2UgcmVmbG93DQogICAgICAgICAgfQ0KDQogICAgICAgICAgdGhhdC4kZWxlbWVudA0KICAgICAgICAgICAgLmFkZENsYXNzKCdpbicpDQogICAgICAgICAgICAuYXR0cignYXJpYS1oaWRkZW4nLCBmYWxzZSkNCiAgICAgICAgICAgIC5mb2N1cygpDQoNCiAgICAgICAgICB0aGF0LmVuZm9yY2VGb2N1cygpDQoNCiAgICAgICAgICB0cmFuc2l0aW9uID8NCiAgICAgICAgICAgIHRoYXQuJGVsZW1lbnQub25lKCQuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCwgZnVuY3Rpb24gKCkgeyB0aGF0LiRlbGVtZW50LnRyaWdnZXIoJ3Nob3duJykgfSkgOg0KICAgICAgICAgICAgdGhhdC4kZWxlbWVudC50cmlnZ2VyKCdzaG93bicpDQoNCiAgICAgICAgfSkNCiAgICAgIH0NCg0KICAgICwgaGlkZTogZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgZSAmJiBlLnByZXZlbnREZWZhdWx0KCkNCg0KICAgICAgICB2YXIgdGhhdCA9IHRoaXMNCg0KICAgICAgICBlID0gJC5FdmVudCgnaGlkZScpDQoNCiAgICAgICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKGUpDQoNCiAgICAgICAgaWYgKCF0aGlzLmlzU2hvd24gfHwgZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgcmV0dXJuDQoNCiAgICAgICAgdGhpcy5pc1Nob3duID0gZmFsc2UNCg0KICAgICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ21vZGFsLW9wZW4nKQ0KDQogICAgICAgIHRoaXMuZXNjYXBlKCkNCg0KICAgICAgICAkKGRvY3VtZW50KS5vZmYoJ2ZvY3VzaW4ubW9kYWwnKQ0KDQogICAgICAgIHRoaXMuJGVsZW1lbnQNCiAgICAgICAgICAucmVtb3ZlQ2xhc3MoJ2luJykNCiAgICAgICAgICAuYXR0cignYXJpYS1oaWRkZW4nLCB0cnVlKQ0KDQogICAgICAgICQuc3VwcG9ydC50cmFuc2l0aW9uICYmIHRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoJ2ZhZGUnKSA/DQogICAgICAgICAgdGhpcy5oaWRlV2l0aFRyYW5zaXRpb24oKSA6DQogICAgICAgICAgdGhpcy5oaWRlTW9kYWwoKQ0KICAgICAgfQ0KDQogICAgLCBlbmZvcmNlRm9jdXM6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIHRoYXQgPSB0aGlzDQogICAgICAgICQoZG9jdW1lbnQpLm9uKCdmb2N1c2luLm1vZGFsJywgZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgICBpZiAodGhhdC4kZWxlbWVudFswXSAhPT0gZS50YXJnZXQgJiYgIXRoYXQuJGVsZW1lbnQuaGFzKGUudGFyZ2V0KS5sZW5ndGgpIHsNCiAgICAgICAgICAgIHRoYXQuJGVsZW1lbnQuZm9jdXMoKQ0KICAgICAgICAgIH0NCiAgICAgICAgfSkNCiAgICAgIH0NCg0KICAgICwgZXNjYXBlOiBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciB0aGF0ID0gdGhpcw0KICAgICAgICBpZiAodGhpcy5pc1Nob3duICYmIHRoaXMub3B0aW9ucy5rZXlib2FyZCkgew0KICAgICAgICAgIHRoaXMuJGVsZW1lbnQub24oJ2tleXVwLmRpc21pc3MubW9kYWwnLCBmdW5jdGlvbiAoIGUgKSB7DQogICAgICAgICAgICBlLndoaWNoID09IDI3ICYmIHRoYXQuaGlkZSgpDQogICAgICAgICAgfSkNCiAgICAgICAgfSBlbHNlIGlmICghdGhpcy5pc1Nob3duKSB7DQogICAgICAgICAgdGhpcy4kZWxlbWVudC5vZmYoJ2tleXVwLmRpc21pc3MubW9kYWwnKQ0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAsIGhpZGVXaXRoVHJhbnNpdGlvbjogZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgdGhhdCA9IHRoaXMNCiAgICAgICAgICAsIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgdGhhdC4kZWxlbWVudC5vZmYoJC5zdXBwb3J0LnRyYW5zaXRpb24uZW5kKQ0KICAgICAgICAgICAgICB0aGF0LmhpZGVNb2RhbCgpDQogICAgICAgICAgICB9LCA1MDApDQoNCiAgICAgICAgdGhpcy4kZWxlbWVudC5vbmUoJC5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpDQogICAgICAgICAgdGhhdC5oaWRlTW9kYWwoKQ0KICAgICAgICB9KQ0KICAgICAgfQ0KDQogICAgLCBoaWRlTW9kYWw6IGZ1bmN0aW9uICh0aGF0KSB7DQogICAgICAgIHRoaXMuJGVsZW1lbnQNCiAgICAgICAgICAuaGlkZSgpDQogICAgICAgICAgLnRyaWdnZXIoJ2hpZGRlbicpDQoNCiAgICAgICAgdGhpcy5iYWNrZHJvcCgpDQogICAgICB9DQoNCiAgICAsIHJlbW92ZUJhY2tkcm9wOiBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMuJGJhY2tkcm9wLnJlbW92ZSgpDQogICAgICAgIHRoaXMuJGJhY2tkcm9wID0gbnVsbA0KICAgICAgfQ0KDQogICAgLCBiYWNrZHJvcDogZnVuY3Rpb24gKGNhbGxiYWNrKSB7DQogICAgICAgIHZhciB0aGF0ID0gdGhpcw0KICAgICAgICAgICwgYW5pbWF0ZSA9IHRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoJ2ZhZGUnKSA/ICdmYWRlJyA6ICcnDQoNCiAgICAgICAgaWYgKHRoaXMuaXNTaG93biAmJiB0aGlzLm9wdGlvbnMuYmFja2Ryb3ApIHsNCiAgICAgICAgICB2YXIgZG9BbmltYXRlID0gJC5zdXBwb3J0LnRyYW5zaXRpb24gJiYgYW5pbWF0ZQ0KDQogICAgICAgICAgdGhpcy4kYmFja2Ryb3AgPSAkKCc8ZGl2IGNsYXNzPSJtb2RhbC1iYWNrZHJvcCAnICsgYW5pbWF0ZSArICciIC8+JykNCiAgICAgICAgICAgIC5hcHBlbmRUbyhkb2N1bWVudC5ib2R5KQ0KDQogICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5iYWNrZHJvcCAhPSAnc3RhdGljJykgew0KICAgICAgICAgICAgdGhpcy4kYmFja2Ryb3AuY2xpY2soJC5wcm94eSh0aGlzLmhpZGUsIHRoaXMpKQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGlmIChkb0FuaW1hdGUpIHRoaXMuJGJhY2tkcm9wWzBdLm9mZnNldFdpZHRoIC8vIGZvcmNlIHJlZmxvdw0KDQogICAgICAgICAgdGhpcy4kYmFja2Ryb3AuYWRkQ2xhc3MoJ2luJykNCg0KICAgICAgICAgIGRvQW5pbWF0ZSA/DQogICAgICAgICAgICB0aGlzLiRiYWNrZHJvcC5vbmUoJC5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLCBjYWxsYmFjaykgOg0KICAgICAgICAgICAgY2FsbGJhY2soKQ0KDQogICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuaXNTaG93biAmJiB0aGlzLiRiYWNrZHJvcCkgew0KICAgICAgICAgIHRoaXMuJGJhY2tkcm9wLnJlbW92ZUNsYXNzKCdpbicpDQoNCiAgICAgICAgICAkLnN1cHBvcnQudHJhbnNpdGlvbiAmJiB0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCdmYWRlJyk/DQogICAgICAgICAgICB0aGlzLiRiYWNrZHJvcC5vbmUoJC5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLCAkLnByb3h5KHRoaXMucmVtb3ZlQmFja2Ryb3AsIHRoaXMpKSA6DQogICAgICAgICAgICB0aGlzLnJlbW92ZUJhY2tkcm9wKCkNCg0KICAgICAgICB9IGVsc2UgaWYgKGNhbGxiYWNrKSB7DQogICAgICAgICAgY2FsbGJhY2soKQ0KICAgICAgICB9DQogICAgICB9DQogIH0NCg0KDQogLyogTU9EQUwgUExVR0lOIERFRklOSVRJT04NCiAgKiA9PT09PT09PT09PT09PT09PT09PT09PSAqLw0KDQogICQuZm4ubW9kYWwgPSBmdW5jdGlvbiAob3B0aW9uKSB7DQogICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7DQogICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpDQogICAgICAgICwgZGF0YSA9ICR0aGlzLmRhdGEoJ21vZGFsJykNCiAgICAgICAgLCBvcHRpb25zID0gJC5leHRlbmQoe30sICQuZm4ubW9kYWwuZGVmYXVsdHMsICR0aGlzLmRhdGEoKSwgdHlwZW9mIG9wdGlvbiA9PSAnb2JqZWN0JyAmJiBvcHRpb24pDQogICAgICBpZiAoIWRhdGEpICR0aGlzLmRhdGEoJ21vZGFsJywgKGRhdGEgPSBuZXcgTW9kYWwodGhpcywgb3B0aW9ucykpKQ0KICAgICAgaWYgKHR5cGVvZiBvcHRpb24gPT0gJ3N0cmluZycpIGRhdGFbb3B0aW9uXSgpDQogICAgICBlbHNlIGlmIChvcHRpb25zLnNob3cpIGRhdGEuc2hvdygpDQogICAgfSkNCiAgfQ0KDQogICQuZm4ubW9kYWwuZGVmYXVsdHMgPSB7DQogICAgICBiYWNrZHJvcDogdHJ1ZQ0KICAgICwga2V5Ym9hcmQ6IHRydWUNCiAgICAsIHNob3c6IHRydWUNCiAgfQ0KDQogICQuZm4ubW9kYWwuQ29uc3RydWN0b3IgPSBNb2RhbA0KDQoNCiAvKiBNT0RBTCBEQVRBLUFQSQ0KICAqID09PT09PT09PT09PT09ICovDQoNCiAgJChmdW5jdGlvbiAoKSB7DQogICAgJCgnYm9keScpLm9uKCdjbGljay5tb2RhbC5kYXRhLWFwaScsICdbZGF0YS10b2dnbGU9Im1vZGFsIl0nLCBmdW5jdGlvbiAoIGUgKSB7DQogICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpDQogICAgICAgICwgaHJlZiA9ICR0aGlzLmF0dHIoJ2hyZWYnKQ0KICAgICAgICAsICR0YXJnZXQgPSAkKCR0aGlzLmF0dHIoJ2RhdGEtdGFyZ2V0JykgfHwgKGhyZWYgJiYgaHJlZi5yZXBsYWNlKC8uKig/PSNbXlxzXSskKS8sICcnKSkpIC8vc3RyaXAgZm9yIGllNw0KICAgICAgICAsIG9wdGlvbiA9ICR0YXJnZXQuZGF0YSgnbW9kYWwnKSA/ICd0b2dnbGUnIDogJC5leHRlbmQoeyByZW1vdGU6ICEvIy8udGVzdChocmVmKSAmJiBocmVmIH0sICR0YXJnZXQuZGF0YSgpLCAkdGhpcy5kYXRhKCkpDQoNCiAgICAgIGUucHJldmVudERlZmF1bHQoKQ0KDQogICAgICAkdGFyZ2V0DQogICAgICAgIC5tb2RhbChvcHRpb24pDQogICAgICAgIC5vbmUoJ2hpZGUnLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgJHRoaXMuZm9jdXMoKQ0KICAgICAgICB9KQ0KICAgIH0pDQogIH0pDQoNCn0od2luZG93LmpRdWVyeSk7LyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAqIGJvb3RzdHJhcC10b29sdGlwLmpzIHYyLjEuMQ0KICogaHR0cDovL3R3aXR0ZXIuZ2l0aHViLmNvbS9ib290c3RyYXAvamF2YXNjcmlwdC5odG1sI3Rvb2x0aXBzDQogKiBJbnNwaXJlZCBieSB0aGUgb3JpZ2luYWwgalF1ZXJ5LnRpcHN5IGJ5IEphc29uIEZyYW1lDQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICogQ29weXJpZ2h0IDIwMTIgVHdpdHRlciwgSW5jLg0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovDQoNCg0KIWZ1bmN0aW9uICgkKSB7DQoNCiAgInVzZSBzdHJpY3QiOyAvLyBqc2hpbnQgO187DQoNCg0KIC8qIFRPT0xUSVAgUFVCTElDIENMQVNTIERFRklOSVRJT04NCiAgKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovDQoNCiAgdmFyIFRvb2x0aXAgPSBmdW5jdGlvbiAoZWxlbWVudCwgb3B0aW9ucykgew0KICAgIHRoaXMuaW5pdCgndG9vbHRpcCcsIGVsZW1lbnQsIG9wdGlvbnMpDQogIH0NCg0KICBUb29sdGlwLnByb3RvdHlwZSA9IHsNCg0KICAgIGNvbnN0cnVjdG9yOiBUb29sdGlwDQoNCiAgLCBpbml0OiBmdW5jdGlvbiAodHlwZSwgZWxlbWVudCwgb3B0aW9ucykgew0KICAgICAgdmFyIGV2ZW50SW4NCiAgICAgICAgLCBldmVudE91dA0KDQogICAgICB0aGlzLnR5cGUgPSB0eXBlDQogICAgICB0aGlzLiRlbGVtZW50ID0gJChlbGVtZW50KQ0KICAgICAgdGhpcy5vcHRpb25zID0gdGhpcy5nZXRPcHRpb25zKG9wdGlvbnMpDQogICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlDQoNCiAgICAgIGlmICh0aGlzLm9wdGlvbnMudHJpZ2dlciA9PSAnY2xpY2snKSB7DQogICAgICAgIHRoaXMuJGVsZW1lbnQub24oJ2NsaWNrLicgKyB0aGlzLnR5cGUsIHRoaXMub3B0aW9ucy5zZWxlY3RvciwgJC5wcm94eSh0aGlzLnRvZ2dsZSwgdGhpcykpDQogICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy50cmlnZ2VyICE9ICdtYW51YWwnKSB7DQogICAgICAgIGV2ZW50SW4gPSB0aGlzLm9wdGlvbnMudHJpZ2dlciA9PSAnaG92ZXInID8gJ21vdXNlZW50ZXInIDogJ2ZvY3VzJw0KICAgICAgICBldmVudE91dCA9IHRoaXMub3B0aW9ucy50cmlnZ2VyID09ICdob3ZlcicgPyAnbW91c2VsZWF2ZScgOiAnYmx1cicNCiAgICAgICAgdGhpcy4kZWxlbWVudC5vbihldmVudEluICsgJy4nICsgdGhpcy50eXBlLCB0aGlzLm9wdGlvbnMuc2VsZWN0b3IsICQucHJveHkodGhpcy5lbnRlciwgdGhpcykpDQogICAgICAgIHRoaXMuJGVsZW1lbnQub24oZXZlbnRPdXQgKyAnLicgKyB0aGlzLnR5cGUsIHRoaXMub3B0aW9ucy5zZWxlY3RvciwgJC5wcm94eSh0aGlzLmxlYXZlLCB0aGlzKSkNCiAgICAgIH0NCg0KICAgICAgdGhpcy5vcHRpb25zLnNlbGVjdG9yID8NCiAgICAgICAgKHRoaXMuX29wdGlvbnMgPSAkLmV4dGVuZCh7fSwgdGhpcy5vcHRpb25zLCB7IHRyaWdnZXI6ICdtYW51YWwnLCBzZWxlY3RvcjogJycgfSkpIDoNCiAgICAgICAgdGhpcy5maXhUaXRsZSgpDQogICAgfQ0KDQogICwgZ2V0T3B0aW9uczogZnVuY3Rpb24gKG9wdGlvbnMpIHsNCiAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgJC5mblt0aGlzLnR5cGVdLmRlZmF1bHRzLCBvcHRpb25zLCB0aGlzLiRlbGVtZW50LmRhdGEoKSkNCg0KICAgICAgaWYgKG9wdGlvbnMuZGVsYXkgJiYgdHlwZW9mIG9wdGlvbnMuZGVsYXkgPT0gJ251bWJlcicpIHsNCiAgICAgICAgb3B0aW9ucy5kZWxheSA9IHsNCiAgICAgICAgICBzaG93OiBvcHRpb25zLmRlbGF5DQogICAgICAgICwgaGlkZTogb3B0aW9ucy5kZWxheQ0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIHJldHVybiBvcHRpb25zDQogICAgfQ0KDQogICwgZW50ZXI6IGZ1bmN0aW9uIChlKSB7DQogICAgICB2YXIgc2VsZiA9ICQoZS5jdXJyZW50VGFyZ2V0KVt0aGlzLnR5cGVdKHRoaXMuX29wdGlvbnMpLmRhdGEodGhpcy50eXBlKQ0KDQogICAgICBpZiAoIXNlbGYub3B0aW9ucy5kZWxheSB8fCAhc2VsZi5vcHRpb25zLmRlbGF5LnNob3cpIHJldHVybiBzZWxmLnNob3coKQ0KDQogICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lb3V0KQ0KICAgICAgc2VsZi5ob3ZlclN0YXRlID0gJ2luJw0KICAgICAgdGhpcy50aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsNCiAgICAgICAgaWYgKHNlbGYuaG92ZXJTdGF0ZSA9PSAnaW4nKSBzZWxmLnNob3coKQ0KICAgICAgfSwgc2VsZi5vcHRpb25zLmRlbGF5LnNob3cpDQogICAgfQ0KDQogICwgbGVhdmU6IGZ1bmN0aW9uIChlKSB7DQogICAgICB2YXIgc2VsZiA9ICQoZS5jdXJyZW50VGFyZ2V0KVt0aGlzLnR5cGVdKHRoaXMuX29wdGlvbnMpLmRhdGEodGhpcy50eXBlKQ0KDQogICAgICBpZiAodGhpcy50aW1lb3V0KSBjbGVhclRpbWVvdXQodGhpcy50aW1lb3V0KQ0KICAgICAgaWYgKCFzZWxmLm9wdGlvbnMuZGVsYXkgfHwgIXNlbGYub3B0aW9ucy5kZWxheS5oaWRlKSByZXR1cm4gc2VsZi5oaWRlKCkNCg0KICAgICAgc2VsZi5ob3ZlclN0YXRlID0gJ291dCcNCiAgICAgIHRoaXMudGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgIGlmIChzZWxmLmhvdmVyU3RhdGUgPT0gJ291dCcpIHNlbGYuaGlkZSgpDQogICAgICB9LCBzZWxmLm9wdGlvbnMuZGVsYXkuaGlkZSkNCiAgICB9DQoNCiAgLCBzaG93OiBmdW5jdGlvbiAoKSB7DQogICAgICB2YXIgJHRpcA0KICAgICAgICAsIGluc2lkZQ0KICAgICAgICAsIHBvcw0KICAgICAgICAsIGFjdHVhbFdpZHRoDQogICAgICAgICwgYWN0dWFsSGVpZ2h0DQogICAgICAgICwgcGxhY2VtZW50DQogICAgICAgICwgdHANCg0KICAgICAgaWYgKHRoaXMuaGFzQ29udGVudCgpICYmIHRoaXMuZW5hYmxlZCkgew0KICAgICAgICAkdGlwID0gdGhpcy50aXAoKQ0KICAgICAgICB0aGlzLnNldENvbnRlbnQoKQ0KDQogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYW5pbWF0aW9uKSB7DQogICAgICAgICAgJHRpcC5hZGRDbGFzcygnZmFkZScpDQogICAgICAgIH0NCg0KICAgICAgICBwbGFjZW1lbnQgPSB0eXBlb2YgdGhpcy5vcHRpb25zLnBsYWNlbWVudCA9PSAnZnVuY3Rpb24nID8NCiAgICAgICAgICB0aGlzLm9wdGlvbnMucGxhY2VtZW50LmNhbGwodGhpcywgJHRpcFswXSwgdGhpcy4kZWxlbWVudFswXSkgOg0KICAgICAgICAgIHRoaXMub3B0aW9ucy5wbGFjZW1lbnQNCg0KICAgICAgICBpbnNpZGUgPSAvaW4vLnRlc3QocGxhY2VtZW50KQ0KDQogICAgICAgICR0aXANCiAgICAgICAgICAucmVtb3ZlKCkNCiAgICAgICAgICAuY3NzKHsgdG9wOiAwLCBsZWZ0OiAwLCBkaXNwbGF5OiAnYmxvY2snIH0pDQogICAgICAgICAgLmFwcGVuZFRvKGluc2lkZSA/IHRoaXMuJGVsZW1lbnQgOiBkb2N1bWVudC5ib2R5KQ0KDQogICAgICAgIHBvcyA9IHRoaXMuZ2V0UG9zaXRpb24oaW5zaWRlKQ0KDQogICAgICAgIGFjdHVhbFdpZHRoID0gJHRpcFswXS5vZmZzZXRXaWR0aA0KICAgICAgICBhY3R1YWxIZWlnaHQgPSAkdGlwWzBdLm9mZnNldEhlaWdodA0KDQogICAgICAgIHN3aXRjaCAoaW5zaWRlID8gcGxhY2VtZW50LnNwbGl0KCcgJylbMV0gOiBwbGFjZW1lbnQpIHsNCiAgICAgICAgICBjYXNlICdib3R0b20nOg0KICAgICAgICAgICAgdHAgPSB7dG9wOiBwb3MudG9wICsgcG9zLmhlaWdodCwgbGVmdDogcG9zLmxlZnQgKyBwb3Mud2lkdGggLyAyIC0gYWN0dWFsV2lkdGggLyAyfQ0KICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICBjYXNlICd0b3AnOg0KICAgICAgICAgICAgdHAgPSB7dG9wOiBwb3MudG9wIC0gYWN0dWFsSGVpZ2h0LCBsZWZ0OiBwb3MubGVmdCArIHBvcy53aWR0aCAvIDIgLSBhY3R1YWxXaWR0aCAvIDJ9DQogICAgICAgICAgICBicmVhaw0KICAgICAgICAgIGNhc2UgJ2xlZnQnOg0KICAgICAgICAgICAgdHAgPSB7dG9wOiBwb3MudG9wICsgcG9zLmhlaWdodCAvIDIgLSBhY3R1YWxIZWlnaHQgLyAyLCBsZWZ0OiBwb3MubGVmdCAtIGFjdHVhbFdpZHRofQ0KICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICBjYXNlICdyaWdodCc6DQogICAgICAgICAgICB0cCA9IHt0b3A6IHBvcy50b3AgKyBwb3MuaGVpZ2h0IC8gMiAtIGFjdHVhbEhlaWdodCAvIDIsIGxlZnQ6IHBvcy5sZWZ0ICsgcG9zLndpZHRofQ0KICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgfQ0KDQogICAgICAgICR0aXANCiAgICAgICAgICAuY3NzKHRwKQ0KICAgICAgICAgIC5hZGRDbGFzcyhwbGFjZW1lbnQpDQogICAgICAgICAgLmFkZENsYXNzKCdpbicpDQogICAgICB9DQogICAgfQ0KDQogICwgc2V0Q29udGVudDogZnVuY3Rpb24gKCkgew0KICAgICAgdmFyICR0aXAgPSB0aGlzLnRpcCgpDQogICAgICAgICwgdGl0bGUgPSB0aGlzLmdldFRpdGxlKCkNCg0KICAgICAgJHRpcC5maW5kKCcudG9vbHRpcC1pbm5lcicpW3RoaXMub3B0aW9ucy5odG1sID8gJ2h0bWwnIDogJ3RleHQnXSh0aXRsZSkNCiAgICAgICR0aXAucmVtb3ZlQ2xhc3MoJ2ZhZGUgaW4gdG9wIGJvdHRvbSBsZWZ0IHJpZ2h0JykNCiAgICB9DQoNCiAgLCBoaWRlOiBmdW5jdGlvbiAoKSB7DQogICAgICB2YXIgdGhhdCA9IHRoaXMNCiAgICAgICAgLCAkdGlwID0gdGhpcy50aXAoKQ0KDQogICAgICAkdGlwLnJlbW92ZUNsYXNzKCdpbicpDQoNCiAgICAgIGZ1bmN0aW9uIHJlbW92ZVdpdGhBbmltYXRpb24oKSB7DQogICAgICAgIHZhciB0aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgJHRpcC5vZmYoJC5zdXBwb3J0LnRyYW5zaXRpb24uZW5kKS5yZW1vdmUoKQ0KICAgICAgICB9LCA1MDApDQoNCiAgICAgICAgJHRpcC5vbmUoJC5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpDQogICAgICAgICAgJHRpcC5yZW1vdmUoKQ0KICAgICAgICB9KQ0KICAgICAgfQ0KDQogICAgICAkLnN1cHBvcnQudHJhbnNpdGlvbiAmJiB0aGlzLiR0aXAuaGFzQ2xhc3MoJ2ZhZGUnKSA/DQogICAgICAgIHJlbW92ZVdpdGhBbmltYXRpb24oKSA6DQogICAgICAgICR0aXAucmVtb3ZlKCkNCg0KICAgICAgcmV0dXJuIHRoaXMNCiAgICB9DQoNCiAgLCBmaXhUaXRsZTogZnVuY3Rpb24gKCkgew0KICAgICAgdmFyICRlID0gdGhpcy4kZWxlbWVudA0KICAgICAgaWYgKCRlLmF0dHIoJ3RpdGxlJykgfHwgdHlwZW9mKCRlLmF0dHIoJ2RhdGEtb3JpZ2luYWwtdGl0bGUnKSkgIT0gJ3N0cmluZycpIHsNCiAgICAgICAgJGUuYXR0cignZGF0YS1vcmlnaW5hbC10aXRsZScsICRlLmF0dHIoJ3RpdGxlJykgfHwgJycpLnJlbW92ZUF0dHIoJ3RpdGxlJykNCiAgICAgIH0NCiAgICB9DQoNCiAgLCBoYXNDb250ZW50OiBmdW5jdGlvbiAoKSB7DQogICAgICByZXR1cm4gdGhpcy5nZXRUaXRsZSgpDQogICAgfQ0KDQogICwgZ2V0UG9zaXRpb246IGZ1bmN0aW9uIChpbnNpZGUpIHsNCiAgICAgIHJldHVybiAkLmV4dGVuZCh7fSwgKGluc2lkZSA/IHt0b3A6IDAsIGxlZnQ6IDB9IDogdGhpcy4kZWxlbWVudC5vZmZzZXQoKSksIHsNCiAgICAgICAgd2lkdGg6IHRoaXMuJGVsZW1lbnRbMF0ub2Zmc2V0V2lkdGgNCiAgICAgICwgaGVpZ2h0OiB0aGlzLiRlbGVtZW50WzBdLm9mZnNldEhlaWdodA0KICAgICAgfSkNCiAgICB9DQoNCiAgLCBnZXRUaXRsZTogZnVuY3Rpb24gKCkgew0KICAgICAgdmFyIHRpdGxlDQogICAgICAgICwgJGUgPSB0aGlzLiRlbGVtZW50DQogICAgICAgICwgbyA9IHRoaXMub3B0aW9ucw0KDQogICAgICB0aXRsZSA9ICRlLmF0dHIoJ2RhdGEtb3JpZ2luYWwtdGl0bGUnKQ0KICAgICAgICB8fCAodHlwZW9mIG8udGl0bGUgPT0gJ2Z1bmN0aW9uJyA/IG8udGl0bGUuY2FsbCgkZVswXSkgOiAgby50aXRsZSkNCg0KICAgICAgcmV0dXJuIHRpdGxlDQogICAgfQ0KDQogICwgdGlwOiBmdW5jdGlvbiAoKSB7DQogICAgICByZXR1cm4gdGhpcy4kdGlwID0gdGhpcy4kdGlwIHx8ICQodGhpcy5vcHRpb25zLnRlbXBsYXRlKQ0KICAgIH0NCg0KICAsIHZhbGlkYXRlOiBmdW5jdGlvbiAoKSB7DQogICAgICBpZiAoIXRoaXMuJGVsZW1lbnRbMF0ucGFyZW50Tm9kZSkgew0KICAgICAgICB0aGlzLmhpZGUoKQ0KICAgICAgICB0aGlzLiRlbGVtZW50ID0gbnVsbA0KICAgICAgICB0aGlzLm9wdGlvbnMgPSBudWxsDQogICAgICB9DQogICAgfQ0KDQogICwgZW5hYmxlOiBmdW5jdGlvbiAoKSB7DQogICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlDQogICAgfQ0KDQogICwgZGlzYWJsZTogZnVuY3Rpb24gKCkgew0KICAgICAgdGhpcy5lbmFibGVkID0gZmFsc2UNCiAgICB9DQoNCiAgLCB0b2dnbGVFbmFibGVkOiBmdW5jdGlvbiAoKSB7DQogICAgICB0aGlzLmVuYWJsZWQgPSAhdGhpcy5lbmFibGVkDQogICAgfQ0KDQogICwgdG9nZ2xlOiBmdW5jdGlvbiAoKSB7DQogICAgICB0aGlzW3RoaXMudGlwKCkuaGFzQ2xhc3MoJ2luJykgPyAnaGlkZScgOiAnc2hvdyddKCkNCiAgICB9DQoNCiAgLCBkZXN0cm95OiBmdW5jdGlvbiAoKSB7DQogICAgICB0aGlzLmhpZGUoKS4kZWxlbWVudC5vZmYoJy4nICsgdGhpcy50eXBlKS5yZW1vdmVEYXRhKHRoaXMudHlwZSkNCiAgICB9DQoNCiAgfQ0KDQoNCiAvKiBUT09MVElQIFBMVUdJTiBERUZJTklUSU9ODQogICogPT09PT09PT09PT09PT09PT09PT09PT09PSAqLw0KDQogICQuZm4udG9vbHRpcCA9IGZ1bmN0aW9uICggb3B0aW9uICkgew0KICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgew0KICAgICAgdmFyICR0aGlzID0gJCh0aGlzKQ0KICAgICAgICAsIGRhdGEgPSAkdGhpcy5kYXRhKCd0b29sdGlwJykNCiAgICAgICAgLCBvcHRpb25zID0gdHlwZW9mIG9wdGlvbiA9PSAnb2JqZWN0JyAmJiBvcHRpb24NCiAgICAgIGlmICghZGF0YSkgJHRoaXMuZGF0YSgndG9vbHRpcCcsIChkYXRhID0gbmV3IFRvb2x0aXAodGhpcywgb3B0aW9ucykpKQ0KICAgICAgaWYgKHR5cGVvZiBvcHRpb24gPT0gJ3N0cmluZycpIGRhdGFbb3B0aW9uXSgpDQogICAgfSkNCiAgfQ0KDQogICQuZm4udG9vbHRpcC5Db25zdHJ1Y3RvciA9IFRvb2x0aXANCg0KICAkLmZuLnRvb2x0aXAuZGVmYXVsdHMgPSB7DQogICAgYW5pbWF0aW9uOiB0cnVlDQogICwgcGxhY2VtZW50OiAndG9wJw0KICAsIHNlbGVjdG9yOiBmYWxzZQ0KICAsIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz0idG9vbHRpcCI+PGRpdiBjbGFzcz0idG9vbHRpcC1hcnJvdyI+PC9kaXY+PGRpdiBjbGFzcz0idG9vbHRpcC1pbm5lciI+PC9kaXY+PC9kaXY+Jw0KICAsIHRyaWdnZXI6ICdob3ZlcicNCiAgLCB0aXRsZTogJycNCiAgLCBkZWxheTogMA0KICAsIGh0bWw6IHRydWUNCiAgfQ0KDQp9KHdpbmRvdy5qUXVlcnkpOw0KLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAqIGJvb3RzdHJhcC1wb3BvdmVyLmpzIHYyLjEuMQ0KICogaHR0cDovL3R3aXR0ZXIuZ2l0aHViLmNvbS9ib290c3RyYXAvamF2YXNjcmlwdC5odG1sI3BvcG92ZXJzDQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICogQ29weXJpZ2h0IDIwMTIgVHdpdHRlciwgSW5jLg0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLw0KDQoNCiFmdW5jdGlvbiAoJCkgew0KDQogICJ1c2Ugc3RyaWN0IjsgLy8ganNoaW50IDtfOw0KDQoNCiAvKiBQT1BPVkVSIFBVQkxJQyBDTEFTUyBERUZJTklUSU9ODQogICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLw0KDQogIHZhciBQb3BvdmVyID0gZnVuY3Rpb24gKGVsZW1lbnQsIG9wdGlvbnMpIHsNCiAgICB0aGlzLmluaXQoJ3BvcG92ZXInLCBlbGVtZW50LCBvcHRpb25zKQ0KICB9DQoNCg0KICAvKiBOT1RFOiBQT1BPVkVSIEVYVEVORFMgQk9PVFNUUkFQLVRPT0xUSVAuanMNCiAgICAgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovDQoNCiAgUG9wb3Zlci5wcm90b3R5cGUgPSAkLmV4dGVuZCh7fSwgJC5mbi50b29sdGlwLkNvbnN0cnVjdG9yLnByb3RvdHlwZSwgew0KDQogICAgY29uc3RydWN0b3I6IFBvcG92ZXINCg0KICAsIHNldENvbnRlbnQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgIHZhciAkdGlwID0gdGhpcy50aXAoKQ0KICAgICAgICAsIHRpdGxlID0gdGhpcy5nZXRUaXRsZSgpDQogICAgICAgICwgY29udGVudCA9IHRoaXMuZ2V0Q29udGVudCgpDQoNCiAgICAgICR0aXAuZmluZCgnLnBvcG92ZXItdGl0bGUnKVt0aGlzLm9wdGlvbnMuaHRtbCA/ICdodG1sJyA6ICd0ZXh0J10odGl0bGUpDQogICAgICAkdGlwLmZpbmQoJy5wb3BvdmVyLWNvbnRlbnQgPiAqJylbdGhpcy5vcHRpb25zLmh0bWwgPyAnaHRtbCcgOiAndGV4dCddKGNvbnRlbnQpDQoNCiAgICAgICR0aXAucmVtb3ZlQ2xhc3MoJ2ZhZGUgdG9wIGJvdHRvbSBsZWZ0IHJpZ2h0IGluJykNCiAgICB9DQoNCiAgLCBoYXNDb250ZW50OiBmdW5jdGlvbiAoKSB7DQogICAgICByZXR1cm4gdGhpcy5nZXRUaXRsZSgpIHx8IHRoaXMuZ2V0Q29udGVudCgpDQogICAgfQ0KDQogICwgZ2V0Q29udGVudDogZnVuY3Rpb24gKCkgew0KICAgICAgdmFyIGNvbnRlbnQNCiAgICAgICAgLCAkZSA9IHRoaXMuJGVsZW1lbnQNCiAgICAgICAgLCBvID0gdGhpcy5vcHRpb25zDQoNCiAgICAgIGNvbnRlbnQgPSAkZS5hdHRyKCdkYXRhLWNvbnRlbnQnKQ0KICAgICAgICB8fCAodHlwZW9mIG8uY29udGVudCA9PSAnZnVuY3Rpb24nID8gby5jb250ZW50LmNhbGwoJGVbMF0pIDogIG8uY29udGVudCkNCg0KICAgICAgcmV0dXJuIGNvbnRlbnQNCiAgICB9DQoNCiAgLCB0aXA6IGZ1bmN0aW9uICgpIHsNCiAgICAgIGlmICghdGhpcy4kdGlwKSB7DQogICAgICAgIHRoaXMuJHRpcCA9ICQodGhpcy5vcHRpb25zLnRlbXBsYXRlKQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIHRoaXMuJHRpcA0KICAgIH0NCg0KICAsIGRlc3Ryb3k6IGZ1bmN0aW9uICgpIHsNCiAgICAgIHRoaXMuaGlkZSgpLiRlbGVtZW50Lm9mZignLicgKyB0aGlzLnR5cGUpLnJlbW92ZURhdGEodGhpcy50eXBlKQ0KICAgIH0NCg0KICB9KQ0KDQoNCiAvKiBQT1BPVkVSIFBMVUdJTiBERUZJTklUSU9ODQogICogPT09PT09PT09PT09PT09PT09PT09PT0gKi8NCg0KICAkLmZuLnBvcG92ZXIgPSBmdW5jdGlvbiAob3B0aW9uKSB7DQogICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7DQogICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpDQogICAgICAgICwgZGF0YSA9ICR0aGlzLmRhdGEoJ3BvcG92ZXInKQ0KICAgICAgICAsIG9wdGlvbnMgPSB0eXBlb2Ygb3B0aW9uID09ICdvYmplY3QnICYmIG9wdGlvbg0KICAgICAgaWYgKCFkYXRhKSAkdGhpcy5kYXRhKCdwb3BvdmVyJywgKGRhdGEgPSBuZXcgUG9wb3Zlcih0aGlzLCBvcHRpb25zKSkpDQogICAgICBpZiAodHlwZW9mIG9wdGlvbiA9PSAnc3RyaW5nJykgZGF0YVtvcHRpb25dKCkNCiAgICB9KQ0KICB9DQoNCiAgJC5mbi5wb3BvdmVyLkNvbnN0cnVjdG9yID0gUG9wb3Zlcg0KDQogICQuZm4ucG9wb3Zlci5kZWZhdWx0cyA9ICQuZXh0ZW5kKHt9ICwgJC5mbi50b29sdGlwLmRlZmF1bHRzLCB7DQogICAgcGxhY2VtZW50OiAncmlnaHQnDQogICwgdHJpZ2dlcjogJ2NsaWNrJw0KICAsIGNvbnRlbnQ6ICcnDQogICwgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPSJwb3BvdmVyIj48ZGl2IGNsYXNzPSJhcnJvdyI+PC9kaXY+PGRpdiBjbGFzcz0icG9wb3Zlci1pbm5lciI+PGgzIGNsYXNzPSJwb3BvdmVyLXRpdGxlIj48L2gzPjxkaXYgY2xhc3M9InBvcG92ZXItY29udGVudCI+PHA+PC9wPjwvZGl2PjwvZGl2PjwvZGl2PicNCiAgfSkNCg0KfSh3aW5kb3cualF1ZXJ5KTsvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogKiBib290c3RyYXAtc2Nyb2xsc3B5LmpzIHYyLjEuMQ0KICogaHR0cDovL3R3aXR0ZXIuZ2l0aHViLmNvbS9ib290c3RyYXAvamF2YXNjcmlwdC5odG1sI3Njcm9sbHNweQ0KICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICogQ29weXJpZ2h0IDIwMTIgVHdpdHRlciwgSW5jLg0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLw0KDQoNCiFmdW5jdGlvbiAoJCkgew0KDQogICJ1c2Ugc3RyaWN0IjsgLy8ganNoaW50IDtfOw0KDQoNCiAvKiBTQ1JPTExTUFkgQ0xBU1MgREVGSU5JVElPTg0KICAqID09PT09PT09PT09PT09PT09PT09PT09PT09ICovDQoNCiAgZnVuY3Rpb24gU2Nyb2xsU3B5KGVsZW1lbnQsIG9wdGlvbnMpIHsNCiAgICB2YXIgcHJvY2VzcyA9ICQucHJveHkodGhpcy5wcm9jZXNzLCB0aGlzKQ0KICAgICAgLCAkZWxlbWVudCA9ICQoZWxlbWVudCkuaXMoJ2JvZHknKSA/ICQod2luZG93KSA6ICQoZWxlbWVudCkNCiAgICAgICwgaHJlZg0KICAgIHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCAkLmZuLnNjcm9sbHNweS5kZWZhdWx0cywgb3B0aW9ucykNCiAgICB0aGlzLiRzY3JvbGxFbGVtZW50ID0gJGVsZW1lbnQub24oJ3Njcm9sbC5zY3JvbGwtc3B5LmRhdGEtYXBpJywgcHJvY2VzcykNCiAgICB0aGlzLnNlbGVjdG9yID0gKHRoaXMub3B0aW9ucy50YXJnZXQNCiAgICAgIHx8ICgoaHJlZiA9ICQoZWxlbWVudCkuYXR0cignaHJlZicpKSAmJiBocmVmLnJlcGxhY2UoLy4qKD89I1teXHNdKyQpLywgJycpKSAvL3N0cmlwIGZvciBpZTcNCiAgICAgIHx8ICcnKSArICcgLm5hdiBsaSA+IGEnDQogICAgdGhpcy4kYm9keSA9ICQoJ2JvZHknKQ0KICAgIHRoaXMucmVmcmVzaCgpDQogICAgdGhpcy5wcm9jZXNzKCkNCiAgfQ0KDQogIFNjcm9sbFNweS5wcm90b3R5cGUgPSB7DQoNCiAgICAgIGNvbnN0cnVjdG9yOiBTY3JvbGxTcHkNCg0KICAgICwgcmVmcmVzaDogZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgc2VsZiA9IHRoaXMNCiAgICAgICAgICAsICR0YXJnZXRzDQoNCiAgICAgICAgdGhpcy5vZmZzZXRzID0gJChbXSkNCiAgICAgICAgdGhpcy50YXJnZXRzID0gJChbXSkNCg0KICAgICAgICAkdGFyZ2V0cyA9IHRoaXMuJGJvZHkNCiAgICAgICAgICAuZmluZCh0aGlzLnNlbGVjdG9yKQ0KICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyICRlbCA9ICQodGhpcykNCiAgICAgICAgICAgICAgLCBocmVmID0gJGVsLmRhdGEoJ3RhcmdldCcpIHx8ICRlbC5hdHRyKCdocmVmJykNCiAgICAgICAgICAgICAgLCAkaHJlZiA9IC9eI1x3Ly50ZXN0KGhyZWYpICYmICQoaHJlZikNCiAgICAgICAgICAgIHJldHVybiAoICRocmVmDQogICAgICAgICAgICAgICYmICRocmVmLmxlbmd0aA0KICAgICAgICAgICAgICAmJiBbWyAkaHJlZi5wb3NpdGlvbigpLnRvcCwgaHJlZiBdXSApIHx8IG51bGwNCiAgICAgICAgICB9KQ0KICAgICAgICAgIC5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBhWzBdIC0gYlswXSB9KQ0KICAgICAgICAgIC5lYWNoKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHNlbGYub2Zmc2V0cy5wdXNoKHRoaXNbMF0pDQogICAgICAgICAgICBzZWxmLnRhcmdldHMucHVzaCh0aGlzWzFdKQ0KICAgICAgICAgIH0pDQogICAgICB9DQoNCiAgICAsIHByb2Nlc3M6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIHNjcm9sbFRvcCA9IHRoaXMuJHNjcm9sbEVsZW1lbnQuc2Nyb2xsVG9wKCkgKyB0aGlzLm9wdGlvbnMub2Zmc2V0DQogICAgICAgICAgLCBzY3JvbGxIZWlnaHQgPSB0aGlzLiRzY3JvbGxFbGVtZW50WzBdLnNjcm9sbEhlaWdodCB8fCB0aGlzLiRib2R5WzBdLnNjcm9sbEhlaWdodA0KICAgICAgICAgICwgbWF4U2Nyb2xsID0gc2Nyb2xsSGVpZ2h0IC0gdGhpcy4kc2Nyb2xsRWxlbWVudC5oZWlnaHQoKQ0KICAgICAgICAgICwgb2Zmc2V0cyA9IHRoaXMub2Zmc2V0cw0KICAgICAgICAgICwgdGFyZ2V0cyA9IHRoaXMudGFyZ2V0cw0KICAgICAgICAgICwgYWN0aXZlVGFyZ2V0ID0gdGhpcy5hY3RpdmVUYXJnZXQNCiAgICAgICAgICAsIGkNCg0KICAgICAgICBpZiAoc2Nyb2xsVG9wID49IG1heFNjcm9sbCkgew0KICAgICAgICAgIHJldHVybiBhY3RpdmVUYXJnZXQgIT0gKGkgPSB0YXJnZXRzLmxhc3QoKVswXSkNCiAgICAgICAgICAgICYmIHRoaXMuYWN0aXZhdGUgKCBpICkNCiAgICAgICAgfQ0KDQogICAgICAgIGZvciAoaSA9IG9mZnNldHMubGVuZ3RoOyBpLS07KSB7DQogICAgICAgICAgYWN0aXZlVGFyZ2V0ICE9IHRhcmdldHNbaV0NCiAgICAgICAgICAgICYmIHNjcm9sbFRvcCA+PSBvZmZzZXRzW2ldDQogICAgICAgICAgICAmJiAoIW9mZnNldHNbaSArIDFdIHx8IHNjcm9sbFRvcCA8PSBvZmZzZXRzW2kgKyAxXSkNCiAgICAgICAgICAgICYmIHRoaXMuYWN0aXZhdGUoIHRhcmdldHNbaV0gKQ0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAsIGFjdGl2YXRlOiBmdW5jdGlvbiAodGFyZ2V0KSB7DQogICAgICAgIHZhciBhY3RpdmUNCiAgICAgICAgICAsIHNlbGVjdG9yDQoNCiAgICAgICAgdGhpcy5hY3RpdmVUYXJnZXQgPSB0YXJnZXQNCg0KICAgICAgICAkKHRoaXMuc2VsZWN0b3IpDQogICAgICAgICAgLnBhcmVudCgnLmFjdGl2ZScpDQogICAgICAgICAgLnJlbW92ZUNsYXNzKCdhY3RpdmUnKQ0KDQogICAgICAgIHNlbGVjdG9yID0gdGhpcy5zZWxlY3Rvcg0KICAgICAgICAgICsgJ1tkYXRhLXRhcmdldD0iJyArIHRhcmdldCArICciXSwnDQogICAgICAgICAgKyB0aGlzLnNlbGVjdG9yICsgJ1tocmVmPSInICsgdGFyZ2V0ICsgJyJdJw0KDQogICAgICAgIGFjdGl2ZSA9ICQoc2VsZWN0b3IpDQogICAgICAgICAgLnBhcmVudCgnbGknKQ0KICAgICAgICAgIC5hZGRDbGFzcygnYWN0aXZlJykNCg0KICAgICAgICBpZiAoYWN0aXZlLnBhcmVudCgnLmRyb3Bkb3duLW1lbnUnKS5sZW5ndGgpICB7DQogICAgICAgICAgYWN0aXZlID0gYWN0aXZlLmNsb3Nlc3QoJ2xpLmRyb3Bkb3duJykuYWRkQ2xhc3MoJ2FjdGl2ZScpDQogICAgICAgIH0NCg0KICAgICAgICBhY3RpdmUudHJpZ2dlcignYWN0aXZhdGUnKQ0KICAgICAgfQ0KDQogIH0NCg0KDQogLyogU0NST0xMU1BZIFBMVUdJTiBERUZJTklUSU9ODQogICogPT09PT09PT09PT09PT09PT09PT09PT09PT09ICovDQoNCiAgJC5mbi5zY3JvbGxzcHkgPSBmdW5jdGlvbiAob3B0aW9uKSB7DQogICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7DQogICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpDQogICAgICAgICwgZGF0YSA9ICR0aGlzLmRhdGEoJ3Njcm9sbHNweScpDQogICAgICAgICwgb3B0aW9ucyA9IHR5cGVvZiBvcHRpb24gPT0gJ29iamVjdCcgJiYgb3B0aW9uDQogICAgICBpZiAoIWRhdGEpICR0aGlzLmRhdGEoJ3Njcm9sbHNweScsIChkYXRhID0gbmV3IFNjcm9sbFNweSh0aGlzLCBvcHRpb25zKSkpDQogICAgICBpZiAodHlwZW9mIG9wdGlvbiA9PSAnc3RyaW5nJykgZGF0YVtvcHRpb25dKCkNCiAgICB9KQ0KICB9DQoNCiAgJC5mbi5zY3JvbGxzcHkuQ29uc3RydWN0b3IgPSBTY3JvbGxTcHkNCg0KICAkLmZuLnNjcm9sbHNweS5kZWZhdWx0cyA9IHsNCiAgICBvZmZzZXQ6IDEwDQogIH0NCg0KDQogLyogU0NST0xMU1BZIERBVEEtQVBJDQogICogPT09PT09PT09PT09PT09PT09ICovDQoNCiAgJCh3aW5kb3cpLm9uKCdsb2FkJywgZnVuY3Rpb24gKCkgew0KICAgICQoJ1tkYXRhLXNweT0ic2Nyb2xsIl0nKS5lYWNoKGZ1bmN0aW9uICgpIHsNCiAgICAgIHZhciAkc3B5ID0gJCh0aGlzKQ0KICAgICAgJHNweS5zY3JvbGxzcHkoJHNweS5kYXRhKCkpDQogICAgfSkNCiAgfSkNCg0KfSh3aW5kb3cualF1ZXJ5KTsvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICogYm9vdHN0cmFwLXRhYi5qcyB2Mi4xLjENCiAqIGh0dHA6Ly90d2l0dGVyLmdpdGh1Yi5jb20vYm9vdHN0cmFwL2phdmFzY3JpcHQuaHRtbCN0YWJzDQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICogQ29weXJpZ2h0IDIwMTIgVHdpdHRlciwgSW5jLg0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLw0KDQoNCiFmdW5jdGlvbiAoJCkgew0KDQogICJ1c2Ugc3RyaWN0IjsgLy8ganNoaW50IDtfOw0KDQoNCiAvKiBUQUIgQ0xBU1MgREVGSU5JVElPTg0KICAqID09PT09PT09PT09PT09PT09PT09ICovDQoNCiAgdmFyIFRhYiA9IGZ1bmN0aW9uIChlbGVtZW50KSB7DQogICAgdGhpcy5lbGVtZW50ID0gJChlbGVtZW50KQ0KICB9DQoNCiAgVGFiLnByb3RvdHlwZSA9IHsNCg0KICAgIGNvbnN0cnVjdG9yOiBUYWINCg0KICAsIHNob3c6IGZ1bmN0aW9uICgpIHsNCiAgICAgIHZhciAkdGhpcyA9IHRoaXMuZWxlbWVudA0KICAgICAgICAsICR1bCA9ICR0aGlzLmNsb3Nlc3QoJ3VsOm5vdCguZHJvcGRvd24tbWVudSknKQ0KICAgICAgICAsIHNlbGVjdG9yID0gJHRoaXMuYXR0cignZGF0YS10YXJnZXQnKQ0KICAgICAgICAsIHByZXZpb3VzDQogICAgICAgICwgJHRhcmdldA0KICAgICAgICAsIGUNCg0KICAgICAgaWYgKCFzZWxlY3Rvcikgew0KICAgICAgICBzZWxlY3RvciA9ICR0aGlzLmF0dHIoJ2hyZWYnKQ0KICAgICAgICBzZWxlY3RvciA9IHNlbGVjdG9yICYmIHNlbGVjdG9yLnJlcGxhY2UoLy4qKD89I1teXHNdKiQpLywgJycpIC8vc3RyaXAgZm9yIGllNw0KICAgICAgfQ0KDQogICAgICBpZiAoICR0aGlzLnBhcmVudCgnbGknKS5oYXNDbGFzcygnYWN0aXZlJykgKSByZXR1cm4NCg0KICAgICAgcHJldmlvdXMgPSAkdWwuZmluZCgnLmFjdGl2ZSBhJykubGFzdCgpWzBdDQoNCiAgICAgIGUgPSAkLkV2ZW50KCdzaG93Jywgew0KICAgICAgICByZWxhdGVkVGFyZ2V0OiBwcmV2aW91cw0KICAgICAgfSkNCg0KICAgICAgJHRoaXMudHJpZ2dlcihlKQ0KDQogICAgICBpZiAoZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgcmV0dXJuDQoNCiAgICAgICR0YXJnZXQgPSAkKHNlbGVjdG9yKQ0KDQogICAgICB0aGlzLmFjdGl2YXRlKCR0aGlzLnBhcmVudCgnbGknKSwgJHVsKQ0KICAgICAgdGhpcy5hY3RpdmF0ZSgkdGFyZ2V0LCAkdGFyZ2V0LnBhcmVudCgpLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICR0aGlzLnRyaWdnZXIoew0KICAgICAgICAgIHR5cGU6ICdzaG93bicNCiAgICAgICAgLCByZWxhdGVkVGFyZ2V0OiBwcmV2aW91cw0KICAgICAgICB9KQ0KICAgICAgfSkNCiAgICB9DQoNCiAgLCBhY3RpdmF0ZTogZnVuY3Rpb24gKCBlbGVtZW50LCBjb250YWluZXIsIGNhbGxiYWNrKSB7DQogICAgICB2YXIgJGFjdGl2ZSA9IGNvbnRhaW5lci5maW5kKCc+IC5hY3RpdmUnKQ0KICAgICAgICAsIHRyYW5zaXRpb24gPSBjYWxsYmFjaw0KICAgICAgICAgICAgJiYgJC5zdXBwb3J0LnRyYW5zaXRpb24NCiAgICAgICAgICAgICYmICRhY3RpdmUuaGFzQ2xhc3MoJ2ZhZGUnKQ0KDQogICAgICBmdW5jdGlvbiBuZXh0KCkgew0KICAgICAgICAkYWN0aXZlDQogICAgICAgICAgLnJlbW92ZUNsYXNzKCdhY3RpdmUnKQ0KICAgICAgICAgIC5maW5kKCc+IC5kcm9wZG93bi1tZW51ID4gLmFjdGl2ZScpDQogICAgICAgICAgLnJlbW92ZUNsYXNzKCdhY3RpdmUnKQ0KDQogICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoJ2FjdGl2ZScpDQoNCiAgICAgICAgaWYgKHRyYW5zaXRpb24pIHsNCiAgICAgICAgICBlbGVtZW50WzBdLm9mZnNldFdpZHRoIC8vIHJlZmxvdyBmb3IgdHJhbnNpdGlvbg0KICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoJ2luJykNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBlbGVtZW50LnJlbW92ZUNsYXNzKCdmYWRlJykNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICggZWxlbWVudC5wYXJlbnQoJy5kcm9wZG93bi1tZW51JykgKSB7DQogICAgICAgICAgZWxlbWVudC5jbG9zZXN0KCdsaS5kcm9wZG93bicpLmFkZENsYXNzKCdhY3RpdmUnKQ0KICAgICAgICB9DQoNCiAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKQ0KICAgICAgfQ0KDQogICAgICB0cmFuc2l0aW9uID8NCiAgICAgICAgJGFjdGl2ZS5vbmUoJC5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLCBuZXh0KSA6DQogICAgICAgIG5leHQoKQ0KDQogICAgICAkYWN0aXZlLnJlbW92ZUNsYXNzKCdpbicpDQogICAgfQ0KICB9DQoNCg0KIC8qIFRBQiBQTFVHSU4gREVGSU5JVElPTg0KICAqID09PT09PT09PT09PT09PT09PT09PSAqLw0KDQogICQuZm4udGFiID0gZnVuY3Rpb24gKCBvcHRpb24gKSB7DQogICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7DQogICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpDQogICAgICAgICwgZGF0YSA9ICR0aGlzLmRhdGEoJ3RhYicpDQogICAgICBpZiAoIWRhdGEpICR0aGlzLmRhdGEoJ3RhYicsIChkYXRhID0gbmV3IFRhYih0aGlzKSkpDQogICAgICBpZiAodHlwZW9mIG9wdGlvbiA9PSAnc3RyaW5nJykgZGF0YVtvcHRpb25dKCkNCiAgICB9KQ0KICB9DQoNCiAgJC5mbi50YWIuQ29uc3RydWN0b3IgPSBUYWINCg0KDQogLyogVEFCIERBVEEtQVBJDQogICogPT09PT09PT09PT09ICovDQoNCiAgJChmdW5jdGlvbiAoKSB7DQogICAgJCgnYm9keScpLm9uKCdjbGljay50YWIuZGF0YS1hcGknLCAnW2RhdGEtdG9nZ2xlPSJ0YWIiXSwgW2RhdGEtdG9nZ2xlPSJwaWxsIl0nLCBmdW5jdGlvbiAoZSkgew0KICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpDQogICAgICAkKHRoaXMpLnRhYignc2hvdycpDQogICAgfSkNCiAgfSkNCg0KfSh3aW5kb3cualF1ZXJ5KTsvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogKiBib290c3RyYXAtdHlwZWFoZWFkLmpzIHYyLjEuMQ0KICogaHR0cDovL3R3aXR0ZXIuZ2l0aHViLmNvbS9ib290c3RyYXAvamF2YXNjcmlwdC5odG1sI3R5cGVhaGVhZA0KICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICogQ29weXJpZ2h0IDIwMTIgVHdpdHRlciwgSW5jLg0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8NCg0KDQohZnVuY3Rpb24oJCl7DQoNCiAgInVzZSBzdHJpY3QiOyAvLyBqc2hpbnQgO187DQoNCg0KIC8qIFRZUEVBSEVBRCBQVUJMSUMgQ0xBU1MgREVGSU5JVElPTg0KICAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLw0KDQogIHZhciBUeXBlYWhlYWQgPSBmdW5jdGlvbiAoZWxlbWVudCwgb3B0aW9ucykgew0KICAgIHRoaXMuJGVsZW1lbnQgPSAkKGVsZW1lbnQpDQogICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQoe30sICQuZm4udHlwZWFoZWFkLmRlZmF1bHRzLCBvcHRpb25zKQ0KICAgIHRoaXMubWF0Y2hlciA9IHRoaXMub3B0aW9ucy5tYXRjaGVyIHx8IHRoaXMubWF0Y2hlcg0KICAgIHRoaXMuc29ydGVyID0gdGhpcy5vcHRpb25zLnNvcnRlciB8fCB0aGlzLnNvcnRlcg0KICAgIHRoaXMuaGlnaGxpZ2h0ZXIgPSB0aGlzLm9wdGlvbnMuaGlnaGxpZ2h0ZXIgfHwgdGhpcy5oaWdobGlnaHRlcg0KICAgIHRoaXMudXBkYXRlciA9IHRoaXMub3B0aW9ucy51cGRhdGVyIHx8IHRoaXMudXBkYXRlcg0KICAgIHRoaXMuJG1lbnUgPSAkKHRoaXMub3B0aW9ucy5tZW51KS5hcHBlbmRUbygnYm9keScpDQogICAgdGhpcy5zb3VyY2UgPSB0aGlzLm9wdGlvbnMuc291cmNlDQogICAgdGhpcy5zaG93biA9IGZhbHNlDQogICAgdGhpcy5saXN0ZW4oKQ0KICB9DQoNCiAgVHlwZWFoZWFkLnByb3RvdHlwZSA9IHsNCg0KICAgIGNvbnN0cnVjdG9yOiBUeXBlYWhlYWQNCg0KICAsIHNlbGVjdDogZnVuY3Rpb24gKCkgew0KICAgICAgdmFyIHZhbCA9IHRoaXMuJG1lbnUuZmluZCgnLmFjdGl2ZScpLmF0dHIoJ2RhdGEtdmFsdWUnKQ0KICAgICAgdGhpcy4kZWxlbWVudA0KICAgICAgICAudmFsKHRoaXMudXBkYXRlcih2YWwpKQ0KICAgICAgICAuY2hhbmdlKCkNCiAgICAgIHJldHVybiB0aGlzLmhpZGUoKQ0KICAgIH0NCg0KICAsIHVwZGF0ZXI6IGZ1bmN0aW9uIChpdGVtKSB7DQogICAgICByZXR1cm4gaXRlbQ0KICAgIH0NCg0KICAsIHNob3c6IGZ1bmN0aW9uICgpIHsNCiAgICAgIHZhciBwb3MgPSAkLmV4dGVuZCh7fSwgdGhpcy4kZWxlbWVudC5vZmZzZXQoKSwgew0KICAgICAgICBoZWlnaHQ6IHRoaXMuJGVsZW1lbnRbMF0ub2Zmc2V0SGVpZ2h0DQogICAgICB9KQ0KDQogICAgICB0aGlzLiRtZW51LmNzcyh7DQogICAgICAgIHRvcDogcG9zLnRvcCArIHBvcy5oZWlnaHQNCiAgICAgICwgbGVmdDogcG9zLmxlZnQNCiAgICAgIH0pDQoNCiAgICAgIHRoaXMuJG1lbnUuc2hvdygpDQogICAgICB0aGlzLnNob3duID0gdHJ1ZQ0KICAgICAgcmV0dXJuIHRoaXMNCiAgICB9DQoNCiAgLCBoaWRlOiBmdW5jdGlvbiAoKSB7DQogICAgICB0aGlzLiRtZW51LmhpZGUoKQ0KICAgICAgdGhpcy5zaG93biA9IGZhbHNlDQogICAgICByZXR1cm4gdGhpcw0KICAgIH0NCg0KICAsIGxvb2t1cDogZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICB2YXIgaXRlbXMNCg0KICAgICAgdGhpcy5xdWVyeSA9IHRoaXMuJGVsZW1lbnQudmFsKCkNCg0KICAgICAgaWYgKCF0aGlzLnF1ZXJ5IHx8IHRoaXMucXVlcnkubGVuZ3RoIDwgdGhpcy5vcHRpb25zLm1pbkxlbmd0aCkgew0KICAgICAgICByZXR1cm4gdGhpcy5zaG93biA/IHRoaXMuaGlkZSgpIDogdGhpcw0KICAgICAgfQ0KDQogICAgICBpdGVtcyA9ICQuaXNGdW5jdGlvbih0aGlzLnNvdXJjZSkgPyB0aGlzLnNvdXJjZSh0aGlzLnF1ZXJ5LCAkLnByb3h5KHRoaXMucHJvY2VzcywgdGhpcykpIDogdGhpcy5zb3VyY2UNCg0KICAgICAgcmV0dXJuIGl0ZW1zID8gdGhpcy5wcm9jZXNzKGl0ZW1zKSA6IHRoaXMNCiAgICB9DQoNCiAgLCBwcm9jZXNzOiBmdW5jdGlvbiAoaXRlbXMpIHsNCiAgICAgIHZhciB0aGF0ID0gdGhpcw0KDQogICAgICBpdGVtcyA9ICQuZ3JlcChpdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsNCiAgICAgICAgcmV0dXJuIHRoYXQubWF0Y2hlcihpdGVtKQ0KICAgICAgfSkNCg0KICAgICAgaXRlbXMgPSB0aGlzLnNvcnRlcihpdGVtcykNCg0KICAgICAgaWYgKCFpdGVtcy5sZW5ndGgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuc2hvd24gPyB0aGlzLmhpZGUoKSA6IHRoaXMNCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIHRoaXMucmVuZGVyKGl0ZW1zLnNsaWNlKDAsIHRoaXMub3B0aW9ucy5pdGVtcykpLnNob3coKQ0KICAgIH0NCg0KICAsIG1hdGNoZXI6IGZ1bmN0aW9uIChpdGVtKSB7DQogICAgICByZXR1cm4gfml0ZW0udG9Mb3dlckNhc2UoKS5pbmRleE9mKHRoaXMucXVlcnkudG9Mb3dlckNhc2UoKSkNCiAgICB9DQoNCiAgLCBzb3J0ZXI6IGZ1bmN0aW9uIChpdGVtcykgew0KICAgICAgdmFyIGJlZ2luc3dpdGggPSBbXQ0KICAgICAgICAsIGNhc2VTZW5zaXRpdmUgPSBbXQ0KICAgICAgICAsIGNhc2VJbnNlbnNpdGl2ZSA9IFtdDQogICAgICAgICwgaXRlbQ0KDQogICAgICB3aGlsZSAoaXRlbSA9IGl0ZW1zLnNoaWZ0KCkpIHsNCiAgICAgICAgaWYgKCFpdGVtLnRvTG93ZXJDYXNlKCkuaW5kZXhPZih0aGlzLnF1ZXJ5LnRvTG93ZXJDYXNlKCkpKSBiZWdpbnN3aXRoLnB1c2goaXRlbSkNCiAgICAgICAgZWxzZSBpZiAofml0ZW0uaW5kZXhPZih0aGlzLnF1ZXJ5KSkgY2FzZVNlbnNpdGl2ZS5wdXNoKGl0ZW0pDQogICAgICAgIGVsc2UgY2FzZUluc2Vuc2l0aXZlLnB1c2goaXRlbSkNCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIGJlZ2luc3dpdGguY29uY2F0KGNhc2VTZW5zaXRpdmUsIGNhc2VJbnNlbnNpdGl2ZSkNCiAgICB9DQoNCiAgLCBoaWdobGlnaHRlcjogZnVuY3Rpb24gKGl0ZW0pIHsNCiAgICAgIHZhciBxdWVyeSA9IHRoaXMucXVlcnkucmVwbGFjZSgvW1wtXFtcXXt9KCkqKz8uLFxcXF4kfCNcc10vZywgJ1xcJCYnKQ0KICAgICAgcmV0dXJuIGl0ZW0ucmVwbGFjZShuZXcgUmVnRXhwKCcoJyArIHF1ZXJ5ICsgJyknLCAnaWcnKSwgZnVuY3Rpb24gKCQxLCBtYXRjaCkgew0KICAgICAgICByZXR1cm4gJzxzdHJvbmc+JyArIG1hdGNoICsgJzwvc3Ryb25nPicNCiAgICAgIH0pDQogICAgfQ0KDQogICwgcmVuZGVyOiBmdW5jdGlvbiAoaXRlbXMpIHsNCiAgICAgIHZhciB0aGF0ID0gdGhpcw0KDQogICAgICBpdGVtcyA9ICQoaXRlbXMpLm1hcChmdW5jdGlvbiAoaSwgaXRlbSkgew0KICAgICAgICBpID0gJCh0aGF0Lm9wdGlvbnMuaXRlbSkuYXR0cignZGF0YS12YWx1ZScsIGl0ZW0pDQogICAgICAgIGkuZmluZCgnYScpLmh0bWwodGhhdC5oaWdobGlnaHRlcihpdGVtKSkNCiAgICAgICAgcmV0dXJuIGlbMF0NCiAgICAgIH0pDQoNCiAgICAgIGl0ZW1zLmZpcnN0KCkuYWRkQ2xhc3MoJ2FjdGl2ZScpDQogICAgICB0aGlzLiRtZW51Lmh0bWwoaXRlbXMpDQogICAgICByZXR1cm4gdGhpcw0KICAgIH0NCg0KICAsIG5leHQ6IGZ1bmN0aW9uIChldmVudCkgew0KICAgICAgdmFyIGFjdGl2ZSA9IHRoaXMuJG1lbnUuZmluZCgnLmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKQ0KICAgICAgICAsIG5leHQgPSBhY3RpdmUubmV4dCgpDQoNCiAgICAgIGlmICghbmV4dC5sZW5ndGgpIHsNCiAgICAgICAgbmV4dCA9ICQodGhpcy4kbWVudS5maW5kKCdsaScpWzBdKQ0KICAgICAgfQ0KDQogICAgICBuZXh0LmFkZENsYXNzKCdhY3RpdmUnKQ0KICAgIH0NCg0KICAsIHByZXY6IGZ1bmN0aW9uIChldmVudCkgew0KICAgICAgdmFyIGFjdGl2ZSA9IHRoaXMuJG1lbnUuZmluZCgnLmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKQ0KICAgICAgICAsIHByZXYgPSBhY3RpdmUucHJldigpDQoNCiAgICAgIGlmICghcHJldi5sZW5ndGgpIHsNCiAgICAgICAgcHJldiA9IHRoaXMuJG1lbnUuZmluZCgnbGknKS5sYXN0KCkNCiAgICAgIH0NCg0KICAgICAgcHJldi5hZGRDbGFzcygnYWN0aXZlJykNCiAgICB9DQoNCiAgLCBsaXN0ZW46IGZ1bmN0aW9uICgpIHsNCiAgICAgIHRoaXMuJGVsZW1lbnQNCiAgICAgICAgLm9uKCdibHVyJywgICAgICQucHJveHkodGhpcy5ibHVyLCB0aGlzKSkNCiAgICAgICAgLm9uKCdrZXlwcmVzcycsICQucHJveHkodGhpcy5rZXlwcmVzcywgdGhpcykpDQogICAgICAgIC5vbigna2V5dXAnLCAgICAkLnByb3h5KHRoaXMua2V5dXAsIHRoaXMpKQ0KDQogICAgICBpZiAoJC5icm93c2VyLmNocm9tZSB8fCAkLmJyb3dzZXIud2Via2l0IHx8ICQuYnJvd3Nlci5tc2llKSB7DQogICAgICAgIHRoaXMuJGVsZW1lbnQub24oJ2tleWRvd24nLCAkLnByb3h5KHRoaXMua2V5ZG93biwgdGhpcykpDQogICAgICB9DQoNCiAgICAgIHRoaXMuJG1lbnUNCiAgICAgICAgLm9uKCdjbGljaycsICQucHJveHkodGhpcy5jbGljaywgdGhpcykpDQogICAgICAgIC5vbignbW91c2VlbnRlcicsICdsaScsICQucHJveHkodGhpcy5tb3VzZWVudGVyLCB0aGlzKSkNCiAgICB9DQoNCiAgLCBtb3ZlOiBmdW5jdGlvbiAoZSkgew0KICAgICAgaWYgKCF0aGlzLnNob3duKSByZXR1cm4NCg0KICAgICAgc3dpdGNoKGUua2V5Q29kZSkgew0KICAgICAgICBjYXNlIDk6IC8vIHRhYg0KICAgICAgICBjYXNlIDEzOiAvLyBlbnRlcg0KICAgICAgICBjYXNlIDI3OiAvLyBlc2NhcGUNCiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCkNCiAgICAgICAgICBicmVhaw0KDQogICAgICAgIGNhc2UgMzg6IC8vIHVwIGFycm93DQogICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpDQogICAgICAgICAgdGhpcy5wcmV2KCkNCiAgICAgICAgICBicmVhaw0KDQogICAgICAgIGNhc2UgNDA6IC8vIGRvd24gYXJyb3cNCiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCkNCiAgICAgICAgICB0aGlzLm5leHQoKQ0KICAgICAgICAgIGJyZWFrDQogICAgICB9DQoNCiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCkNCiAgICB9DQoNCiAgLCBrZXlkb3duOiBmdW5jdGlvbiAoZSkgew0KICAgICAgdGhpcy5zdXBwcmVzc0tleVByZXNzUmVwZWF0ID0gIX4kLmluQXJyYXkoZS5rZXlDb2RlLCBbNDAsMzgsOSwxMywyN10pDQogICAgICB0aGlzLm1vdmUoZSkNCiAgICB9DQoNCiAgLCBrZXlwcmVzczogZnVuY3Rpb24gKGUpIHsNCiAgICAgIGlmICh0aGlzLnN1cHByZXNzS2V5UHJlc3NSZXBlYXQpIHJldHVybg0KICAgICAgdGhpcy5tb3ZlKGUpDQogICAgfQ0KDQogICwga2V5dXA6IGZ1bmN0aW9uIChlKSB7DQogICAgICBzd2l0Y2goZS5rZXlDb2RlKSB7DQogICAgICAgIGNhc2UgNDA6IC8vIGRvd24gYXJyb3cNCiAgICAgICAgY2FzZSAzODogLy8gdXAgYXJyb3cNCiAgICAgICAgICBicmVhaw0KDQogICAgICAgIGNhc2UgOTogLy8gdGFiDQogICAgICAgIGNhc2UgMTM6IC8vIGVudGVyDQogICAgICAgICAgaWYgKCF0aGlzLnNob3duKSByZXR1cm4NCiAgICAgICAgICB0aGlzLnNlbGVjdCgpDQogICAgICAgICAgYnJlYWsNCg0KICAgICAgICBjYXNlIDI3OiAvLyBlc2NhcGUNCiAgICAgICAgICBpZiAoIXRoaXMuc2hvd24pIHJldHVybg0KICAgICAgICAgIHRoaXMuaGlkZSgpDQogICAgICAgICAgYnJlYWsNCg0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgIHRoaXMubG9va3VwKCkNCiAgICAgIH0NCg0KICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKQ0KICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpDQogIH0NCg0KICAsIGJsdXI6IGZ1bmN0aW9uIChlKSB7DQogICAgICB2YXIgdGhhdCA9IHRoaXMNCiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyB0aGF0LmhpZGUoKSB9LCAxNTApDQogICAgfQ0KDQogICwgY2xpY2s6IGZ1bmN0aW9uIChlKSB7DQogICAgICBlLnN0b3BQcm9wYWdhdGlvbigpDQogICAgICBlLnByZXZlbnREZWZhdWx0KCkNCiAgICAgIHRoaXMuc2VsZWN0KCkNCiAgICB9DQoNCiAgLCBtb3VzZWVudGVyOiBmdW5jdGlvbiAoZSkgew0KICAgICAgdGhpcy4kbWVudS5maW5kKCcuYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpDQogICAgICAkKGUuY3VycmVudFRhcmdldCkuYWRkQ2xhc3MoJ2FjdGl2ZScpDQogICAgfQ0KDQogIH0NCg0KDQogIC8qIFRZUEVBSEVBRCBQTFVHSU4gREVGSU5JVElPTg0KICAgKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8NCg0KICAkLmZuLnR5cGVhaGVhZCA9IGZ1bmN0aW9uIChvcHRpb24pIHsNCiAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsNCiAgICAgIHZhciAkdGhpcyA9ICQodGhpcykNCiAgICAgICAgLCBkYXRhID0gJHRoaXMuZGF0YSgndHlwZWFoZWFkJykNCiAgICAgICAgLCBvcHRpb25zID0gdHlwZW9mIG9wdGlvbiA9PSAnb2JqZWN0JyAmJiBvcHRpb24NCiAgICAgIGlmICghZGF0YSkgJHRoaXMuZGF0YSgndHlwZWFoZWFkJywgKGRhdGEgPSBuZXcgVHlwZWFoZWFkKHRoaXMsIG9wdGlvbnMpKSkNCiAgICAgIGlmICh0eXBlb2Ygb3B0aW9uID09ICdzdHJpbmcnKSBkYXRhW29wdGlvbl0oKQ0KICAgIH0pDQogIH0NCg0KICAkLmZuLnR5cGVhaGVhZC5kZWZhdWx0cyA9IHsNCiAgICBzb3VyY2U6IFtdDQogICwgaXRlbXM6IDgNCiAgLCBtZW51OiAnPHVsIGNsYXNzPSJ0eXBlYWhlYWQgZHJvcGRvd24tbWVudSI+PC91bD4nDQogICwgaXRlbTogJzxsaT48YSBocmVmPSIjIj48L2E+PC9saT4nDQogICwgbWluTGVuZ3RoOiAxDQogIH0NCg0KICAkLmZuLnR5cGVhaGVhZC5Db25zdHJ1Y3RvciA9IFR5cGVhaGVhZA0KDQoNCiAvKiAgIFRZUEVBSEVBRCBEQVRBLUFQSQ0KICAqID09PT09PT09PT09PT09PT09PSAqLw0KDQogICQoZnVuY3Rpb24gKCkgew0KICAgICQoJ2JvZHknKS5vbignZm9jdXMudHlwZWFoZWFkLmRhdGEtYXBpJywgJ1tkYXRhLXByb3ZpZGU9InR5cGVhaGVhZCJdJywgZnVuY3Rpb24gKGUpIHsNCiAgICAgIHZhciAkdGhpcyA9ICQodGhpcykNCiAgICAgIGlmICgkdGhpcy5kYXRhKCd0eXBlYWhlYWQnKSkgcmV0dXJuDQogICAgICBlLnByZXZlbnREZWZhdWx0KCkNCiAgICAgICR0aGlzLnR5cGVhaGVhZCgkdGhpcy5kYXRhKCkpDQogICAgfSkNCiAgfSkNCg0KfSh3aW5kb3cualF1ZXJ5KTsNCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAqIGJvb3RzdHJhcC1hZmZpeC5qcyB2Mi4xLjENCiAqIGh0dHA6Ly90d2l0dGVyLmdpdGh1Yi5jb20vYm9vdHN0cmFwL2phdmFzY3JpcHQuaHRtbCNhZmZpeA0KICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICogQ29weXJpZ2h0IDIwMTIgVHdpdHRlciwgSW5jLg0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovDQoNCg0KIWZ1bmN0aW9uICgkKSB7DQoNCiAgInVzZSBzdHJpY3QiOyAvLyBqc2hpbnQgO187DQoNCg0KIC8qIEFGRklYIENMQVNTIERFRklOSVRJT04NCiAgKiA9PT09PT09PT09PT09PT09PT09PT09ICovDQoNCiAgdmFyIEFmZml4ID0gZnVuY3Rpb24gKGVsZW1lbnQsIG9wdGlvbnMpIHsNCiAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgJC5mbi5hZmZpeC5kZWZhdWx0cywgb3B0aW9ucykNCiAgICB0aGlzLiR3aW5kb3cgPSAkKHdpbmRvdykub24oJ3Njcm9sbC5hZmZpeC5kYXRhLWFwaScsICQucHJveHkodGhpcy5jaGVja1Bvc2l0aW9uLCB0aGlzKSkNCiAgICB0aGlzLiRlbGVtZW50ID0gJChlbGVtZW50KQ0KICAgIHRoaXMuY2hlY2tQb3NpdGlvbigpDQogIH0NCg0KICBBZmZpeC5wcm90b3R5cGUuY2hlY2tQb3NpdGlvbiA9IGZ1bmN0aW9uICgpIHsNCiAgICBpZiAoIXRoaXMuJGVsZW1lbnQuaXMoJzp2aXNpYmxlJykpIHJldHVybg0KDQogICAgdmFyIHNjcm9sbEhlaWdodCA9ICQoZG9jdW1lbnQpLmhlaWdodCgpDQogICAgICAsIHNjcm9sbFRvcCA9IHRoaXMuJHdpbmRvdy5zY3JvbGxUb3AoKQ0KICAgICAgLCBwb3NpdGlvbiA9IHRoaXMuJGVsZW1lbnQub2Zmc2V0KCkNCiAgICAgICwgb2Zmc2V0ID0gdGhpcy5vcHRpb25zLm9mZnNldA0KICAgICAgLCBvZmZzZXRCb3R0b20gPSBvZmZzZXQuYm90dG9tDQogICAgICAsIG9mZnNldFRvcCA9IG9mZnNldC50b3ANCiAgICAgICwgcmVzZXQgPSAnYWZmaXggYWZmaXgtdG9wIGFmZml4LWJvdHRvbScNCiAgICAgICwgYWZmaXgNCg0KICAgIGlmICh0eXBlb2Ygb2Zmc2V0ICE9ICdvYmplY3QnKSBvZmZzZXRCb3R0b20gPSBvZmZzZXRUb3AgPSBvZmZzZXQNCiAgICBpZiAodHlwZW9mIG9mZnNldFRvcCA9PSAnZnVuY3Rpb24nKSBvZmZzZXRUb3AgPSBvZmZzZXQudG9wKCkNCiAgICBpZiAodHlwZW9mIG9mZnNldEJvdHRvbSA9PSAnZnVuY3Rpb24nKSBvZmZzZXRCb3R0b20gPSBvZmZzZXQuYm90dG9tKCkNCg0KICAgIGFmZml4ID0gdGhpcy51bnBpbiAhPSBudWxsICYmIChzY3JvbGxUb3AgKyB0aGlzLnVucGluIDw9IHBvc2l0aW9uLnRvcCkgPw0KICAgICAgZmFsc2UgICAgOiBvZmZzZXRCb3R0b20gIT0gbnVsbCAmJiAocG9zaXRpb24udG9wICsgdGhpcy4kZWxlbWVudC5oZWlnaHQoKSA+PSBzY3JvbGxIZWlnaHQgLSBvZmZzZXRCb3R0b20pID8NCiAgICAgICdib3R0b20nIDogb2Zmc2V0VG9wICE9IG51bGwgJiYgc2Nyb2xsVG9wIDw9IG9mZnNldFRvcCA/DQogICAgICAndG9wJyAgICA6IGZhbHNlDQoNCiAgICBpZiAodGhpcy5hZmZpeGVkID09PSBhZmZpeCkgcmV0dXJuDQoNCiAgICB0aGlzLmFmZml4ZWQgPSBhZmZpeA0KICAgIHRoaXMudW5waW4gPSBhZmZpeCA9PSAnYm90dG9tJyA/IHBvc2l0aW9uLnRvcCAtIHNjcm9sbFRvcCA6IG51bGwNCg0KICAgIHRoaXMuJGVsZW1lbnQucmVtb3ZlQ2xhc3MocmVzZXQpLmFkZENsYXNzKCdhZmZpeCcgKyAoYWZmaXggPyAnLScgKyBhZmZpeCA6ICcnKSkNCiAgfQ0KDQoNCiAvKiBBRkZJWCBQTFVHSU4gREVGSU5JVElPTg0KICAqID09PT09PT09PT09PT09PT09PT09PT09ICovDQoNCiAgJC5mbi5hZmZpeCA9IGZ1bmN0aW9uIChvcHRpb24pIHsNCiAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsNCiAgICAgIHZhciAkdGhpcyA9ICQodGhpcykNCiAgICAgICAgLCBkYXRhID0gJHRoaXMuZGF0YSgnYWZmaXgnKQ0KICAgICAgICAsIG9wdGlvbnMgPSB0eXBlb2Ygb3B0aW9uID09ICdvYmplY3QnICYmIG9wdGlvbg0KICAgICAgaWYgKCFkYXRhKSAkdGhpcy5kYXRhKCdhZmZpeCcsIChkYXRhID0gbmV3IEFmZml4KHRoaXMsIG9wdGlvbnMpKSkNCiAgICAgIGlmICh0eXBlb2Ygb3B0aW9uID09ICdzdHJpbmcnKSBkYXRhW29wdGlvbl0oKQ0KICAgIH0pDQogIH0NCg0KICAkLmZuLmFmZml4LkNvbnN0cnVjdG9yID0gQWZmaXgNCg0KICAkLmZuLmFmZml4LmRlZmF1bHRzID0gew0KICAgIG9mZnNldDogMA0KICB9DQoNCg0KIC8qIEFGRklYIERBVEEtQVBJDQogICogPT09PT09PT09PT09PT0gKi8NCg0KICAkKHdpbmRvdykub24oJ2xvYWQnLCBmdW5jdGlvbiAoKSB7DQogICAgJCgnW2RhdGEtc3B5PSJhZmZpeCJdJykuZWFjaChmdW5jdGlvbiAoKSB7DQogICAgICB2YXIgJHNweSA9ICQodGhpcykNCiAgICAgICAgLCBkYXRhID0gJHNweS5kYXRhKCkNCg0KICAgICAgZGF0YS5vZmZzZXQgPSBkYXRhLm9mZnNldCB8fCB7fQ0KDQogICAgICBkYXRhLm9mZnNldEJvdHRvbSAmJiAoZGF0YS5vZmZzZXQuYm90dG9tID0gZGF0YS5vZmZzZXRCb3R0b20pDQogICAgICBkYXRhLm9mZnNldFRvcCAmJiAoZGF0YS5vZmZzZXQudG9wID0gZGF0YS5vZmZzZXRUb3ApDQoNCiAgICAgICRzcHkuYWZmaXgoZGF0YSkNCiAgICB9KQ0KICB9KQ0KDQoNCn0od2luZG93LmpRdWVyeSk7
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 58290
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20171120T061438Z
    - ID: "3f4b20e9-36e6-4d45-a423-c86567373f82"
      Hint: Title
      Value: 
- Language: "ja-JP"
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20171120T061438Z
    - ID: "5dd74568-4d4b-44c1-b513-0af5f4cda34f"
      Hint: __Created by
      Value: |
        sitecore\admin
