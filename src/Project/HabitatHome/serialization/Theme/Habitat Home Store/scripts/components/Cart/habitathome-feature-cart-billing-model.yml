---
ID: "83687e9e-e76f-404f-9868-61172eed9ff7"
Parent: "28d0286e-5ee1-4be0-9aee-41d76fa2f651"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: "/sitecore/media library/Themes/Habitat SXA Sites/Habitat Home Store/scripts/components/Cart/habitathome-feature-cart-billing-model"
DB: master
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/83687E9EE76F404F986861172EED9FF7.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  BlobID: "edb243c1-0cc4-4392-804a-94d0799a59df"
  Value: 77u/Ly8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCi8vIENvcHlyaWdodCAyMDE2IFNpdGVjb3JlIENvcnBvcmF0aW9uIEEvUw0KLy8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUNCi8vIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KLy8gICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQovLw0KLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUNCi8vIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsDQovLyBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMNCi8vIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCg0KdmFyIG11c3RFcXVhbCA9IGZ1bmN0aW9uICh2YWwsIG90aGVyKSB7DQogIGlmICh2YWwpIHsNCiAgICByZXR1cm4gdmFsID09PSBvdGhlcjsNCiAgfQ0KDQogIHJldHVybiB0cnVlOw0KfTsNCg0KLy8gLS0tLS1bR0lGVCBDQVJEIFBBWU1FTlQgTU9ERUxdLS0tLS0NCmZ1bmN0aW9uIEdpZnRDYXJkUGF5bWVudFZpZXdNb2RlbChiaWxsaW5nVmlld01vZGVsLCBjYXJkKSB7DQogIHZhciBzZWxmID0gdGhpczsNCg0KICBzZWxmLmJpbGxpbmdWaWV3TW9kZWwgPSBiaWxsaW5nVmlld01vZGVsOw0KDQogIHNlbGYuaXNBZGRlZCA9IGtvLm9ic2VydmFibGUoZmFsc2UpOw0KICBzZWxmLmJhbGFuY2UgPSBrby5vYnNlcnZhYmxlKDApOw0KICBzZWxmLmZvcm1hdHRlZEJhbGFuY2UgPSBrby5vYnNlcnZhYmxlKCcnKTsNCiAgc2VsZi5lbmFibGVBZGRDYXJkID0ga28ub2JzZXJ2YWJsZShmYWxzZSk7DQoNCiAgc2VsZi5naWZ0Q2FyZE51bWJlciA9IGNhcmQNCiAgICA/IGtvLnZhbGlkYXRlZE9ic2VydmFibGUoY2FyZC5QYXltZW50TWV0aG9kSUQpLmV4dGVuZCh7IHJlcXVpcmVkOiB0cnVlIH0pDQogICAgOiBrby52YWxpZGF0ZWRPYnNlcnZhYmxlKCcnKS5leHRlbmQoeyByZXF1aXJlZDogdHJ1ZSB9KTsNCiAgc2VsZi5naWZ0Q2FyZE51bWJlci5zdWJzY3JpYmUoDQogICAgZnVuY3Rpb24gKGNuKSB7DQogICAgICBzZWxmLmJhbGFuY2UoMCk7DQogICAgICBzZWxmLmZvcm1hdHRlZEJhbGFuY2UoJycpOw0KDQogICAgICBzZWxmLnJlRW5hYmxlQWRkQ2FyZCgpOw0KICAgICAgLy8gc2VsZi5lbmFibGVBZGRDYXJkKGNuLmxlbmd0aCA+IDAgJiYgc2VsZi5naWZ0Q2FyZEFtb3VudCgpLmxlbmd0aCA+IDAgJiYgc2VsZi5pc0FkZGVkKCkgPT09IGZhbHNlKTsNCiAgICB9LmJpbmQodGhpcykNCiAgKTsNCg0KICBzZWxmLnJlbG9hZCA9IGZ1bmN0aW9uIChkYXRhKSB7DQogICAgc2VsZi5naWZ0Q2FyZE51bWJlcihkYXRhLkV4dGVybmFsSWQpOw0KICAgIHNlbGYuZm9ybWF0dGVkQmFsYW5jZShkYXRhLkZvcm1hdHRlZEJhbGFuY2UpOw0KICAgIHNlbGYuYmFsYW5jZShkYXRhLkJhbGFuY2UpOw0KICAgIC8vIHNlbGYuZW5hYmxlQWRkQ2FyZChmYWxzZSk7DQogICAgc2VsZi5yZUVuYWJsZUFkZENhcmQoKTsNCiAgfTsNCg0KICBzZWxmLnJlRW5hYmxlQWRkQ2FyZCA9IGZ1bmN0aW9uIChjYSkgew0KICAgIGlmICghY2EpIHsNCiAgICAgIGNhID0gc2VsZi5naWZ0Q2FyZEFtb3VudCgpOw0KICAgIH0NCg0KICAgIHNlbGYuZW5hYmxlQWRkQ2FyZCgNCiAgICAgIGNhLmxlbmd0aCA+IDAgJiYNCiAgICAgIHNlbGYuZ2lmdENhcmROdW1iZXIoKS5sZW5ndGggPiAwICYmDQogICAgICBzZWxmLmlzQWRkZWQoKSA9PT0gZmFsc2UgJiYNCiAgICAgIHNlbGYuZ2lmdENhcmRBbW91bnQuaXNWYWxpZCgpICYmDQogICAgICBzZWxmLmJhbGFuY2UoKSA+IDANCiAgICApOw0KICB9Ow0KDQogIHNlbGYuZ2V0QmFsYW5jZSA9IGZ1bmN0aW9uICgpIHsNCiAgICBNZXNzYWdlQ29udGV4dC5DbGVhckFsbE1lc3NhZ2VzKCk7DQogICAgdmFyICRidG4gPSAkKCcuZ2l0LWNhcmQtcGF5bWVudC1nZXQtYmFsYW5jZS1idG4nKS5idXR0b24oJ2xvYWRpbmcnKTsNCiAgICB2YXIgZGF0YSA9IHt9Ow0KICAgIGRhdGEuR2lmdENhcmRJZCA9IHNlbGYuZ2lmdENhcmROdW1iZXIoKTsNCiAgICBBamF4U2VydmljZS5Qb3N0KA0KICAgICAgJy9hcGkvY3hhL2NoZWNrb3V0L2dldGdpZnRjYXJkYmFsYW5jZScsDQogICAgICBkYXRhLA0KICAgICAgZnVuY3Rpb24gKGRhdGEsIHN1Y2Nlc3MsIHNlbmRlcikgew0KICAgICAgICBpZiAoc3VjY2VzcyAmJiBkYXRhLlN1Y2Nlc3MpIHsNCiAgICAgICAgICBzZWxmLnJlbG9hZChkYXRhKTsNCiAgICAgICAgfQ0KDQogICAgICAgICQoJy5naXQtY2FyZC1wYXltZW50LWdldC1iYWxhbmNlLWJ0bicpLmJ1dHRvbigncmVzZXQnKTsNCiAgICAgIH0sDQogICAgICB0aGlzDQogICAgKTsNCiAgfTsNCg0KICBzZWxmLmFwcGx5QmFsYW5jZSA9IGZ1bmN0aW9uICgpIHsNCiAgICBNZXNzYWdlQ29udGV4dC5DbGVhckFsbE1lc3NhZ2VzKCk7DQogICAgdmFyIGJhbGFuY2UgPSBzZWxmLmJhbGFuY2UoKTsNCiAgICBpZiAoYmFsYW5jZSA8PSAwKSB7DQogICAgICByZXR1cm47DQogICAgfQ0KDQogICAgdmFyIG9yZGVyVG90YWwgPSBzZWxmLmJpbGxpbmdWaWV3TW9kZWwuY2FydCgpLnRvdGFsQW1vdW50KCk7DQogICAgaWYgKGJhbGFuY2UgPiBvcmRlclRvdGFsKSB7DQogICAgICBzZWxmLmdpZnRDYXJkQW1vdW50UmF3VmFsdWUob3JkZXJUb3RhbCk7DQogICAgfSBlbHNlIGlmIChiYWxhbmNlIDw9IG9yZGVyVG90YWwpIHsNCiAgICAgIHNlbGYuZ2lmdENhcmRBbW91bnRSYXdWYWx1ZShiYWxhbmNlKTsNCiAgICB9DQoNCiAgICBzZWxmLmVuYWJsZUFkZENhcmQodHJ1ZSk7DQogIH07DQoNCiAgc2VsZi5hZGRDYXJkID0gZnVuY3Rpb24gKCkgew0KICAgIE1lc3NhZ2VDb250ZXh0LkNsZWFyQWxsTWVzc2FnZXMoKTsNCiAgICBzZWxmLmlzQWRkZWQodHJ1ZSk7DQogICAgc2VsZi5lbmFibGVBZGRDYXJkKGZhbHNlKTsNCiAgICBzZWxmLnJldmFsdWVBbW91bnRzKCk7DQogIH07DQoNCiAgc2VsZi5yZW1vdmVDYXJkID0gZnVuY3Rpb24gKCkgew0KICAgIE1lc3NhZ2VDb250ZXh0LkNsZWFyQWxsTWVzc2FnZXMoKTsNCiAgICBzZWxmLmlzQWRkZWQoZmFsc2UpOw0KICAgIHNlbGYuZ2lmdENhcmROdW1iZXIoJycpOw0KICAgIHNlbGYuZm9ybWF0dGVkQmFsYW5jZSgnJyk7DQogICAgc2VsZi5naWZ0Q2FyZEFtb3VudFJhd1ZhbHVlKDAuMCk7DQogICAgc2VsZi5iYWxhbmNlKDAuMCk7DQogIH07DQoNCiAgc2VsZi5yZXZhbHVlQW1vdW50cyA9IGZ1bmN0aW9uICgpIHsNCiAgICBpZiAoIXNlbGYuaXNBZGRlZCgpKSB7DQogICAgICByZXR1cm47DQogICAgfQ0KDQogICAgdmFyIGNjSXNBZGRlZCA9IHNlbGYuYmlsbGluZ1ZpZXdNb2RlbC5jcmVkaXRDYXJkUGF5bWVudCgpLmlzQWRkZWQoKTsNCiAgICBpZiAoIWNjSXNBZGRlZCkgew0KICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIHZhciBjY0Ftb3VudCA9IHBhcnNlRmxvYXQoc2VsZi5iaWxsaW5nVmlld01vZGVsLmNyZWRpdENhcmRQYXltZW50KCkuY3JlZGl0Q2FyZEFtb3VudCgpKTsNCiAgICB2YXIgdG90YWwgPSBwYXJzZUZsb2F0KHNlbGYuYmlsbGluZ1ZpZXdNb2RlbC5jYXJ0KCkudG90YWxBbW91bnQoKSk7DQogICAgdmFyIGFUb3RhbCA9IHBhcnNlRmxvYXQocGFyc2VGbG9hdChzZWxmLmdpZnRDYXJkQW1vdW50UmF3VmFsdWUoKSkgKyBjY0Ftb3VudCk7DQoNCiAgICBpZiAoYVRvdGFsID4gdG90YWwpIHsNCiAgICAgIHZhciBjb3VudCA9IDE7DQogICAgICB2YXIgZGlmZiA9IChhVG90YWwgLSB0b3RhbCkgLyBjb3VudDsNCiAgICAgIGNjQW1vdW50ID0gY2NJc0FkZGVkID8gY2NBbW91bnQgLSBkaWZmIDogMDsNCiAgICAgIHNlbGYuYmlsbGluZ1ZpZXdNb2RlbC5jcmVkaXRDYXJkUGF5bWVudCgpLmNyZWRpdENhcmRBbW91bnQoY2NBbW91bnQudG9GaXhlZCgyKSk7DQogICAgfQ0KICB9Ow0KDQogIHNlbGYuZ2lmdENhcmRBbW91bnQgPSBrby52YWxpZGF0ZWRPYnNlcnZhYmxlKDAuMCkuZXh0ZW5kKHsgcmVxdWlyZWQ6IHRydWUsIG51bWJlcjogdHJ1ZSB9KTsNCg0KICBzZWxmLmdpZnRDYXJkQW1vdW50UmF3VmFsdWUgPSBrby5jb21wdXRlZCh7DQogICAgcmVhZDogZnVuY3Rpb24gKCkgew0KICAgICAgdmFsdWUgPSBzZWxmLmdpZnRDYXJkQW1vdW50KCk7DQoNCiAgICAgIGlmIChzZWxmLmJpbGxpbmdWaWV3TW9kZWwpIHsNCiAgICAgICAgdmFsdWUgPSB2YWx1ZS50b1N0cmluZygpOw0KICAgICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2Uoc2VsZi5iaWxsaW5nVmlld01vZGVsLmN1cnJlbmN5RGVjaW1hbFNlcGFyYXRvcigpLCAnLicpOw0KICAgICAgfQ0KDQogICAgICByZXR1cm4gdmFsdWU7DQogICAgfSwNCiAgICB3cml0ZTogZnVuY3Rpb24gKHZhbHVlKSB7DQogICAgICBpZiAoc2VsZi5iaWxsaW5nVmlld01vZGVsKSB7DQogICAgICAgIHZhbHVlID0gdmFsdWUudG9TdHJpbmcoKTsNCiAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKCcuJywgc2VsZi5iaWxsaW5nVmlld01vZGVsLmN1cnJlbmN5RGVjaW1hbFNlcGFyYXRvcigpKTsNCiAgICAgIH0NCg0KICAgICAgc2VsZi5naWZ0Q2FyZEFtb3VudCh2YWx1ZSk7DQogICAgfQ0KICB9KTsNCg0KICBzZWxmLmdpZnRDYXJkQW1vdW50LnN1YnNjcmliZSgNCiAgICBmdW5jdGlvbiAoY2EpIHsNCiAgICAgIHNlbGYucmVFbmFibGVBZGRDYXJkKGNhKTsNCiAgICAgIHNlbGYucmV2YWx1ZUFtb3VudHMoKTsNCiAgICB9LmJpbmQodGhpcykNCiAgKTsNCg0KICBzZWxmLmFkZEdpZnRDYXJkID0gZnVuY3Rpb24gKGNhcmREYXRhKSB7DQogICAgc2VsZi5naWZ0Q2FyZE51bWJlcihjYXJkRGF0YSAmJiBjYXJkRGF0YS5HaWZ0Q2FyZE51bWJlciA/IGNhcmREYXRhLkdpZnRDYXJkTnVtYmVyIDogJycpOw0KICAgIHNlbGYuZ2lmdENhcmRBbW91bnRSYXdWYWx1ZShjYXJkRGF0YS5BbW91bnQpOw0KICAgIHNlbGYuaXNBZGRlZCh0cnVlKTsNCiAgfTsNCn0NCg0KLy8gLS0tLS1bQ1JFRElUQ0FSRCBQQVlNRU5UIE1PREVMXS0tLS0tDQpmdW5jdGlvbiBDcmVkaXRDYXJkUGF5bWVudFZpZXdNb2RlbChjYXJkLCBjaGVja291dFZpZXdNb2RlbCkgew0KICB2YXIgc2VsZiA9IHRoaXM7DQoNCiAgc2VsZi5jaGVja291dFZpZXdNb2RlbCA9IGNoZWNrb3V0Vmlld01vZGVsOw0KDQogIHNlbGYuaXNBZGRlZCA9IGtvLm9ic2VydmFibGUoZmFsc2UpOw0KICBzZWxmLmNyZWRpdENhcmROdW1iZXIgPSBrby52YWxpZGF0ZWRPYnNlcnZhYmxlKCkuZXh0ZW5kKHsgcmVxdWlyZWQ6IHRydWUsIG51bWJlcjogdHJ1ZSB9KTsNCiAgc2VsZi5jcmVkaXRDYXJkTnVtYmVyTWFza2VkID0ga28ub2JzZXJ2YWJsZSgpOw0KICBzZWxmLmNyZWRpdENhcmROdW1iZXIuc3Vic2NyaWJlKGZ1bmN0aW9uIChudW1iZXIpIHsNCiAgICBzZWxmLmNyZWRpdENhcmROdW1iZXJNYXNrZWQoJ1hYWFggWFhYWCBYWFhYICcgKyBudW1iZXIuc3Vic3RyKG51bWJlci5sZW5ndGggLSA0KSk7DQogIH0pOw0KDQogIHNlbGYuZGVzY3JpcHRpb24gPSBrby5vYnNlcnZhYmxlKCk7DQoNCiAgc2VsZi5leGlzdGluZ1BheW1lbnRBbW91bnQgPSBrby5vYnNlcnZhYmxlKGNhcmQgPyBjYXJkLkFtb3VudCA6IDApOw0KDQogIHNlbGYucGF5bWVudE1ldGhvZElEID0gY2FyZA0KICAgID8ga28udmFsaWRhdGVkT2JzZXJ2YWJsZShjYXJkLlBheW1lbnRNZXRob2RJRCkuZXh0ZW5kKHsgcmVxdWlyZWQ6IHRydWUgfSkNCiAgICA6IGtvLnZhbGlkYXRlZE9ic2VydmFibGUoKS5leHRlbmQoeyByZXF1aXJlZDogdHJ1ZSB9KTsNCiAgc2VsZi5wYXltZW50TWV0aG9kSUQuc3Vic2NyaWJlKGZ1bmN0aW9uIChtZXRob2RJZCkgew0KICAgIGlmIChtZXRob2RJZCAhPT0gJzAnKSB7DQogICAgICBzZWxmLmlzQWRkZWQodHJ1ZSk7DQoNCiAgICAgIHZhciBwYXltZW50TWV0aG9kID0ga28udXRpbHMuYXJyYXlGaXJzdChzZWxmLmNoZWNrb3V0Vmlld01vZGVsLnBheW1lbnRNZXRob2RzKCksIGZ1bmN0aW9uIChhKSB7DQogICAgICAgIGlmIChhLkV4dGVybmFsSWQgPT09IG1ldGhvZElkKSB7DQogICAgICAgICAgcmV0dXJuIGE7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgIH0pOw0KDQogICAgICBzZWxmLmRlc2NyaXB0aW9uKHBheW1lbnRNZXRob2QgPyBwYXltZW50TWV0aG9kLkRlc2NyaXB0aW9uIDogJycpOw0KICAgICAgc2VsZi5jaGVja291dFZpZXdNb2RlbC5jcmVkaXRDYXJkRW5hYmxlKHRydWUpOw0KICAgICAgc2VsZi5jaGVja291dFZpZXdNb2RlbC5iaWxsaW5nQWRkcmVzc0VuYWJsZSh0cnVlKTsNCiAgICB9IGVsc2Ugew0KICAgICAgc2VsZi5pc0FkZGVkKGZhbHNlKTsNCiAgICAgIHNlbGYuY2hlY2tvdXRWaWV3TW9kZWwuY3JlZGl0Q2FyZEVuYWJsZShmYWxzZSk7DQogICAgICBzZWxmLmNoZWNrb3V0Vmlld01vZGVsLmJpbGxpbmdBZGRyZXNzRW5hYmxlKGZhbHNlKTsNCiAgICB9DQogIH0pOw0KDQogIHNlbGYuY2hhbmdlUGF5bWVudCA9IGtvLm9ic2VydmFibGUoZmFsc2UpOw0KICBzZWxmLmRpc3BsYXlFeGlzdGluZ1BheW1lbnRNZXNzYWdlID0ga28uY29tcHV0ZWQoew0KICAgIHJlYWQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgIGlmICgNCiAgICAgICAgc2VsZi5jaGVja291dFZpZXdNb2RlbC5lZGl0TW9kZSgpICYmDQogICAgICAgIHBhcnNlRmxvYXQoc2VsZi5leGlzdGluZ1BheW1lbnRBbW91bnQoKSkgPT09IHBhcnNlRmxvYXQoc2VsZi5jcmVkaXRDYXJkQW1vdW50KCkpICYmDQogICAgICAgICFzZWxmLmNoYW5nZVBheW1lbnQoKQ0KICAgICAgKSB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0sDQogICAgd3JpdGU6IGZ1bmN0aW9uICgpIHsgfQ0KICB9KTsNCg0KICBzZWxmLm11c3RSZXZhbGlkYXRlUGF5bWVudE1lc3NhZ2UgPSBrby5vYnNlcnZhYmxlKGNhcmQgPyBjYXJkLkNhcnRBbW91bnREaWZmZXJlbnRUaGFuUGF5bWVudE1lc3NhZ2UgOiAnJyk7DQogIHNlbGYubXVzdFJldmFsaWRhdGVQYXltZW50ID0ga28uY29tcHV0ZWQoew0KICAgIHJlYWQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgIGlmIChzZWxmLmNoZWNrb3V0Vmlld01vZGVsLmVkaXRNb2RlKCkgJiYgcGFyc2VGbG9hdChzZWxmLmV4aXN0aW5nUGF5bWVudEFtb3VudCgpKSAhPT0gcGFyc2VGbG9hdChzZWxmLmNyZWRpdENhcmRBbW91bnQoKSkpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9DQogICAgICByZXR1cm4gZmFsc2U7DQogICAgfSwNCiAgICB3cml0ZTogZnVuY3Rpb24gKCkgeyB9DQogIH0pOw0KDQogIHNlbGYuY3JlZGl0Q2FyZEFtb3VudCA9IGtvLmNvbXB1dGVkKHsNCiAgICByZWFkOiBmdW5jdGlvbiAoKSB7DQogICAgICBpZiAoIXNlbGYuaXNBZGRlZCgpKSB7DQogICAgICAgIHJldHVybiAwOw0KICAgICAgfQ0KDQogICAgICB2YXIgdG90YWwgPSBzZWxmLmNoZWNrb3V0Vmlld01vZGVsLmNhcnQoKSA/IHNlbGYuY2hlY2tvdXRWaWV3TW9kZWwuY2FydCgpLnRvdGFsQW1vdW50KCkgOiAwOw0KICAgICAgdmFyIGdjQW1vdW50ID0gc2VsZi5jaGVja291dFZpZXdNb2RlbC5naWZ0Q2FyZFBheW1lbnQoKQ0KICAgICAgICA/IHNlbGYuY2hlY2tvdXRWaWV3TW9kZWwuZ2lmdENhcmRQYXltZW50KCkuZ2lmdENhcmRBbW91bnRSYXdWYWx1ZSgpDQogICAgICAgIDogMDsNCiAgICAgIHZhciBjY0Ftb3VudCA9IChwYXJzZUZsb2F0KHRvdGFsKSAtIHBhcnNlRmxvYXQoZ2NBbW91bnQpKS50b0ZpeGVkKDIpOw0KDQogICAgICBpZiAoY2NBbW91bnQgPD0gMCkgew0KICAgICAgICBzZWxmLmlzQWRkZWQoZmFsc2UpOw0KICAgICAgfQ0KDQogICAgICByZXR1cm4gY2NBbW91bnQ7DQogICAgfSwNCiAgICB3cml0ZTogZnVuY3Rpb24gKCkgeyB9DQogIH0pOw0KDQogIHNlbGYub3JpZ2luYWxFeGlzdGluZ1BheW1lbnRNZXNzYWdlID0ga28ub2JzZXJ2YWJsZShjYXJkID8gY2FyZC5FeGlzdGluZ1BheW1lbnRNZXNzYWdlIDogJycpOw0KICBzZWxmLmV4aXN0aW5nUGF5bWVudE1lc3NhZ2UgPSBrby5jb21wdXRlZCh7DQogICAgcmVhZDogZnVuY3Rpb24gKCkgew0KICAgICAgaWYgKHNlbGYuY3JlZGl0Q2FyZEFtb3VudCgpKSB7DQogICAgICAgIHJldHVybiBzZWxmLm9yaWdpbmFsRXhpc3RpbmdQYXltZW50TWVzc2FnZSgpLmZvcm1hdChzZWxmLmNyZWRpdENhcmRBbW91bnQoKSk7DQogICAgICB9DQogICAgICByZXR1cm4gJyc7DQogICAgfSwNCiAgICB3cml0ZTogZnVuY3Rpb24gKCkgeyB9DQogIH0pOw0KDQogIHNlbGYucGFydHlJRCA9IGNhcmQgPyBrby5vYnNlcnZhYmxlKGNhcmQuUGFydHlJRCkgOiBrby5vYnNlcnZhYmxlKCk7DQp9DQoNCi8vIC0tLS0tW0JJTExJTkcgREFUQSBNT0RFTF0tLS0tLQ0KZnVuY3Rpb24gQmlsbGluZ0RhdGFWaWV3TW9kZWwoKSB7DQogIHZhciBzZWxmID0gdGhpczsNCg0KICB2YXIgUGF5bWVudFR5cGVzID0gew0KICAgIEdpZnRDYXJkOiAzLA0KICAgIEZlZGVyYXRlZFBheW1lbnQ6IDQNCiAgfTsNCg0KICBzZWxmLmNhcnQgPSBrby5vYnNlcnZhYmxlKCcnKTsNCg0KICBzZWxmLmVkaXRNb2RlID0ga28ub2JzZXJ2YWJsZShmYWxzZSk7DQoNCiAgdmFyIENvdW50cnkgPSBmdW5jdGlvbiAobmFtZSwgY29kZSkgew0KICAgIHRoaXMuY291bnRyeSA9IG5hbWU7DQogICAgdGhpcy5jb2RlID0gY29kZTsNCiAgfTsNCiAgc2VsZi5jb3VudHJpZXMgPSBrby5vYnNlcnZhYmxlQXJyYXkoKTsNCg0KICBzZWxmLmlzQXV0aGVudGljYXRlZCA9IGZhbHNlOw0KICBzZWxmLnVzZXJFbWFpbCA9ICcnOw0KDQogIHNlbGYuaXNTaGlwQWxsID0ga28ub2JzZXJ2YWJsZShmYWxzZSk7DQoNCiAgc2VsZi5jdWx0dXJlRGVjaW1hbFNlcGFyYXRvciA9IGtvLm9ic2VydmFibGUoKTsNCiAgc2VsZi5jdXJyZW5jeURlY2ltYWxTZXBhcmF0b3IgPSBrby5vYnNlcnZhYmxlKCk7DQogIHNlbGYuY3VycmVuY3lHcm91cFNlcGFyYXRvciA9IGtvLm9ic2VydmFibGUoKTsNCg0KICBzZWxmLnVzZXJBZGRyZXNzZXMgPSBrby5vYnNlcnZhYmxlQXJyYXkoKTsNCiAgc2VsZi5oYXNEaWdpdGFsUHJvZHVjdHNJbkNhcnQgPSBmYWxzZTsNCiAgc2VsZi51c2VyQWRkcmVzc2VzLnB1c2gobmV3IEFkZHJlc3NWaWV3TW9kZWwoeyBFeHRlcm5hbElkOiAnVXNlT3RoZXInLCBGdWxsQWRkcmVzczogJCgnI090aGVyQWRkcmVzc0xhYmVsJykudmFsKCkgfSkpOw0KDQogIHNlbGYuYmlsbGluZ0VtYWlsID0ga28udmFsaWRhdGVkT2JzZXJ2YWJsZShzZWxmLnVzZXJFbWFpbCkuZXh0ZW5kKHsgcmVxdWlyZWQ6IHRydWUsIGVtYWlsOiB0cnVlIH0pOw0KICBzZWxmLmJpbGxpbmdDb25maXJtRW1haWwgPSBrby52YWxpZGF0ZWRPYnNlcnZhYmxlKHNlbGYudXNlckVtYWlsKS5leHRlbmQoew0KICAgIHJlcXVpcmVkOiB0cnVlLA0KICAgIHZhbGlkYXRpb246IHsgdmFsaWRhdG9yOiBtdXN0RXF1YWwsIG1lc3NhZ2U6ICQoJyNFbWFpbHNNdXN0TWF0Y2hNZXNzYWdlJykudmFsKCksIHBhcmFtczogc2VsZi5iaWxsaW5nRW1haWwgfQ0KICB9KTsNCg0KICBzZWxmLnBheUZlZGVyYXRlZFBheW1lbnQgPSBrby5vYnNlcnZhYmxlKGZhbHNlKTsNCiAgc2VsZi5wYXlHaWZ0Q2FyZCA9IGtvLm9ic2VydmFibGUoZmFsc2UpOw0KICBzZWxmLmNhcmRQYXltZW50QWNjZXB0UGFnZVVybCA9IGtvLm9ic2VydmFibGUoJycpOw0KICBzZWxmLmNhcmRQYXltZW50UmVzdWx0QWNjZXNzQ29kZSA9IGtvLm9ic2VydmFibGUoJycpOw0KICBzZWxmLmNhcmRQYXltZW50QWNjZXB0Q2FyZFByZWZpeCA9ICcnOw0KICBzZWxmLkNBUkRQQVlNRU5UQUNDRVBUUEFHRUhFSUdIVCA9ICdtc2F4LWNjLWhlaWdodCc7DQogIHNlbGYuQ0FSRFBBWU1FTlRBQ0NFUFRQQUdFRVJST1IgPSAnbXNheC1jYy1lcnJvcic7DQogIHNlbGYuQ0FSRFBBWU1FTlRBQ0NFUFRQQUdFUkVTVUxUID0gJ21zYXgtY2MtcmVzdWx0JzsNCiAgc2VsZi5DQVJEUEFZTUVOVEFDQ0VQVFBBR0VTVUJNSVQgPSAnbXNheC1jYy1zdWJtaXQnOw0KICBzZWxmLkNBUkRQQVlNRU5UQUNDRVBUQ0FSRFBSRUZJWCA9ICdtc2F4LWNjLWNhcmRwcmVmaXgnOw0KDQogIHZhciBQYXltZW50TWV0aG9kID0gZnVuY3Rpb24gKGV4dGVybmFsSWQsIGRlc2NyaXB0aW9uKSB7DQogICAgdGhpcy5FeHRlcm5hbElkID0gZXh0ZXJuYWxJZDsNCiAgICB0aGlzLkRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247DQogIH07DQoNCiAgc2VsZi5wYXltZW50TWV0aG9kcyA9IGtvLm9ic2VydmFibGVBcnJheSgpOw0KICBzZWxmLnBheW1lbnRDbGllbnRUb2tlbiA9IGtvLm9ic2VydmFibGUoJycpOw0KDQogIHNlbGYuZ2lmdENhcmRQYXltZW50ID0ga28udmFsaWRhdGVkT2JzZXJ2YWJsZShuZXcgR2lmdENhcmRQYXltZW50Vmlld01vZGVsKHNlbGYpKTsNCiAgc2VsZi5jcmVkaXRDYXJkUGF5bWVudCA9IGtvLnZhbGlkYXRlZE9ic2VydmFibGUobmV3IENyZWRpdENhcmRQYXltZW50Vmlld01vZGVsKG51bGwsIHNlbGYpKTsNCiAgc2VsZi5jcmVkaXRDYXJkRW5hYmxlID0ga28ub2JzZXJ2YWJsZShmYWxzZSk7DQogIHNlbGYuYmlsbGluZ0FkZHJlc3MgPSBrby52YWxpZGF0ZWRPYnNlcnZhYmxlKG5ldyBBZGRyZXNzVmlld01vZGVsKHsgRXh0ZXJuYWxJZDogJzEnIH0pKTsNCiAgc2VsZi5iaWxsaW5nQWRkcmVzc0VuYWJsZSA9IGtvLm9ic2VydmFibGUoZmFsc2UpOw0KICBzZWxmLnNoaXBwaW5nQWRkcmVzcyA9IGtvLm9ic2VydmFibGUoKTsNCiAgc2VsZi5zZWxlY3RlZEJpbGxpbmdBZGRyZXNzID0ga28ub2JzZXJ2YWJsZSgnVXNlT3RoZXInKTsNCiAgc2VsZi5zZWxlY3RlZEJpbGxpbmdBZGRyZXNzLnN1YnNjcmliZShmdW5jdGlvbiAoaWQpIHsNCiAgICBpZiAoaWQgPT09ICdVc2VTaGlwcGluZycpIHsNCiAgICAgIHNlbGYuYmlsbGluZ0FkZHJlc3NFbmFibGUoZmFsc2UpOw0KICAgICAgc2VsZi5iaWxsaW5nQWRkcmVzcyhzZWxmLnNoaXBwaW5nQWRkcmVzcygpKTsNCiAgICB9IGVsc2Ugew0KICAgICAgdmFyIG1hdGNoID0gc2VsZi5nZXRBZGRyZXNzKGlkKTsNCiAgICAgIGlmIChtYXRjaCkgew0KICAgICAgICBzZWxmLmJpbGxpbmdBZGRyZXNzRW5hYmxlKGZhbHNlKTsNCiAgICAgICAgc2VsZi5iaWxsaW5nQWRkcmVzcyhtYXRjaCk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBzZWxmLmJpbGxpbmdBZGRyZXNzRW5hYmxlKHRydWUpOw0KICAgICAgICBzZWxmLmJpbGxpbmdBZGRyZXNzKG5ldyBBZGRyZXNzVmlld01vZGVsKHsgRXh0ZXJuYWxJZDogJzEnIH0pKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICAkKCcuc2VsZWN0LWJpbGxpbmctYWRkcmVzcycpLnByb3AoJ2Rpc2FibGVkJywgZmFsc2UpOw0KICB9KTsNCg0KICBzZWxmLnBheW1lbnRUb3RhbCA9IGtvLmNvbXB1dGVkKHsNCiAgICByZWFkOiBmdW5jdGlvbiAoKSB7DQogICAgICB2YXIgY2NJc0FkZGVkID0gc2VsZi5jcmVkaXRDYXJkUGF5bWVudCgpLmlzQWRkZWQoKTsNCiAgICAgIHZhciBnY0lzQWRkZWQgPSBzZWxmLmdpZnRDYXJkUGF5bWVudCgpLmlzQWRkZWQoKTsNCiAgICAgIGlmICghY2NJc0FkZGVkICYmICFnY0lzQWRkZWQpIHsNCiAgICAgICAgcmV0dXJuIDA7DQogICAgICB9DQoNCiAgICAgIHZhciBjY0Ftb3VudCA9IGNjSXNBZGRlZCA/IHNlbGYuY3JlZGl0Q2FyZFBheW1lbnQoKS5jcmVkaXRDYXJkQW1vdW50KCkgOiAwOw0KICAgICAgdmFyIGdjQW1vdW50ID0gZ2NJc0FkZGVkID8gc2VsZi5naWZ0Q2FyZFBheW1lbnQoKS5naWZ0Q2FyZEFtb3VudFJhd1ZhbHVlKCkgOiAwOw0KICAgICAgcmV0dXJuIChwYXJzZUZsb2F0KGNjQW1vdW50KSArIHBhcnNlRmxvYXQoZ2NBbW91bnQpKS50b0ZpeGVkKDIpOw0KICAgIH0sDQogICAgd3JpdGU6IGZ1bmN0aW9uICgpIHsgfQ0KICB9KTsNCg0KICBzZWxmLmVuYWJsZVRvQ29uZmlybSA9IGtvLmNvbXB1dGVkKHsNCiAgICByZWFkOiBmdW5jdGlvbiAoKSB7DQogICAgICBpZiAoc2VsZi5jYXJ0KCkubGVuZ3RoID09PSAwKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCg0KICAgICAgdmFyIHBheW1lbnRUb3RhbElzVmFsaWQgPSBwYXJzZUZsb2F0KHNlbGYucGF5bWVudFRvdGFsKCkpID09PSBwYXJzZUZsb2F0KHNlbGYuY2FydCgpLnRvdGFsQW1vdW50KCkpOw0KICAgICAgaWYgKCFwYXltZW50VG90YWxJc1ZhbGlkKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCg0KICAgICAgdmFyIHBheW1lbnRzQXJlVmFsaWQgPSBmYWxzZTsNCiAgICAgIGlmIChzZWxmLmdpZnRDYXJkUGF5bWVudCgpLmlzQWRkZWQoKSkgew0KICAgICAgICBwYXltZW50c0FyZVZhbGlkID0gc2VsZi5naWZ0Q2FyZFBheW1lbnQuaXNWYWxpZCgpOw0KICAgICAgfQ0KDQogICAgICBpZiAoc2VsZi5jcmVkaXRDYXJkUGF5bWVudCgpLmlzQWRkZWQoKSkgew0KICAgICAgICBpZiAoIXNlbGYucGF5RmVkZXJhdGVkUGF5bWVudCgpKSB7DQogICAgICAgICAgcGF5bWVudHNBcmVWYWxpZCA9IHNlbGYuY3JlZGl0Q2FyZFBheW1lbnQuaXNWYWxpZCgpICYmIHNlbGYuYmlsbGluZ0FkZHJlc3MuaXNWYWxpZCgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHBheW1lbnRzQXJlVmFsaWQgPQ0KICAgICAgICAgICAgc2VsZi5jYXJkUGF5bWVudFJlc3VsdEFjY2Vzc0NvZGUoKSAmJg0KICAgICAgICAgICAgIXNlbGYuY3JlZGl0Q2FyZFBheW1lbnQoKS5tdXN0UmV2YWxpZGF0ZVBheW1lbnQoKSAmJg0KICAgICAgICAgICAgc2VsZi5iaWxsaW5nQWRkcmVzcy5pc1ZhbGlkKCk7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgaWYgKHBheW1lbnRzQXJlVmFsaWQpIHsNCiAgICAgICAga28udmFsaWRhdGlvbi5ncm91cChzZWxmKS5zaG93QWxsTWVzc2FnZXModHJ1ZSk7DQogICAgICB9DQoNCiAgICAgIHJldHVybiBwYXltZW50c0FyZVZhbGlkICYmIHNlbGYuYmlsbGluZ0VtYWlsLmlzVmFsaWQoKSAmJiBzZWxmLmJpbGxpbmdDb25maXJtRW1haWwuaXNWYWxpZCgpOw0KICAgIH0sDQogICAgd3JpdGU6IGZ1bmN0aW9uICh2YWx1ZSkgew0KICAgICAgcmV0dXJuIEJvb2xlYW4odmFsdWUpOw0KICAgIH0NCiAgfSk7DQoNCiAgc2VsZi50b0N1bHR1cmVOdW1iZXJTdHJpbmcgPSBmdW5jdGlvbiAodmFsdWUpIHsNCiAgICBpZiAodmFsdWUpIHsNCiAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgnLicsIHNlbGYuY3VsdHVyZURlY2ltYWxTZXBhcmF0b3IoKSk7DQogICAgfQ0KDQogICAgcmV0dXJuIHZhbHVlOw0KICB9Ow0KDQogIHNlbGYuc2V0UGF5bWVudE1ldGhvZHMgPSBmdW5jdGlvbiAoKSB7DQogICAgdmFyIGRhdGEgPSAneyc7DQoNCiAgICBkYXRhID0gZGF0YSArICciQmlsbGluZ0l0ZW1QYXRoIjoiJyArICQoJyNCaWxsaW5nSXRlbVBhdGgnKS52YWwoKSArICciLCc7DQogICAgZGF0YSA9IGRhdGEgKyAnIlVzZXJFbWFpbCI6JyArICciJyArIHNlbGYuYmlsbGluZ0VtYWlsKCkgKyAnIic7DQoNCiAgICBpZiAoc2VsZi5jcmVkaXRDYXJkUGF5bWVudCgpLmlzQWRkZWQoKSkgew0KICAgICAgdmFyIGNjID0gc2VsZi5jcmVkaXRDYXJkUGF5bWVudCgpOw0KICAgICAgaWYgKHNlbGYucGF5RmVkZXJhdGVkUGF5bWVudCkgew0KICAgICAgICB2YXIgY3JlZGl0Q2FyZCA9IHsNCiAgICAgICAgICBDYXJkVG9rZW46IHNlbGYuY2FyZFBheW1lbnRSZXN1bHRBY2Nlc3NDb2RlKCksDQogICAgICAgICAgQW1vdW50OiBzZWxmLnRvQ3VsdHVyZU51bWJlclN0cmluZyhjYy5jcmVkaXRDYXJkQW1vdW50KCkpLA0KICAgICAgICAgIENhcmRQYXltZW50QWNjZXB0Q2FyZFByZWZpeDogc2VsZi5jYXJkUGF5bWVudEFjY2VwdENhcmRQcmVmaXgNCiAgICAgICAgfTsNCg0KICAgICAgICBpZiAoZGF0YS5sZW5ndGggPiAxKSB7DQogICAgICAgICAgZGF0YSArPSAnLCc7DQogICAgICAgIH0NCg0KICAgICAgICBkYXRhICs9ICciRmVkZXJhdGVkUGF5bWVudCI6JyArIEpTT04uc3RyaW5naWZ5KGNyZWRpdENhcmQpOw0KICAgICAgICBpZiAoc2VsZi5jYXJkUGF5bWVudEFjY2VwdENhcmRQcmVmaXggPT09ICdwYXlwYWwnKSB7DQogICAgICAgICAgdmFyIGJhID0gc2VsZi5iaWxsaW5nQWRkcmVzcygpOw0KICAgICAgICAgIHZhciBiaWxsaW5nQWRkcmVzcyA9IHsNCiAgICAgICAgICAgIE5hbWU6IGJhLm5hbWUoKSwNCiAgICAgICAgICAgIEFkZHJlc3MxOiBiYS5hZGRyZXNzMSgpLA0KICAgICAgICAgICAgQ291bnRyeTogYmEuY291bnRyeSgpLA0KICAgICAgICAgICAgQ2l0eTogYmEuY2l0eSgpLA0KICAgICAgICAgICAgU3RhdGU6IGJhLnN0YXRlKCksDQogICAgICAgICAgICBaaXBQb3N0YWxDb2RlOiBiYS56aXBQb3N0YWxDb2RlKCksDQogICAgICAgICAgICBFeHRlcm5hbElkOiBiYS5leHRlcm5hbElkKCksDQogICAgICAgICAgICBQYXJ0eUlkOiBiYS5leHRlcm5hbElkKCkNCiAgICAgICAgICB9Ow0KDQogICAgICAgICAgaWYgKGRhdGEubGVuZ3RoID4gMSkgew0KICAgICAgICAgICAgZGF0YSArPSAnLCc7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgZGF0YSArPSAnIkJpbGxpbmdBZGRyZXNzIjonICsgSlNPTi5zdHJpbmdpZnkoYmlsbGluZ0FkZHJlc3MpOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KDQogICAgaWYgKHNlbGYuZ2lmdENhcmRQYXltZW50KCkuaXNBZGRlZCgpKSB7DQogICAgICB2YXIgZ2lmdENhcmQgPSB7DQogICAgICAgIFBheW1lbnRNZXRob2RJRDogc2VsZi5naWZ0Q2FyZFBheW1lbnQoKS5naWZ0Q2FyZE51bWJlcigpLA0KICAgICAgICBBbW91bnQ6IHNlbGYudG9DdWx0dXJlTnVtYmVyU3RyaW5nKHNlbGYuZ2lmdENhcmRQYXltZW50KCkuZ2lmdENhcmRBbW91bnRSYXdWYWx1ZSgpKQ0KICAgICAgfTsNCg0KICAgICAgaWYgKGRhdGEubGVuZ3RoID4gMSkgew0KICAgICAgICBkYXRhICs9ICcsJzsNCiAgICAgIH0NCg0KICAgICAgZGF0YSArPSAnIkdpZnRDYXJkUGF5bWVudCI6JyArIEpTT04uc3RyaW5naWZ5KGdpZnRDYXJkKTsNCiAgICB9DQoNCiAgICBkYXRhICs9ICd9JzsNCg0KICAgICQoJy50by1jb25maXJtLWJ1dHRvbicpLmJ1dHRvbignbG9hZGluZycpOw0KICAgIE1lc3NhZ2VDb250ZXh0LkNsZWFyQWxsTWVzc2FnZXMoKTsNCg0KICAgIEFqYXhTZXJ2aWNlLlBvc3QoDQogICAgICAnL2FwaS9jeGEvY2hlY2tvdXQvU2V0UGF5bWVudE1ldGhvZHMnLA0KICAgICAgSlNPTi5wYXJzZShkYXRhKSwNCiAgICAgIGZ1bmN0aW9uIChkYXRhLCBzdWNjZXNzLCBzZW5kZXIpIHsNCiAgICAgICAgaWYgKGRhdGEuU3VjY2VzcyAmJiBzdWNjZXNzKSB7DQogICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBkYXRhLk5leHRQYWdlTGluazsNCiAgICAgICAgfQ0KICAgICAgICAkKCcudG8tY29uZmlybS1idXR0b24nKS5idXR0b24oJ3Jlc2V0Jyk7DQogICAgICB9LA0KICAgICAgJCh0aGlzKQ0KICAgICk7DQogIH07DQoNCiAgc2VsZi5zZXR1cFBhZ2UgPSBmdW5jdGlvbiAoKSB7DQogICAgJCgnLmV4aXN0aW5nLXBheW1lbnQtcmVzZXQtbGluaycpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkgew0KICAgICAgc2VsZi5jcmVkaXRDYXJkUGF5bWVudCgpLmNoYW5nZVBheW1lbnQodHJ1ZSk7DQogICAgfSk7DQogIH07DQoNCiAgc2VsZi5nb1RvTmV4dFBhZ2VDbGljayA9IGZ1bmN0aW9uICgpIHsNCiAgICBzZWxmLnNldFBheW1lbnRNZXRob2RzKCk7DQogIH07DQoNCiAgc2VsZi5nZXRBZGRyZXNzID0gZnVuY3Rpb24gKGlkKSB7DQogICAgdmFyIG1hdGNoID0ga28udXRpbHMuYXJyYXlGaXJzdChzZWxmLnVzZXJBZGRyZXNzZXMoKSwgZnVuY3Rpb24gKGEpIHsNCiAgICAgIGlmIChhLmV4dGVybmFsSWQoKSA9PT0gaWQgJiYgaWQgIT09ICdVc2VPdGhlcicpIHsNCiAgICAgICAgcmV0dXJuIGE7DQogICAgICB9DQoNCiAgICAgIHJldHVybiBudWxsOw0KICAgIH0pOw0KDQogICAgcmV0dXJuIG1hdGNoOw0KICB9Ow0KDQogIGZ1bmN0aW9uIGdldE1vY2tEYXRhKCkgew0KICAgIHZhciBtb2NrRGF0YSA9IHsNCiAgICAgIEN1cnJlbmN5RGVjaW1hbFNlcGFyYXRvcjogbnVsbCwNCiAgICAgIEN1cnJlbmN5R3JvdXBTZXBhcmF0b3I6IG51bGwsDQogICAgICBQYXltZW50T3B0aW9uczogbnVsbCwNCiAgICAgIFBheW1lbnRDbGllbnRUb2tlbjogbnVsbCwNCiAgICAgIFBheW1lbnRNZXRob2RzOiBudWxsLA0KICAgICAgSGFzRGlnaXRhbFByb2R1Y3Q6IGZhbHNlLA0KICAgICAgQ2FydDogbnVsbCwNCiAgICAgIEN1cnJlbmN5Q29kZTogbnVsbCwNCiAgICAgIElzVXNlckF1dGhlbnRpY2F0ZWQ6IGZhbHNlLA0KICAgICAgVXNlckVtYWlsOiBudWxsLA0KICAgICAgQ291bnRyaWVzOiBudWxsLA0KICAgICAgVXNlckFkZHJlc3NlczogbnVsbCwNCiAgICAgIEVycm9yczogW10sDQogICAgICBJbmZvOiBbXSwNCiAgICAgIFdhcm5pbmdzOiBbXSwNCiAgICAgIEhhc0Vycm9yczogZmFsc2UsDQogICAgICBIYXNJbmZvOiBmYWxzZSwNCiAgICAgIEhhc1dhcm5pbmdzOiBmYWxzZSwNCiAgICAgIFN1Y2Nlc3M6IHRydWUsDQogICAgICBVcmw6IG51bGwsDQogICAgICBDb250ZW50RW5jb2Rpbmc6IG51bGwsDQogICAgICBDb250ZW50VHlwZTogbnVsbCwNCiAgICAgIERhdGE6IG51bGwsDQogICAgICBKc29uUmVxdWVzdEJlaGF2aW9yOiAxLA0KICAgICAgTWF4SnNvbkxlbmd0aDogbnVsbCwNCiAgICAgIFJlY3Vyc2lvbkxpbWl0OiBudWxsDQogICAgfTsNCiAgICByZXR1cm4gbW9ja0RhdGE7DQogIH0NCg0KICBmdW5jdGlvbiBpbml0TW9kZWxEYXRhKGRhdGEpIHsNCiAgICBpZiAoZGF0YSAmJiBkYXRhLkNvdW50cmllcykgew0KICAgICAgJC5lYWNoKGRhdGEuQ291bnRyaWVzLCBmdW5jdGlvbiAoaW5kZXgsIHZhbHVlKSB7DQogICAgICAgIHNlbGYuY291bnRyaWVzLnB1c2gobmV3IENvdW50cnkodmFsdWUsIGluZGV4KSk7DQogICAgICB9KTsNCiAgICB9DQoNCiAgICBzZWxmLmNhcnQobmV3IENhcnRWaWV3TW9kZWwoZGF0YS5DYXJ0KSk7DQoNCiAgICAvLyBTZXQgdGhlIHNoaXBwaW5nIGFkZHJlc3MuIE5lZWRlZCBmb3Igc2FtZSBhcyBzaGlwcGluZy4NCiAgICBpZiAoc2VsZi5jYXJ0KCkuc2hpcG1lbnRzLmxlbmd0aCA9PT0gMSkgew0KICAgICAgbGV0IHBhcnR5SWQgPSBzZWxmLmNhcnQoKS5zaGlwbWVudHNbMF0ucGFydHlJZDsNCiAgICAgIGxldCBwYXJ0eSA9IGtvLnV0aWxzLmFycmF5Rmlyc3Qoc2VsZi5jYXJ0KCkucGFydGllcywgZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgaWYgKGEuZXh0ZXJuYWxJZCgpID09PSBwYXJ0eUlkKSB7DQogICAgICAgICAgcmV0dXJuIGE7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgIH0pOw0KDQogICAgICBpZiAocGFydHkpIHsNCiAgICAgICAgc2VsZi5zaGlwcGluZ0FkZHJlc3MocGFydHkpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHNlbGYucGF5bWVudENsaWVudFRva2VuKGRhdGEuUGF5bWVudENsaWVudFRva2VuKTsNCg0KICAgIGlmIChkYXRhICYmIGRhdGEuSXNVc2VyQXV0aGVudGljYXRlZCA9PT0gdHJ1ZSAmJiBkYXRhLlVzZXJBZGRyZXNzZXMgJiYgZGF0YS5Vc2VyQWRkcmVzc2VzLkFkZHJlc3Nlcykgew0KICAgICAgJC5lYWNoKGRhdGEuVXNlckFkZHJlc3Nlcy5BZGRyZXNzZXMsIGZ1bmN0aW9uIChpbmRleCwgYWRkcmVzcykgew0KICAgICAgICBpZiAoYWRkcmVzcy5leHRlcm5hbElkID09PSAnVXNlU2hpcHBpbmcnICYmICRyb290LmlzU2hpcEFsbCgpIHx8IGFkZHJlc3MuZXh0ZXJuYWxJZCAhPT0gJ1VzZVNoaXBwaW5nJykgew0KICAgICAgICAgIHNlbGYudXNlckFkZHJlc3Nlcy5wdXNoKG5ldyBBZGRyZXNzVmlld01vZGVsKHRoaXMpKTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQoNCiAgICAgIHNlbGYuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZTsNCiAgICB9DQoNCiAgICAvLyBDaGVja2luZyBpZiB0aGUgY2FydCBjb250YWlucyBhIGRpZ2l0YWwgcHJvZHVjdCAiSGFzRGlnaXRhbFByb2R1Y3QiDQogICAgLy8gaWYgdHJ1ZSB0aGVuIHRoZSAiU2FtZSBhcyBzaGlwcGluZyBhZGRyZXNzIiB3aWxsIG5vdCBiZSBhdmFpbGFibGUNCiAgICAvLyBlbHNlIGl0IHdpbGwgYmUgYWRkZWQgdG8gbmlsbGluZyBhZGRyZXNzIGxpc3QNCiAgICBzZWxmLmhhc0RpZ2l0YWxQcm9kdWN0c0luQ2FydCA9IGRhdGEuSGFzRGlnaXRhbFByb2R1Y3Q7DQogICAgaWYgKCFzZWxmLmhhc0RpZ2l0YWxQcm9kdWN0c0luQ2FydCkgew0KICAgICAgc2VsZi51c2VyQWRkcmVzc2VzLnB1c2goDQogICAgICAgIG5ldyBBZGRyZXNzVmlld01vZGVsKHsgRXh0ZXJuYWxJZDogJ1VzZVNoaXBwaW5nJywgRnVsbEFkZHJlc3M6ICQoJy5zZWxlY3QtYmlsbGluZy1hZGRyZXNzJykuYXR0cigndGl0bGUnKSB9KQ0KICAgICAgKTsNCiAgICB9DQoNCiAgICBzZWxmLnVzZXJFbWFpbCA9IGRhdGEuVXNlckVtYWlsOw0KICAgIHNlbGYuYmlsbGluZ0VtYWlsKGRhdGEuVXNlckVtYWlsKTsNCiAgICBzZWxmLmJpbGxpbmdDb25maXJtRW1haWwoZGF0YS5Vc2VyRW1haWwpOw0KDQogICAgc2VsZi5jdWx0dXJlRGVjaW1hbFNlcGFyYXRvcihkYXRhLkN1bHR1cmVEZWNpbWFsU2VwYXJhdG9yKTsNCiAgICBzZWxmLmN1cnJlbmN5RGVjaW1hbFNlcGFyYXRvcihkYXRhLkN1cnJlbmN5RGVjaW1hbFNlcGFyYXRvcik7DQogICAgc2VsZi5jdXJyZW5jeUdyb3VwU2VwYXJhdG9yKGRhdGEuQ3VycmVuY3lHcm91cFNlcGFyYXRvcik7DQoNCiAgICBjdXJyZW50TnVtYmVyVmFsaWRhdG9yID0ga28udmFsaWRhdGlvbi5ydWxlcy5udW1iZXIudmFsaWRhdG9yOw0KICAgIGtvLnZhbGlkYXRpb24ucnVsZXMubnVtYmVyLnZhbGlkYXRvciA9IGZ1bmN0aW9uIChuLCB0KSB7DQogICAgICBuID0gbi5yZXBsYWNlKHNlbGYuY3VycmVuY3lEZWNpbWFsU2VwYXJhdG9yKCksICcuJyk7DQoNCiAgICAgIHJldHVybiBjdXJyZW50TnVtYmVyVmFsaWRhdG9yKG4sIHQpICYmICQuaXNOdW1lcmljKG4pOw0KICAgIH07DQoNCiAgICBpZiAoZGF0YSAmJiBkYXRhLlBheW1lbnRPcHRpb25zKSB7DQogICAgICAkLmVhY2goZGF0YS5QYXltZW50T3B0aW9ucywgZnVuY3Rpb24gKGluZGV4LCB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUuUGF5bWVudE9wdGlvblR5cGVOYW1lID09PSAnUGF5RmVkZXJhdGVkUGF5bWVudCcpIHsNCiAgICAgICAgICBzZWxmLnBheUZlZGVyYXRlZFBheW1lbnQodHJ1ZSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHZhbHVlLlBheW1lbnRPcHRpb25UeXBlTmFtZSA9PT0gJ1BheUdpZnRDYXJkJykgew0KICAgICAgICAgIHNlbGYucGF5R2lmdENhcmQodHJ1ZSk7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgIH0NCg0KICAgIGlmIChkYXRhICYmIGRhdGEuUGF5bWVudE1ldGhvZHMpIHsNCiAgICAgIHNlbGYucGF5bWVudE1ldGhvZHMucHVzaChuZXcgUGF5bWVudE1ldGhvZCgnMCcsICQoJyNQYXltZW50TWV0aG9kcycpLmF0dHIoJ3RpdGxlJykpKTsNCiAgICAgICQuZWFjaChkYXRhLlBheW1lbnRNZXRob2RzLCBmdW5jdGlvbiAoaW5kZXgsIHZhbHVlKSB7DQogICAgICAgIHNlbGYucGF5bWVudE1ldGhvZHMucHVzaChuZXcgUGF5bWVudE1ldGhvZCh2YWx1ZS5FeHRlcm5hbElkLCB2YWx1ZS5EZXNjcmlwdGlvbikpOw0KICAgICAgfSk7DQogICAgfQ0KDQogICAgc2VsZi5pc1NoaXBBbGwoISEoZGF0YS5DYXJ0ICYmIGRhdGEuQ2FydC5TaGlwbWVudHMgJiYgZGF0YS5DYXJ0LlNoaXBtZW50cy5sZW5ndGggPT09IDEpKTsNCg0KICAgIGlmIChzZWxmLnBheW1lbnRDbGllbnRUb2tlbigpKSB7DQogICAgICB2YXIgY2xpZW50VG9rZW4gPSBzZWxmLnBheW1lbnRDbGllbnRUb2tlbigpOw0KICAgICAgaWYgKGNsaWVudFRva2VuLmxlbmd0aCA+IDApIHsNCiAgICAgICAgYnJhaW50cmVlLnNldHVwKGNsaWVudFRva2VuLCAnZHJvcGluJywgew0KICAgICAgICAgIGNvbnRhaW5lcjogJ2Ryb3Bpbi1jb250YWluZXInLA0KICAgICAgICAgIHBheW1lbnRNZXRob2ROb25jZVJlY2VpdmVkOiBmdW5jdGlvbiAoZXZlbnQsIG5vbmNlKSB7DQogICAgICAgICAgICBpZiAobm9uY2UubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICBzZWxmLmNhcmRQYXltZW50UmVzdWx0QWNjZXNzQ29kZShub25jZSk7DQogICAgICAgICAgICAgIHNlbGYuY2FyZFBheW1lbnRBY2NlcHRDYXJkUHJlZml4ID0gJ3BheXBhbCc7DQoNCiAgICAgICAgICAgICAgaWYgKHNlbGYuY3JlZGl0Q2FyZFBheW1lbnQoKSAmJiBzZWxmLmVkaXRNb2RlKCkpIHsNCiAgICAgICAgICAgICAgICBzZWxmLmNyZWRpdENhcmRQYXltZW50KCkuZXhpc3RpbmdQYXltZW50QW1vdW50KHNlbGYuY3JlZGl0Q2FyZFBheW1lbnQoKS5jcmVkaXRDYXJkQW1vdW50KCkpOw0KICAgICAgICAgICAgICAgIHNlbGYuY3JlZGl0Q2FyZFBheW1lbnQoKS5jaGFuZ2VQYXltZW50KGZhbHNlKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICB9DQogICAgfQ0KDQogICAgaWYgKGRhdGEuQ2FydCAmJiBkYXRhLkNhcnQuQWNjb3VudGluZ1BhcnR5KSB7DQogICAgICB2YXIgcGFydHlJZCA9IGRhdGEuQ2FydC5BY2NvdW50aW5nUGFydHkuUGFydHlJRDsNCiAgICAgIHZhciBwYXJ0eSA9IGtvLnV0aWxzLmFycmF5Rmlyc3Qoc2VsZi5jYXJ0KCkucGFydGllcywgZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgaWYgKGEuZXh0ZXJuYWxJZCgpID09PSBwYXJ0eUlkKSB7DQogICAgICAgICAgcmV0dXJuIGE7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgIH0pOw0KDQogICAgICBpZiAocGFydHkpIHsNCiAgICAgICAgc2VsZi5iaWxsaW5nQWRkcmVzcyhwYXJ0eSk7DQogICAgICB9DQogICAgfQ0KDQogICAgaWYgKGRhdGEuQ2FydCAmJiBkYXRhLkNhcnQuUGF5bWVudHMgJiYgZGF0YS5DYXJ0LlBheW1lbnRzLmxlbmd0aCA+IDApIHsNCiAgICAgIHZhciBnaWZ0Q2FyZEFkZGVkID0gZmFsc2U7DQogICAgICB2YXIgZmVkUGF5bWVudEFkZGVkID0gZmFsc2U7DQogICAgICAkLmVhY2goZGF0YS5DYXJ0LlBheW1lbnRzLCBmdW5jdGlvbiAoaW5kZXgsIFZhbHVlKSB7DQogICAgICAgIGlmIChWYWx1ZS5QYXltZW50VHlwZSA9PT0gUGF5bWVudFR5cGVzLkZlZGVyYXRlZFBheW1lbnQpIHsNCiAgICAgICAgICBzZWxmLmNyZWRpdENhcmRQYXltZW50KG5ldyBDcmVkaXRDYXJkUGF5bWVudFZpZXdNb2RlbChWYWx1ZSwgc2VsZikpOw0KICAgICAgICAgIHNlbGYucGF5RmVkZXJhdGVkUGF5bWVudCh0cnVlKTsNCiAgICAgICAgICBzZWxmLmNhcmRQYXltZW50UmVzdWx0QWNjZXNzQ29kZShWYWx1ZS5DYXJkVG9rZW4pOw0KICAgICAgICAgIHNlbGYuY2FyZFBheW1lbnRBY2NlcHRDYXJkUHJlZml4ID0gJ3BheXBhbCc7DQogICAgICAgICAgZmVkUGF5bWVudEFkZGVkID0gdHJ1ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChWYWx1ZS5QYXltZW50VHlwZSA9PT0gUGF5bWVudFR5cGVzLkdpZnRDYXJkKSB7DQogICAgICAgICAgc2VsZi5naWZ0Q2FyZFBheW1lbnQoKS5hZGRHaWZ0Q2FyZChWYWx1ZSk7DQogICAgICAgICAgc2VsZi5wYXlHaWZ0Q2FyZCh0cnVlKTsNCiAgICAgICAgICBnaWZ0Q2FyZEFkZGVkID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQoNCiAgICAgIHNlbGYuZWRpdE1vZGUoZmVkUGF5bWVudEFkZGVkIHx8IGdpZnRDYXJkQWRkZWQpOw0KDQogICAgICBpZiAoZmVkUGF5bWVudEFkZGVkKSB7DQogICAgICAgICQoJy5jY3BheW1lbnQnKS50cmlnZ2VyKCdjbGljaycpOw0KICAgICAgfQ0KDQogICAgICBpZiAoZ2lmdENhcmRBZGRlZCkgew0KICAgICAgICAkKCcuZ2lmdENhcmRQYXltZW50JykudHJpZ2dlcignY2xpY2snKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBzZWxmLnNldHVwUGFnZSgpOw0KICB9DQoNCiAgc2VsZi5sb2FkID0gZnVuY3Rpb24gKCkgew0KICAgIGlmIChDWEFBcHBsaWNhdGlvbi5Jc0V4cGVyaWVuY2VFZGl0b3JNb2RlKCkpIHsNCiAgICAgIHZhciBkYXRhID0gZ2V0TW9ja0RhdGEoKTsNCiAgICAgIGluaXRNb2RlbERhdGEoZGF0YSk7DQogICAgfSBlbHNlIHsNCiAgICAgIEFqYXhTZXJ2aWNlLlBvc3QoJy9hcGkvY3hhL2NoZWNrb3V0L0dldEJpbGxpbmdEYXRhJywgbnVsbCwgZnVuY3Rpb24gKGRhdGEsIHN1Y2Nlc3MsIHNlbmRlcikgew0KICAgICAgICBpZiAoc3VjY2VzcyAmJiBkYXRhLlN1Y2Nlc3MpIHsNCiAgICAgICAgICBpbml0TW9kZWxEYXRhKGRhdGEpOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9DQogIH07DQp9DQo=
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 22511
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20190311T144938Z
- Language: "fr-CA"
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20190311T144940Z
    - ID: "5dd74568-4d4b-44c1-b513-0af5f4cda34f"
      Hint: __Created by
      Value: |
        sitecore\admin
- Language: "ja-JP"
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20190311T144940Z
    - ID: "5dd74568-4d4b-44c1-b513-0af5f4cda34f"
      Hint: __Created by
      Value: |
        sitecore\admin
