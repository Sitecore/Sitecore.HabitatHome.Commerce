---
ID: "41cc2aec-4b7b-4665-98d4-94c7275d96d2"
Parent: "28d0286e-5ee1-4be0-9aee-41d76fa2f651"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: "/sitecore/media library/Themes/Habitat Sites/Habitat Home Store/scripts/components/Cart/habitathome-feature-cart-delivery-model"
DB: master
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/41CC2AEC4B7B466598D494C7275D96D2.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  BlobID: "baae785a-aba5-447b-9fb0-fcd07bf135b7"
  Value: 77u/DQp2YXIgc2hpcHBpbmdNZXRob2RzQXJyYXkgPSBbXTsNCnZhciBtZXRob2RzVmlld01vZGVsID0gbnVsbDsNCnZhciBtZXRob2QgPSBudWxsOw0KDQpmdW5jdGlvbiBEZWxpdmVyeURhdGFWaWV3TW9kZWwoKSB7DQogICAgdmFyIHNlbGYgPSB0aGlzOw0KDQogICAgc2VsZi5jYXJ0ID0ga28ub2JzZXJ2YWJsZSgiIik7DQoNCiAgICBzZWxmLmN1cnJlbmN5Q29kZSA9IGtvLm9ic2VydmFibGUoIiIpOw0KDQogICAgdmFyIENvdW50cnkgPSBmdW5jdGlvbiAobmFtZSwgY29kZSkgew0KICAgICAgICB0aGlzLmNvdW50cnkgPSBuYW1lOw0KICAgICAgICB0aGlzLmNvZGUgPSBjb2RlOw0KICAgIH07DQogICAgc2VsZi5jb3VudHJpZXMgPSBrby5vYnNlcnZhYmxlQXJyYXkoKTsNCiAgICBzZWxmLnN0YXRlcyA9IGtvLm9ic2VydmFibGVBcnJheShbXSk7DQoNCiAgICBzZWxmLmlzU2hpcEFsbCA9IGtvLm9ic2VydmFibGUoZmFsc2UpOw0KICAgIHNlbGYuaXNTaGlwVG9FbWFpbCA9IGtvLm9ic2VydmFibGUoZmFsc2UpOw0KICAgIHNlbGYuaXNTaGlwSXRlbXMgPSBrby5vYnNlcnZhYmxlKGZhbHNlKTsNCg0KICAgIHNlbGYuaXNQaWNrVXAgPSBrby5vYnNlcnZhYmxlKGZhbHNlKTsNCiAgICBzZWxmLnBpY2tVcFN0b3JlcyA9IGtvLm9ic2VydmFibGVBcnJheSgpOw0KICAgIHNlbGYucGlja1VwU3RvcmVJZCA9IGtvLm9ic2VydmFibGUoIiIpOw0KICAgIHNlbGYuc3RvcmUgPSBrby5vYnNlcnZhYmxlKG5ldyBOZXdQaWNrdXBTdG9yZSh7ICJFeHRlcm5hbElkIjogIjAiIH0pKTsNCiAgICBzZWxmLnN0b3JlRGVsaXZlcnlNZXRob2QgPSBrby5vYnNlcnZhYmxlKCIiKTsNCg0KICAgIHNlbGYuZW1haWxEZWxpdmVyeU1ldGhvZCA9IGtvLm9ic2VydmFibGUoIiIpOw0KICAgIHNlbGYub3JkZXJTaGlwcGluZ09wdGlvbnMgPSBrby5vYnNlcnZhYmxlQXJyYXkoKTsNCg0KICAgIHNlbGYuc2VsZWN0ZWRTaGlwcGluZ09wdGlvbiA9IGtvLm9ic2VydmFibGUoJzAnKTsNCiAgICBzZWxmLnNlbGVjdGVkU2hpcHBpbmdPcHRpb24uc3Vic2NyaWJlKGZ1bmN0aW9uIChvcHRpb24pIHsNCiAgICAgICAgc2VsZi5pc1NoaXBBbGwob3B0aW9uID09PSAxKTsNCiAgICAgICAgc2VsZi5pc1NoaXBUb0VtYWlsKG9wdGlvbiA9PT0gMyk7DQogICAgICAgIHNlbGYuaXNTaGlwSXRlbXMob3B0aW9uID09PSA0KTsNCiAgICAgICAgc2VsZi5pc1BpY2tVcChvcHRpb24gPT09IDIpOw0KICAgIH0uYmluZCh0aGlzKSk7DQoNCiAgICBzZWxmLmlzQXV0aGVudGljYXRlZCA9IGtvLm9ic2VydmFibGUoZmFsc2UpOw0KICAgIHNlbGYudXNlckVtYWlsID0gIiI7DQoNCiAgICBzZWxmLnVzZXJBZGRyZXNzZXMgPSBrby5vYnNlcnZhYmxlQXJyYXkoKTsNCiAgICBzZWxmLnVzZXJBZGRyZXNzZXMucHVzaChuZXcgQWRkcmVzc1ZpZXdNb2RlbCh7ICJFeHRlcm5hbElkIjogIlVzZVNoaXBwaW5nIiwgIkZ1bGxBZGRyZXNzIjogJCgiI2JpbGxpbmdBZGRyZXNzU2VsZWN0IikuYXR0cigidGl0bGUiKSB9KSk7DQogICAgc2VsZi51c2VyQWRkcmVzc2VzLnB1c2gobmV3IEFkZHJlc3NWaWV3TW9kZWwoeyAiRXh0ZXJuYWxJZCI6ICJVc2VPdGhlciIsICJGdWxsQWRkcmVzcyI6ICQoIiNTaGlwcGluZ0FkZHJlc3NTZWxlY3QiKS5hdHRyKCJ0aXRsZTIiKSB9KSk7DQoNCiAgICBzZWxmLnNoaXBwaW5nTWV0aG9kcyA9IGtvLm9ic2VydmFibGVBcnJheSgpOw0KICAgIHNlbGYucGlja3VwTWV0aG9kID0ga28ub2JzZXJ2YWJsZUFycmF5KCk7DQogICAgc2VsZi5zaGlwcGluZ01ldGhvZCA9IGtvLnZhbGlkYXRlZE9ic2VydmFibGUoKS5leHRlbmQoeyByZXF1aXJlZDogdHJ1ZSB9KTsNCg0KICAgIHNlbGYuc2hpcHBpbmdBZGRyZXNzID0ga28udmFsaWRhdGVkT2JzZXJ2YWJsZShuZXcgQWRkcmVzc1ZpZXdNb2RlbCh7ICJFeHRlcm5hbElkIjogIjAiIH0pKTsNCiAgICBzZWxmLnNoaXBwaW5nQWRkcmVzc0ZpZWxkQ2hhbmdlZCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgc2VsZi5zaGlwcGluZ01ldGhvZCgiIik7DQogICAgICAgIHNlbGYuc2hpcHBpbmdNZXRob2RzLnJlbW92ZUFsbCgpOw0KICAgIH07DQoNCiAgICBzZWxmLnNlbGVjdGVkU2hpcHBpbmdBZGRyZXNzID0ga28ub2JzZXJ2YWJsZSgiVXNlT3RoZXIiKTsNCiAgICBzZWxmLnNlbGVjdGVkU2hpcHBpbmdBZGRyZXNzLnN1YnNjcmliZShmdW5jdGlvbiAoaWQpIHsNCiAgICAgICAgdmFyIG1hdGNoID0gc2VsZi5nZXRBZGRyZXNzKGlkKTsNCiAgICAgICAgc2VsZi5zaGlwcGluZ01ldGhvZCgiIik7DQogICAgICAgIHNlbGYuc2hpcHBpbmdNZXRob2RzLnJlbW92ZUFsbCgpOw0KICAgICAgICBpZiAobWF0Y2ggIT0gbnVsbCkgew0KICAgICAgICAgICAgc2VsZi5zaGlwcGluZ0FkZHJlc3MobWF0Y2gpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgc2VsZi5zaGlwcGluZ0FkZHJlc3MobmV3IEFkZHJlc3NWaWV3TW9kZWwoeyAiRXh0ZXJuYWxJZCI6ICIwIiB9KSk7DQogICAgICAgIH0NCiAgICB9LmJpbmQodGhpcykpOw0KDQogICAgc2VsZi5zaGlwcGluZ0VtYWlsID0ga28udmFsaWRhdGVkT2JzZXJ2YWJsZSgpLmV4dGVuZCh7IHJlcXVpcmVkOiB0cnVlLCBlbWFpbDogdHJ1ZSB9KTsNCiAgICBzZWxmLnNoaXBwaW5nRW1haWxDb250ZW50ID0ga28ub2JzZXJ2YWJsZSgiIik7DQogICAgc2VsZi5zZXRTZW5kVG9NZSA9IGZ1bmN0aW9uIChpdGVtLCBldmVudCkgew0KICAgICAgICB2YXIgZW1haWwgPSAkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLmlzKCc6Y2hlY2tlZCcpID8gc2VsZi51c2VyRW1haWwgOiAiIjsNCiAgICAgICAgaXRlbS5zaGlwcGluZ0VtYWlsKGVtYWlsKTsNCiAgICB9Ow0KDQogICAgc2VsZi5lbmFibGVUb0JpbGxpbmcgPSBrby5jb21wdXRlZCh7DQogICAgICAgIHJlYWQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGlmIChzZWxmLmlzU2hpcFRvRW1haWwoKSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnNoaXBwaW5nRW1haWwoKSAmJiBzZWxmLnNoaXBwaW5nRW1haWwuaXNWYWxpZCgpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoc2VsZi5pc1NoaXBBbGwoKSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnNoaXBwaW5nTWV0aG9kLmlzVmFsaWQoKSAmJiBzZWxmLnNoaXBwaW5nQWRkcmVzcy5pc1ZhbGlkKCkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKHNlbGYuaXNTaGlwSXRlbXMoKSkgew0KICAgICAgICAgICAgICAgIHZhciBpc1ZhbGlkID0gW107DQogICAgICAgICAgICAgICAgJC5lYWNoKHNlbGYuY2FydCgpLmNhcnRMaW5lcygpLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzTGluZVNoaXBUb0VtYWlsKCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlzVmFsaWQucHVzaCh0aGlzLnNoaXBwaW5nRW1haWwoKSAmJiB0aGlzLnNoaXBwaW5nRW1haWwuaXNWYWxpZCgpKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLmlzTGluZVNoaXBBbGwoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaXNWYWxpZC5wdXNoKHRoaXMuc2hpcHBpbmdNZXRob2QuaXNWYWxpZCgpICYmIHRoaXMuc2hpcHBpbmdBZGRyZXNzLmlzVmFsaWQoKSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5pc0xpbmVQaWNrVXAoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlucFBpY2tVcFN0b3JlID0gJCgnaW5wdXRbbmFtZT1waWNrVXBPcHRpb25zXTpjaGVja2VkJyk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5wUGlja1VwU3RvcmUubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlT2JqZWN0ID0ga28uY29udGV4dEZvcihpbnBQaWNrVXBTdG9yZS5wYXJlbnRzKClbMF0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzVmFsaWQucHVzaChzdG9yZU9iamVjdC4kZGF0YS5BZGRyZXNzMSAhPSBudWxsKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlzVmFsaWQucHVzaChmYWxzZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gaXNWYWxpZC5ldmVyeShpc0l0ZW1WYWxpZCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoc2VsZi5pc1BpY2tVcCgpKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coImlzcGlja3V1cCIpOw0KICAgICAgICAgICAgICAgIHZhciBpbnBQaWNrVXBTdG9yZSA9ICQoJ2lucHV0W25hbWU9cGlja1VwT3B0aW9uc106Y2hlY2tlZCcpOw0KICAgICAgICAgICAgICAgIGlmIChpbnBQaWNrVXBTdG9yZS5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlT2JqZWN0ID0ga28uY29udGV4dEZvcihpbnBQaWNrVXBTdG9yZS5wYXJlbnRzKClbMF0pOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHN0b3JlT2JqZWN0LiRkYXRhLkFkZHJlc3MxICE9IG51bGwpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICB3cml0ZTogZnVuY3Rpb24gKHZhbHVlKSB7DQogICAgICAgICAgICByZXR1cm4gQm9vbGVhbih2YWx1ZSk7DQogICAgICAgIH0NCiAgICB9KTsNCg0KICAgIHNlbGYuZ2V0QWRkcmVzcyA9IGZ1bmN0aW9uIChpZCkgew0KICAgICAgICB2YXIgbWF0Y2ggPSBrby51dGlscy5hcnJheUZpcnN0KHNlbGYudXNlckFkZHJlc3NlcygpLCBmdW5jdGlvbiAoYSkgew0KICAgICAgICAgICAgaWYgKGEuZXh0ZXJuYWxJZCgpID09PSBpZCAmJiBpZCAhPT0gIlVzZU90aGVyIikgew0KICAgICAgICAgICAgICAgIHJldHVybiBhOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgcmV0dXJuIG1hdGNoOw0KICAgIH07DQoNCiAgICBzZWxmLmdldFNoaXBwaW5nTWV0aG9kcyA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgaWYgKHNlbGYuc2hpcHBpbmdBZGRyZXNzKCkgJiYgc2VsZi5zaGlwcGluZ0FkZHJlc3MuZXJyb3JzKCkubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICAkKCIjb3JkZXJHZXRTaGlwcGluZ01ldGhvZHMiKS5idXR0b24oJ2xvYWRpbmcnKTsNCiAgICAgICAgICAgIHZhciBwYXJ0eSA9IGtvLnRvSlMoc2VsZi5zaGlwcGluZ0FkZHJlc3MoKSk7DQoNCiAgICAgICAgICAgIHZhciBkYXRhID0geyBTaGlwcGluZ0FkZHJlc3M6IHBhcnR5LCBTaGlwcGluZ1ByZWZlcmVuY2VUeXBlOiBzZWxmLnNlbGVjdGVkU2hpcHBpbmdPcHRpb24oKSwgTGluZXM6IG51bGwgfTsNCg0KICAgICAgICAgICAgQWpheFNlcnZpY2UuUG9zdCgiL2FwaS9jeGEvY2hlY2tvdXQvR2V0U2hpcHBpbmdNZXRob2RzIiwgZGF0YSwgZnVuY3Rpb24gKGRhdGEsIHN1Y2Nlc3MsIHNlbmRlcikgew0KDQogICAgICAgICAgICAgICAgaWYgKGRhdGEuU3VjY2VzcyAmJiBzdWNjZXNzKSB7DQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0U2hpcHBpbmdNZXRob2RzKGRhdGEuU2hpcHBpbmdNZXRob2RzKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAkKCIjb3JkZXJHZXRTaGlwcGluZ01ldGhvZHMiKS5idXR0b24oJ3Jlc2V0Jyk7DQogICAgICAgICAgICB9LCAkKHRoaXMpKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbXBvbmVudC5kZWxpdmVyeVZNLnNoaXBwaW5nQWRkcmVzcy5lcnJvcnMuc2hvd0FsbE1lc3NhZ2VzKCk7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgc2VsZi5zZXRTaGlwcGluZ01ldGhvZHMgPSBmdW5jdGlvbiAoc2hpcHBpbmdNZXRob2REYXRhTGlzdCkgew0KICAgICAgICB2YXIgbWV0aG9kcyA9ICIiOw0KICAgICAgICBzZWxmLnNoaXBwaW5nTWV0aG9kcy5yZW1vdmVBbGwoKTsNCiAgICAgICAgJC5lYWNoKHNoaXBwaW5nTWV0aG9kRGF0YUxpc3QsIGZ1bmN0aW9uIChpLCB2KSB7DQoNCiAgICAgICAgICAgIGlmICh2LkRlc2NyaXB0aW9uID09ICJQaWNrdXAgRnJvbSBTdG9yZSIpIHsNCiAgICAgICAgICAgICAgICBzZWxmLnBpY2t1cE1ldGhvZChuZXcgbWV0aG9kKHYuRGVzY3JpcHRpb24sIHYuRXh0ZXJuYWxJZCkpOw0KDQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBzZWxmLnNoaXBwaW5nTWV0aG9kcy5wdXNoKG5ldyBtZXRob2Qodi5EZXNjcmlwdGlvbiwgdi5FeHRlcm5hbElkKSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KDQogICAgfTsNCg0KICAgIHNlbGYuaGFuZGxlRWRpdE1vZGVTaGlwQWxsID0gZnVuY3Rpb24gKGRhdGEpIHsNCiAgICAgICAgc2VsZi5pc1NoaXBBbGwodHJ1ZSk7DQoNCiAgICAgICAgdmFyIHNoaXBtZW50ID0gZGF0YS5DYXJ0LlNoaXBtZW50c1swXTsNCiAgICAgICAgaWYgKHNoaXBtZW50ICE9IG51bGwpIHsNCg0KICAgICAgICAgICAgaWYgKHNoaXBtZW50LkVkaXRNb2RlU2hpcHBpbmdPcHRpb25UeXBlICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICBzZWxmLnNlbGVjdGVkU2hpcHBpbmdPcHRpb24oc2hpcG1lbnQuRWRpdE1vZGVTaGlwcGluZ09wdGlvblR5cGUuVmFsdWUpOw0KICAgICAgICAgICAgICAgIHZhciBvcmRlclNoaXBwaW5nUHJlZmVyZW5jZSA9IHNlbGYuc2VsZWN0ZWRTaGlwcGluZ09wdGlvbigpOw0KDQogICAgICAgICAgICAgICAgLy8gU2hpcFRvQWRkcmVzcw0KICAgICAgICAgICAgICAgIGlmIChvcmRlclNoaXBwaW5nUHJlZmVyZW5jZSA9PSAnMScpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcnR5SWQgPSBzZWxmLmNhcnQoKS5zaGlwbWVudHNbMF0ucGFydHlJZDsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcnR5ID0ga28udXRpbHMuYXJyYXlGaXJzdChzZWxmLmNhcnQoKS5wYXJ0aWVzLCBmdW5jdGlvbiAoYSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEuZXh0ZXJuYWxJZCgpID09PSBwYXJ0eUlkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGE7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgICAgICBpZiAocGFydHkgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zaGlwcGluZ0FkZHJlc3MocGFydHkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChvcmRlclNoaXBwaW5nUHJlZmVyZW5jZSA9PSAnMicpIHsNCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZWxlY3RlZFNoaXBwaW5nT3B0aW9uKDIpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIC8vIEVtYWlsDQogICAgICAgICAgICAgICAgaWYgKG9yZGVyU2hpcHBpbmdQcmVmZXJlbmNlID09ICczJykgew0KICAgICAgICAgICAgICAgICAgICBzZWxmLnNoaXBwaW5nRW1haWwoc2hpcG1lbnQuRW1haWwpOw0KICAgICAgICAgICAgICAgICAgICBzZWxmLnNoaXBwaW5nRW1haWxDb250ZW50KHNoaXBtZW50LkVtYWlsQ29udGVudCk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKHNoaXBtZW50LlNoaXBtZW50RWRpdE1vZGVsICE9IG51bGwgJiYgc2hpcG1lbnQuU2hpcG1lbnRFZGl0TW9kZWwuU2hpcHBpbmdNZXRob2RzICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXRTaGlwcGluZ01ldGhvZHMoc2hpcG1lbnQuU2hpcG1lbnRFZGl0TW9kZWwuU2hpcHBpbmdNZXRob2RzKTsNCg0KICAgICAgICAgICAgICAgICAgICB2YXIgc20gPSBrby51dGlscy5hcnJheUZpcnN0KHNlbGYuc2hpcHBpbmdNZXRob2RzKCksIGZ1bmN0aW9uIChhKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS5kZXNjcmlwdGlvbiA9PT0gc2hpcG1lbnQuU2hpcHBpbmdNZXRob2ROYW1lKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGE7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgICAgICBpZiAoc20gIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zaGlwcGluZ01ldGhvZChzbSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgc2VsZi5oYW5kbGVFZGl0TW9kZVNoaXBJbmRpdmlkdWFsbHkgPSBmdW5jdGlvbiAoZGF0YSkgew0KICAgICAgICBzZWxmLmlzU2hpcEFsbChmYWxzZSk7DQogICAgICAgIHNlbGYuaXNTaGlwSXRlbXModHJ1ZSk7DQogICAgICAgIHNlbGYuc2VsZWN0ZWRTaGlwcGluZ09wdGlvbignNCcpOw0KICAgICAgICAkLmVhY2goc2VsZi5jYXJ0KCkuY2FydExpbmVzKCksIGZ1bmN0aW9uIChpbmRleCwgdmFsdWUpIHsNCiAgICAgICAgICAgIHZhbHVlLmhhbmRsZUVkaXRNb2RlKGRhdGEpOw0KICAgICAgICB9KTsNCiAgICB9Ow0KDQogICAgc2VsZi5oYW5kbGVFZGl0TW9kZSA9IGZ1bmN0aW9uIChkYXRhKSB7DQogICAgICAgIGlmIChzZWxmLmNhcnQoKS5zaGlwbWVudHMgIT0gbnVsbCAmJiBzZWxmLmNhcnQoKS5zaGlwbWVudHMubGVuZ3RoID4gMCkgew0KDQogICAgICAgICAgICBpZiAoc2VsZi5jYXJ0KCkuc2hpcG1lbnRzLmxlbmd0aCA9PSAxKSB7DQogICAgICAgICAgICAgICAgc2VsZi5oYW5kbGVFZGl0TW9kZVNoaXBBbGwoZGF0YSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBzZWxmLmhhbmRsZUVkaXRNb2RlU2hpcEluZGl2aWR1YWxseShkYXRhKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH07DQoNCg0KICAgIHZhciBtb2RlbENhcnRMaW5lczsNCiAgICBzZWxmLmxvYWQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIEFqYXhTZXJ2aWNlLlBvc3QoIi9hcGkvY3hhL2NoZWNrb3V0L0dldERlbGl2ZXJ5RGF0YSIsIG51bGwsIGZ1bmN0aW9uIChkYXRhLCBzdWNjZXNzLCBzZW5kZXIpIHsNCiAgICAgICAgICAgIGlmIChzdWNjZXNzICYmIGRhdGEuU3VjY2Vzcykgew0KDQogICAgICAgICAgICAgICAgc2VsZi5lbWFpbERlbGl2ZXJ5TWV0aG9kKGRhdGEuRW1haWxEZWxpdmVyeU1ldGhvZCk7DQogICAgICAgICAgICAgICAgc2VsZi5jdXJyZW5jeUNvZGUgPSBkYXRhLkN1cnJlbmN5Q29kZTsNCg0KICAgICAgICAgICAgICAgIGlmIChkYXRhLkNvdW50cmllcyAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgICQuZWFjaChkYXRhLkNvdW50cmllcywgZnVuY3Rpb24gKGluZGV4LCB2YWx1ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jb3VudHJpZXMucHVzaChuZXcgQ291bnRyeSh2YWx1ZSwgaW5kZXgpKTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChkYXRhLklzVXNlckF1dGhlbnRpY2F0ZWQgPT09IHRydWUgJiYgZGF0YS5Vc2VyQWRkcmVzc2VzLkFkZHJlc3NlcyAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgICQuZWFjaChkYXRhLlVzZXJBZGRyZXNzZXMuQWRkcmVzc2VzLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnVzZXJBZGRyZXNzZXMucHVzaChuZXcgQWRkcmVzc1ZpZXdNb2RlbCh0aGlzKSk7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgICAgICAgIHNlbGYuaXNBdXRoZW50aWNhdGVkKHRydWUpOw0KICAgICAgICAgICAgICAgICAgICBzZWxmLnVzZXJFbWFpbCA9IGRhdGEuVXNlckVtYWlsOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHNlbGYuY2FydChuZXcgRGVsaXZlcnlDYXJ0Vmlld01vZGVsKGRhdGEuQ2FydCwgc2VsZi51c2VyQWRkcmVzc2VzKCkpKTsNCiAgICAgICAgICAgICAgICBtb2RlbENhcnRMaW5lcyA9IHNlbGYuY2FydCgpLmNhcnRMaW5lcygpOw0KDQogICAgICAgICAgICAgICAgaWYgKGRhdGEuT3JkZXJTaGlwcGluZ09wdGlvbnMgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICAkLmVhY2goZGF0YS5PcmRlclNoaXBwaW5nT3B0aW9ucywgZnVuY3Rpb24gKGluZGV4LCB2YWx1ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vcmRlclNoaXBwaW5nT3B0aW9ucy5wdXNoKHZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgQWpheFNlcnZpY2UuUG9zdCgiYXBpL2N4YS9EZWxpdmVyeS9HZXRDdXJyZW50Q2FydCIsICIiLCBmdW5jdGlvbiAoZGF0YSwgc3VjY2Vzcywgc2VuZGVyKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goZGF0YS5EYXRhLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGV4SWQ7IHZhciBwcm9kSWQ7IHZhciB2YXJJZDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLm1hcChmdW5jdGlvbiAoaSwgYikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGJbJ0tleSddID09ICdFeHRlcm5hbENhcnRMaW5lSWQnKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4SWQgPSBiWydWYWx1ZSddOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGJbJ0tleSddID09ICdQcm9kdWN0SWQnKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2RJZCA9IGJbJ1ZhbHVlJ107DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoYlsnS2V5J10gPT0gJ1ZhcmlhbnRJZCcpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFySWQgPSBiWydWYWx1ZSddOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1hdGNoID0ga28udXRpbHMuYXJyYXlGaXJzdChzZWxmLmNhcnQoKS5jYXJ0TGluZXMoKSwgZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEuZXh0ZXJuYWxDYXJ0TGluZUlkID09PSBleElkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2V0Q29va2llKCJzeGFfc2l0ZV9zaG9wc19zdG9yZXMiKSAhPSAiIikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuR2V0SW52ZW50b3J5KGEsIHByb2RJZCwgdmFySWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5Mb2FkTmVhcmVzdFN0b3JlcyhhLCBwcm9kSWQsIHZhcklkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgc2VsZi5oYW5kbGVFZGl0TW9kZShkYXRhKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICApDQoNCiAgICB9Ow0KDQogICAgc2VsZi5HZXRJbnZlbnRvcnkgPSBmdW5jdGlvbiAoY2FydExpbmUsIHByb2R1Y3RJZCwgdmFyaWFudElkKSB7DQogICAgICAgIHZhciBTZXJ2aWNlUmVxdWVzdCA9IG5ldyBPYmplY3QoKTsNCiAgICAgICAgU2VydmljZVJlcXVlc3QuUHJvZHVjdElkID0gcHJvZHVjdElkOw0KICAgICAgICBTZXJ2aWNlUmVxdWVzdC5WYXJpYW50SWQgPSB2YXJpYW50SWQ7DQogICAgICAgIHZhciBwcm9taXNlID0gR2V0SW52ZW50b3J5KFNlcnZpY2VSZXF1ZXN0KS5kb25lKGZ1bmN0aW9uIChyZXN1bHQpIHsNCiAgICAgICAgICAgIGlmIChyZXN1bHQuRXJyb3JzICE9IG51bGwgJiByZXN1bHQuRXJyb3JzICE9ICJ1bmRlZmluZWQiKSB7DQogICAgICAgICAgICAgICAgc2VsZi5FcnJvck1lc3NhZ2UoZGF0YS5FcnJvcnNbMF0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgdmFyIHN0b3Jlc0RhdGEgPSByZXN1bHQuRGF0YTsNCiAgICAgICAgICAgICAgICB2YXIgc3RvcmVzTGlzdCA9IFtdOw0KICAgICAgICAgICAgICAgIC8vc2VsZi5OZWFyZXN0U3RvcmVzTGlzdChzdG9yZXNEYXRhKTsNCiAgICAgICAgICAgICAgICAkLmVhY2gocmVzdWx0LkRhdGEsIGZ1bmN0aW9uIChpbmRleCwgdmFsdWUpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld1N0b3JlID0gbmV3IE5ld1BpY2t1cFN0b3JlKHZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgc3RvcmVzTGlzdC5wdXNoKG5ld1N0b3JlKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBjYXJ0TGluZS5saW5lUGlja1VwU3RvcmVzKHN0b3Jlc0xpc3QpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgfQ0KDQogICAgc2VsZi5Mb2FkTmVhcmVzdFN0b3JlcyA9IGZ1bmN0aW9uIChjYXJ0TGluZSwgcHJvZHVjdElkLCB2YXJpYW50SWQpIHsNCiAgICAgICAgdmFyIFNlcnZpY2VSZXF1ZXN0ID0gbmV3IE9iamVjdCgpOw0KICAgICAgICBTZXJ2aWNlUmVxdWVzdC5MYXRpdHVkZSA9ICIiOw0KICAgICAgICBTZXJ2aWNlUmVxdWVzdC5Mb25naXR1ZGUgPSAiIjsNCiAgICAgICAgU2VydmljZVJlcXVlc3QuUHJvZHVjdElkID0gcHJvZHVjdElkOw0KICAgICAgICBTZXJ2aWNlUmVxdWVzdC5WYXJpYW50SWQgPSB2YXJpYW50SWQ7DQogICAgICAgIHZhciBwcm9taXNlID0gR2V0TmVhcmVzdFN0b3JlcyhTZXJ2aWNlUmVxdWVzdCkuZG9uZShmdW5jdGlvbiAocmVzdWx0KSB7DQogICAgICAgICAgICBpZiAocmVzdWx0LkVycm9ycyAhPSBudWxsICYgcmVzdWx0LkVycm9ycyAhPSAidW5kZWZpbmVkIikgew0KICAgICAgICAgICAgICAgIHNlbGYuRXJyb3JNZXNzYWdlKGRhdGEuRXJyb3JzWzBdKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KDQogICAgICAgICAgICAgICAgdmFyIHN0b3Jlc0xpc3QgPSBbXTsNCiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LkRhdGEubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAkLmVhY2gocmVzdWx0LkRhdGEsIGZ1bmN0aW9uIChpbmRleCwgdmFsdWUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXdTdG9yZSA9IG5ldyBOZXdQaWNrdXBTdG9yZSh2YWx1ZSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0b3Jlc0xpc3QucHVzaChuZXdTdG9yZSk7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICBjYXJ0TGluZS5saW5lUGlja1VwU3RvcmVzKHN0b3Jlc0xpc3QpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfQ0KDQogICAgc2VsZi5zZXRQaWNrVXBTdG9yZSA9IGZ1bmN0aW9uIChtb2RlbCkgew0KDQogICAgICAgIHNlbGYucGlja1VwU3RvcmVJZCA9IG1vZGVsLkludmVudG9yeVN0b3JlSWQ7DQogICAgICAgIHNlbGYuc3RvcmUobW9kZWwpOw0KDQogICAgfQ0KICAgIHNlbGYuZ29Ub05leHRQYWdlQ2xpY2sgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBwYXJ0aWVzID0gW107DQogICAgICAgIHZhciBzaGlwcGluZyA9IFtdOw0KICAgICAgICB2YXIgb3JkZXJTaGlwcGluZ1ByZWZlcmVuY2UgPSBzZWxmLnNlbGVjdGVkU2hpcHBpbmdPcHRpb24oKTsNCiAgICAgICAgJCgiI2RlbGl2ZXJ5TWV0aG9kU2V0IikudmFsKGZhbHNlKTsNCg0KICAgICAgICAkKCIjVG9CaWxsaW5nQnV0dG9uIikuYnV0dG9uKCdsb2FkaW5nJyk7DQogICAgICAgIC8vICAgICAgICAkKCIjQmFja1RvQmlsbGluZ0J1dHRvbiIpLmJ1dHRvbignbG9hZGluZycpOw0KDQogICAgICAgIGlmIChvcmRlclNoaXBwaW5nUHJlZmVyZW5jZSA9PT0gMSkgew0KICAgICAgICAgICAgdmFyIHBhcnR5SWQgPSBzZWxmLnNoaXBwaW5nQWRkcmVzcygpLmV4dGVybmFsSWQoKTsNCiAgICAgICAgICAgIHBhcnRpZXMucHVzaCh7DQogICAgICAgICAgICAgICAgIk5hbWUiOiBzZWxmLnNoaXBwaW5nQWRkcmVzcygpLm5hbWUoKSwNCiAgICAgICAgICAgICAgICAiQWRkcmVzczEiOiBzZWxmLnNoaXBwaW5nQWRkcmVzcygpLmFkZHJlc3MxKCksDQogICAgICAgICAgICAgICAgIkNvdW50cnkiOiBzZWxmLnNoaXBwaW5nQWRkcmVzcygpLmNvdW50cnkoKSwNCiAgICAgICAgICAgICAgICAiQ2l0eSI6IHNlbGYuc2hpcHBpbmdBZGRyZXNzKCkuY2l0eSgpLA0KICAgICAgICAgICAgICAgICJTdGF0ZSI6IHNlbGYuc2hpcHBpbmdBZGRyZXNzKCkuc3RhdGUoKSwNCiAgICAgICAgICAgICAgICAiWmlwUG9zdGFsQ29kZSI6IHNlbGYuc2hpcHBpbmdBZGRyZXNzKCkuemlwUG9zdGFsQ29kZSgpLA0KICAgICAgICAgICAgICAgICJFeHRlcm5hbElkIjogcGFydHlJZCwNCiAgICAgICAgICAgICAgICAiUGFydHlJZCI6IHBhcnR5SWQNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICBzaGlwcGluZy5wdXNoKHsNCiAgICAgICAgICAgICAgICAiU2hpcHBpbmdNZXRob2RJRCI6IHNlbGYuc2hpcHBpbmdNZXRob2QoKS5pZCwNCiAgICAgICAgICAgICAgICAiU2hpcHBpbmdNZXRob2ROYW1lIjogc2VsZi5zaGlwcGluZ01ldGhvZCgpLmRlc2NyaXB0aW9uLA0KICAgICAgICAgICAgICAgICJTaGlwcGluZ1ByZWZlcmVuY2VUeXBlIjogb3JkZXJTaGlwcGluZ1ByZWZlcmVuY2UsDQogICAgICAgICAgICAgICAgIlBhcnR5SUQiOiBwYXJ0eUlkDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIHZhciBkYXRhID0gJ3siRGVsaXZlcnlJdGVtUGF0aCI6ICInICsgJCgiI0RlbGl2ZXJ5SXRlbVBhdGgiKS52YWwoKSArICciLCAiT3JkZXJTaGlwcGluZ1ByZWZlcmVuY2VUeXBlIjogIicgKyBvcmRlclNoaXBwaW5nUHJlZmVyZW5jZSArICciLCAiU2hpcHBpbmdNZXRob2RzIjonICsgSlNPTi5zdHJpbmdpZnkoc2hpcHBpbmcpICsgJywgIlNoaXBwaW5nQWRkcmVzc2VzIjonICsgSlNPTi5zdHJpbmdpZnkocGFydGllcykgKyAnfSc7DQoNCiAgICAgICAgICAgIEFqYXhTZXJ2aWNlLlBvc3QoIi9hcGkvY3hhL2NoZWNrb3V0L1NldFNoaXBwaW5nTWV0aG9kcyIsIEpTT04ucGFyc2UoZGF0YSksIGZ1bmN0aW9uIChkYXRhLCBzdWNjZXNzLCBzZW5kZXIpIHsNCiAgICAgICAgICAgICAgICBpZiAoc3VjY2VzcyAmJiBkYXRhLlN1Y2Nlc3MpIHsNCiAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBkYXRhLk5leHRQYWdlTGluazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJCgiI1RvQmlsbGluZ0J1dHRvbiIpLmJ1dHRvbigncmVzZXQnKTsNCiAgICAgICAgICAgIH0sICQodGhpcykpOw0KICAgICAgICB9DQoNCiAgICAgICAgZWxzZSBpZiAob3JkZXJTaGlwcGluZ1ByZWZlcmVuY2UgPT09IDIpIHsNCiAgICAgICAgICAgIHZhciBpbnBOYW1lID0gJ3BpY2tVcE9wdGlvbnMnOw0KICAgICAgICAgICAgdmFyIGlucFBpY2tVcFN0b3JlID0gJCgnaW5wdXRbbmFtZT0nICsgaW5wTmFtZSArICddOmNoZWNrZWQnKTsNCiAgICAgICAgICAgIHZhciBzdG9yZU9iamVjdCA9IGtvLmNvbnRleHRGb3IoaW5wUGlja1VwU3RvcmUucGFyZW50cygpWzBdKTsNCg0KICAgICAgICAgICAgc2VsZi5zZWxlY3RlZFNoaXBwaW5nT3B0aW9uKDIpOw0KDQogICAgICAgICAgICBpZiAoc2VsZi5zdG9yZSgpLkludmVudG9yeVN0b3JlSWQgPT0gbnVsbCkgew0KDQogICAgICAgICAgICAgICAgc2VsZi5zZXRQaWNrVXBTdG9yZShzdG9yZU9iamVjdC4kZGF0YSk7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHZhciBzdG9yZXNoaXBwaW5nQWRkcmVzcyA9IG5ldyBPYmplY3QoKTsNCiAgICAgICAgICAgIHN0b3Jlc2hpcHBpbmdBZGRyZXNzLmV4dGVybmFsSWQgPSAwOw0KICAgICAgICAgICAgc3RvcmVzaGlwcGluZ0FkZHJlc3MucGFydHlJZCA9IDA7DQogICAgICAgICAgICBzdG9yZXNoaXBwaW5nQWRkcmVzcy5uYW1lID0gc2VsZi5zdG9yZSgpLkludmVudG9yeVN0b3JlSWQ7DQogICAgICAgICAgICBzdG9yZXNoaXBwaW5nQWRkcmVzcy5hZGRyZXNzMSA9IHNlbGYuc3RvcmUoKS5BZGRyZXNzMTsNCiAgICAgICAgICAgIHN0b3Jlc2hpcHBpbmdBZGRyZXNzLmNpdHkgPSBzZWxmLnN0b3JlKCkuQ2l0eTsNCiAgICAgICAgICAgIHN0b3Jlc2hpcHBpbmdBZGRyZXNzLnN0YXRlID0gc2VsZi5zdG9yZSgpLlN0YXRlOw0KICAgICAgICAgICAgc3RvcmVzaGlwcGluZ0FkZHJlc3MuemlwUG9zdGFsQ29kZSA9IHNlbGYuc3RvcmUoKS5aaXA7DQogICAgICAgICAgICBzdG9yZXNoaXBwaW5nQWRkcmVzcy5jb3VudHJ5ID0gc2VsZi5zdG9yZSgpLkNvdW50cnk7DQogICAgICAgICAgICBzdG9yZXNoaXBwaW5nQWRkcmVzcy5pc1ByaW1hcnkgPSBmYWxzZTsNCiAgICAgICAgICAgIHN0b3Jlc2hpcHBpbmdBZGRyZXNzLmZ1bGxBZGRyZXNzID0gc2VsZi5zdG9yZSgpLkFkZHJlc3MxICsgIiAiICsgc2VsZi5zdG9yZSgpLkNpdHkgKyAiICIgKyBzZWxmLnN0b3JlKCkuU3RhdGUgKyAiICIgKyBzZWxmLnN0b3JlKCkuWmlwICsgIiAiICsgc2VsZi5zdG9yZSgpLkNvdW50cnk7DQogICAgICAgICAgICBzdG9yZXNoaXBwaW5nQWRkcmVzcy5kZXRhaWxzVXJsID0gIiI7DQoNCiAgICAgICAgICAgIHZhciBwYXJ0eSA9IGtvLnRvSlMoc3RvcmVzaGlwcGluZ0FkZHJlc3MpOw0KDQogICAgICAgICAgICB2YXIgZGF0YSA9IHsgU2hpcHBpbmdBZGRyZXNzOiBwYXJ0eSwgU2hpcHBpbmdQcmVmZXJlbmNlVHlwZTogc2VsZi5zZWxlY3RlZFNoaXBwaW5nT3B0aW9uKCksIExpbmVzOiBudWxsIH07DQoNCiAgICAgICAgICAgIEFqYXhTZXJ2aWNlLlBvc3QoIi9hcGkvY3hhL2NoZWNrb3V0L0dldFNoaXBwaW5nTWV0aG9kcyIsIGRhdGEsIGZ1bmN0aW9uIChkYXRhLCBzdWNjZXNzLCBzZW5kZXIpIHsNCiAgICAgICAgICAgICAgICBpZiAoZGF0YS5TdWNjZXNzICYmIHN1Y2Nlc3MpIHsNCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXRTaGlwcGluZ01ldGhvZHMoZGF0YS5TaGlwcGluZ01ldGhvZHMpOw0KICAgICAgICAgICAgICAgICAgICB2YXIgcGFydHlJZCA9IHNlbGYuc2hpcHBpbmdBZGRyZXNzKCkuZXh0ZXJuYWxJZCgpOw0KICAgICAgICAgICAgICAgICAgICBwYXJ0aWVzLnB1c2goew0KICAgICAgICAgICAgICAgICAgICAgICAgIk5hbWUiOiBzZWxmLnN0b3JlKCkuSW52ZW50b3J5U3RvcmVJZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICJBZGRyZXNzMSI6IHNlbGYuc3RvcmUoKS5BZGRyZXNzMSwNCiAgICAgICAgICAgICAgICAgICAgICAgICJDb3VudHJ5Ijogc2VsZi5zdG9yZSgpLkNvdW50cnksDQogICAgICAgICAgICAgICAgICAgICAgICAiQ2l0eSI6IHNlbGYuc3RvcmUoKS5DaXR5LA0KICAgICAgICAgICAgICAgICAgICAgICAgIlN0YXRlIjogc2VsZi5zdG9yZSgpLlN0YXRlLA0KICAgICAgICAgICAgICAgICAgICAgICAgIlppcFBvc3RhbENvZGUiOiBzZWxmLnN0b3JlKCkuWmlwLA0KICAgICAgICAgICAgICAgICAgICAgICAgIkV4dGVybmFsSWQiOiBwYXJ0eUlkLA0KICAgICAgICAgICAgICAgICAgICAgICAgIlBhcnR5SWQiOiBwYXJ0eUlkDQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICBzaGlwcGluZy5wdXNoKHsNCiAgICAgICAgICAgICAgICAgICAgICAgICJTaGlwcGluZ01ldGhvZElEIjogc2VsZi5waWNrdXBNZXRob2QoKS5pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICJTaGlwcGluZ01ldGhvZE5hbWUiOiBzZWxmLnBpY2t1cE1ldGhvZCgpLmRlc2NyaXB0aW9uLA0KICAgICAgICAgICAgICAgICAgICAgICAgIlNoaXBwaW5nUHJlZmVyZW5jZVR5cGUiOiAxLA0KICAgICAgICAgICAgICAgICAgICAgICAgIlBhcnR5SUQiOiBwYXJ0eUlkDQogICAgICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgICAgICAgIHZhciBzaGlwRGF0YSA9ICd7IkRlbGl2ZXJ5SXRlbVBhdGgiOiAiJyArICQoIiNEZWxpdmVyeUl0ZW1QYXRoIikudmFsKCkgKyAnIiwgIk9yZGVyU2hpcHBpbmdQcmVmZXJlbmNlVHlwZSI6ICInICsgb3JkZXJTaGlwcGluZ1ByZWZlcmVuY2UgKyAnIiwgIlNoaXBwaW5nTWV0aG9kcyI6JyArIEpTT04uc3RyaW5naWZ5KHNoaXBwaW5nKSArICcsICJTaGlwcGluZ0FkZHJlc3NlcyI6JyArIEpTT04uc3RyaW5naWZ5KHBhcnRpZXMpICsgJ30nOw0KDQogICAgICAgICAgICAgICAgICAgIEFqYXhTZXJ2aWNlLlBvc3QoIi9hcGkvY3hhL2NoZWNrb3V0L1NldFNoaXBwaW5nTWV0aG9kcyIsIEpTT04ucGFyc2Uoc2hpcERhdGEpLCBmdW5jdGlvbiAoZGF0YSwgc3VjY2Vzcywgc2VuZGVyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3VjY2VzcyAmJiBkYXRhLlN1Y2Nlc3MpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGRhdGEuTmV4dFBhZ2VMaW5rOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgJCgiI1RvQmlsbGluZ0J1dHRvbiIpLmJ1dHRvbigncmVzZXQnKTsNCiAgICAgICAgICAgICAgICAgICAgfSwgJCh0aGlzKSk7DQoNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCg0KDQogICAgICAgIH0NCg0KICAgICAgICBlbHNlIGlmIChvcmRlclNoaXBwaW5nUHJlZmVyZW5jZSA9PT0gNCkgew0KICAgICAgICAgICAgJC5lYWNoKHNlbGYuY2FydCgpLmNhcnRMaW5lcygpLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgdmFyIGxpbmVEZWxpdmVyeVByZWZlcmVuY2UgPSB0aGlzLnNlbGVjdGVkU2hpcHBpbmdPcHRpb24oKTsNCiAgICAgICAgICAgICAgICB2YXIgbGluZUlkID0gdGhpcy5leHRlcm5hbENhcnRMaW5lSWQ7DQoNCiAgICAgICAgICAgICAgICBpZiAobGluZURlbGl2ZXJ5UHJlZmVyZW5jZSA9PT0gMSkgew0KDQogICAgICAgICAgICAgICAgICAgIHZhciBwYXJ0eUlkID0gdGhpcy5zaGlwcGluZ0FkZHJlc3MoKS5leHRlcm5hbElkKCk7DQogICAgICAgICAgICAgICAgICAgIHBhcnRpZXMucHVzaCh7DQogICAgICAgICAgICAgICAgICAgICAgICAiTmFtZSI6IHRoaXMuc2hpcHBpbmdBZGRyZXNzKCkubmFtZSgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgIkFkZHJlc3MxIjogdGhpcy5zaGlwcGluZ0FkZHJlc3MoKS5hZGRyZXNzMSgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgIkNvdW50cnkiOiB0aGlzLnNoaXBwaW5nQWRkcmVzcygpLmNvdW50cnkoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICJDaXR5IjogdGhpcy5zaGlwcGluZ0FkZHJlc3MoKS5jaXR5KCksDQogICAgICAgICAgICAgICAgICAgICAgICAiU3RhdGUiOiB0aGlzLnNoaXBwaW5nQWRkcmVzcygpLnN0YXRlKCksDQogICAgICAgICAgICAgICAgICAgICAgICAiWmlwUG9zdGFsQ29kZSI6IHRoaXMuc2hpcHBpbmdBZGRyZXNzKCkuemlwUG9zdGFsQ29kZSgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgIkV4dGVybmFsSWQiOiBwYXJ0eUlkLA0KICAgICAgICAgICAgICAgICAgICAgICAgIlBhcnR5SWQiOiBwYXJ0eUlkDQogICAgICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgICAgICAgIHNoaXBwaW5nLnB1c2goew0KICAgICAgICAgICAgICAgICAgICAgICAgIlNoaXBwaW5nTWV0aG9kSUQiOiB0aGlzLnNoaXBwaW5nTWV0aG9kKCkuaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAiU2hpcHBpbmdNZXRob2ROYW1lIjogdGhpcy5zaGlwcGluZ01ldGhvZCgpLmRlc2NyaXB0aW9uLA0KICAgICAgICAgICAgICAgICAgICAgICAgIlNoaXBwaW5nUHJlZmVyZW5jZVR5cGUiOiBsaW5lRGVsaXZlcnlQcmVmZXJlbmNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgIlBhcnR5SUQiOiBwYXJ0eUlkLA0KICAgICAgICAgICAgICAgICAgICAgICAgIkxpbmVJRHMiOiBbbGluZUlkXQ0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZiAobGluZURlbGl2ZXJ5UHJlZmVyZW5jZSA9PT0gMykgew0KICAgICAgICAgICAgICAgICAgICBzaGlwcGluZy5wdXNoKHsNCiAgICAgICAgICAgICAgICAgICAgICAgICJTaGlwcGluZ01ldGhvZElEIjogc2VsZi5lbWFpbERlbGl2ZXJ5TWV0aG9kKCkuRXh0ZXJuYWxJZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICJTaGlwcGluZ01ldGhvZE5hbWUiOiBzZWxmLmVtYWlsRGVsaXZlcnlNZXRob2QoKS5EZXNjcmlwdGlvbiwNCiAgICAgICAgICAgICAgICAgICAgICAgICJTaGlwcGluZ1ByZWZlcmVuY2VUeXBlIjogbGluZURlbGl2ZXJ5UHJlZmVyZW5jZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICJFbGVjdHJvbmljRGVsaXZlcnlFbWFpbCI6IHRoaXMuc2hpcHBpbmdFbWFpbCgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgIkVsZWN0cm9uaWNEZWxpdmVyeUVtYWlsQ29udGVudCI6IHRoaXMuc2hpcHBpbmdFbWFpbENvbnRlbnQoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICJMaW5lSURzIjogW2xpbmVJZF0NCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKGxpbmVEZWxpdmVyeVByZWZlcmVuY2UgPT09IDIpIHsNCg0KICAgICAgICAgICAgICAgICAgICB2YXIgcGFydHlJZCA9IHRoaXMuc2hpcHBpbmdBZGRyZXNzKCkuZXh0ZXJuYWxJZCgpOw0KICAgICAgICAgICAgICAgICAgICB2YXIgaW5wTmFtZSA9ICdwaWNrVXBPcHRpb25zLScgKyB0aGlzLmV4dGVybmFsQ2FydExpbmVJZDsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGlucFBpY2tVcFN0b3JlID0gJCgnaW5wdXRbbmFtZT0nICsgaW5wTmFtZSArICddOmNoZWNrZWQnKTsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlT2JqZWN0ID0ga28uY29udGV4dEZvcihpbnBQaWNrVXBTdG9yZS5wYXJlbnRzKClbMF0pOw0KDQogICAgICAgICAgICAgICAgICAgIGlmIChzdG9yZU9iamVjdCA9PSBudWxsKSB7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNUb0JpbGxpbmdCdXR0b24nKS5hdHRyKCdkaXNhYmxlZCcpOw0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlTmFtZSA9IHN0b3JlT2JqZWN0LiRkYXRhLkludmVudG9yeVN0b3JlSWQ7DQogICAgICAgICAgICAgICAgICAgIHZhciBhZGRyZXNzMSA9IHN0b3JlT2JqZWN0LiRkYXRhLkFkZHJlc3MxOw0KICAgICAgICAgICAgICAgICAgICB2YXIgY2l0eSA9IHN0b3JlT2JqZWN0LiRkYXRhLkNpdHk7DQogICAgICAgICAgICAgICAgICAgIHZhciBzdGF0ZSA9IHN0b3JlT2JqZWN0LiRkYXRhLlN0YXRlOw0KICAgICAgICAgICAgICAgICAgICB2YXIgemlwID0gc3RvcmVPYmplY3QuJGRhdGEuWmlwOw0KICAgICAgICAgICAgICAgICAgICB2YXIgY291bnRyeSA9IHN0b3JlT2JqZWN0LiRkYXRhLkNvdW50cnk7DQoNCiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3Jlc2hpcHBpbmdBZGRyZXNzID0gbmV3IE9iamVjdCgpOw0KICAgICAgICAgICAgICAgICAgICBzdG9yZXNoaXBwaW5nQWRkcmVzcy5leHRlcm5hbElkID0gMDsNCiAgICAgICAgICAgICAgICAgICAgc3RvcmVzaGlwcGluZ0FkZHJlc3MucGFydHlJZCA9IDA7DQogICAgICAgICAgICAgICAgICAgIHN0b3Jlc2hpcHBpbmdBZGRyZXNzLm5hbWUgPSBzdG9yZU5hbWU7DQogICAgICAgICAgICAgICAgICAgIHN0b3Jlc2hpcHBpbmdBZGRyZXNzLmFkZHJlc3MxID0gYWRkcmVzczE7DQogICAgICAgICAgICAgICAgICAgIHN0b3Jlc2hpcHBpbmdBZGRyZXNzLmNpdHkgPSBjaXR5Ow0KICAgICAgICAgICAgICAgICAgICBzdG9yZXNoaXBwaW5nQWRkcmVzcy5zdGF0ZSA9IHN0YXRlOw0KICAgICAgICAgICAgICAgICAgICBzdG9yZXNoaXBwaW5nQWRkcmVzcy56aXBQb3N0YWxDb2RlID0gemlwOw0KICAgICAgICAgICAgICAgICAgICBzdG9yZXNoaXBwaW5nQWRkcmVzcy5jb3VudHJ5ID0gY291bnRyeTsNCiAgICAgICAgICAgICAgICAgICAgc3RvcmVzaGlwcGluZ0FkZHJlc3MuaXNQcmltYXJ5ID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgIHN0b3Jlc2hpcHBpbmdBZGRyZXNzLmZ1bGxBZGRyZXNzID0gYWRkcmVzczEgKyAiICIgKyBjaXR5ICsgIiAiICsgc3RhdGUgKyAiICIgKyB6aXAgKyAiICIgKyBjb3VudHJ5Ow0KICAgICAgICAgICAgICAgICAgICBzdG9yZXNoaXBwaW5nQWRkcmVzcy5kZXRhaWxzVXJsID0gIiI7DQoNCiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcnR5ID0ga28udG9KUyhzdG9yZXNoaXBwaW5nQWRkcmVzcyk7DQogICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0geyBTaGlwcGluZ0FkZHJlc3M6IHBhcnR5LCBTaGlwcGluZ1ByZWZlcmVuY2VUeXBlOiBzZWxmLnNlbGVjdGVkU2hpcHBpbmdPcHRpb24oKSwgTGluZXM6IG51bGwgfTsNCg0KICAgICAgICAgICAgICAgICAgICBBamF4U2VydmljZS5Qb3N0KCIvYXBpL2N4YS9jaGVja291dC9HZXRTaGlwcGluZ01ldGhvZHMiLCBkYXRhLCBmdW5jdGlvbiAoZGF0YSwgc3VjY2Vzcywgc2VuZGVyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5TdWNjZXNzICYmIHN1Y2Nlc3MpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNldFNoaXBwaW5nTWV0aG9kcyhkYXRhLlNoaXBwaW5nTWV0aG9kcyk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5wTmFtZSA9ICdwaWNrVXBPcHRpb25zJzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5wUGlja1VwU3RvcmUgPSAkKCdpbnB1dFtuYW1lPScgKyBpbnBOYW1lICsgJ106Y2hlY2tlZCcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZU9iamVjdCA9IGtvLmNvbnRleHRGb3IoaW5wUGlja1VwU3RvcmUucGFyZW50cygpWzBdKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJ0eUlkID0gc2VsZi5zaGlwcGluZ0FkZHJlc3MoKS5leHRlcm5hbElkKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydGllcy5wdXNoKHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIk5hbWUiOiBzdG9yZU5hbWUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJBZGRyZXNzMSI6IGFkZHJlc3MxLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQ291bnRyeSI6IGNvdW50cnksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJDaXR5IjogY2l0eSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlN0YXRlIjogc3RhdGUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJaaXBQb3N0YWxDb2RlIjogemlwLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiRXh0ZXJuYWxJZCI6IHBhcnR5SWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJQYXJ0eUlkIjogcGFydHlJZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hpcHBpbmcucHVzaCh7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJTaGlwcGluZ01ldGhvZElEIjogc2VsZi5waWNrdXBNZXRob2QoKS5pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlNoaXBwaW5nTWV0aG9kTmFtZSI6IHNlbGYucGlja3VwTWV0aG9kKCkuZGVzY3JpcHRpb24sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJTaGlwcGluZ1ByZWZlcmVuY2VUeXBlIjogMSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlBhcnR5SUQiOiBwYXJ0eUlkLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiTGluZUlEcyI6IFtsaW5lSWRdDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAob3JkZXJTaGlwcGluZ1ByZWZlcmVuY2UgPT09IDMpIHsNCiAgICAgICAgICAgIHNoaXBwaW5nLnB1c2goew0KICAgICAgICAgICAgICAgICJTaGlwcGluZ01ldGhvZElEIjogc2VsZi5lbWFpbERlbGl2ZXJ5TWV0aG9kKCkuRXh0ZXJuYWxJZCwNCiAgICAgICAgICAgICAgICAiU2hpcHBpbmdNZXRob2ROYW1lIjogc2VsZi5lbWFpbERlbGl2ZXJ5TWV0aG9kKCkuRGVzY3JpcHRpb24sDQogICAgICAgICAgICAgICAgIlNoaXBwaW5nUHJlZmVyZW5jZVR5cGUiOiBvcmRlclNoaXBwaW5nUHJlZmVyZW5jZSwNCiAgICAgICAgICAgICAgICAiRWxlY3Ryb25pY0RlbGl2ZXJ5RW1haWwiOiBzZWxmLnNoaXBwaW5nRW1haWwoKSwNCiAgICAgICAgICAgICAgICAiRWxlY3Ryb25pY0RlbGl2ZXJ5RW1haWxDb250ZW50Ijogc2VsZi5zaGlwcGluZ0VtYWlsQ29udGVudCgpDQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgdmFyIGRhdGEgPSAneyJEZWxpdmVyeUl0ZW1QYXRoIjogIicgKyAkKCIjRGVsaXZlcnlJdGVtUGF0aCIpLnZhbCgpICsgJyIsICJPcmRlclNoaXBwaW5nUHJlZmVyZW5jZVR5cGUiOiAiJyArIG9yZGVyU2hpcHBpbmdQcmVmZXJlbmNlICsgJyIsICJTaGlwcGluZ01ldGhvZHMiOicgKyBKU09OLnN0cmluZ2lmeShzaGlwcGluZykgKyAnLCAiU2hpcHBpbmdBZGRyZXNzZXMiOicgKyBKU09OLnN0cmluZ2lmeShwYXJ0aWVzKSArICd9JzsNCg0KICAgICAgICAgICAgQWpheFNlcnZpY2UuUG9zdCgiL2FwaS9jeGEvY2hlY2tvdXQvU2V0U2hpcHBpbmdNZXRob2RzIiwgSlNPTi5wYXJzZShkYXRhKSwgZnVuY3Rpb24gKGRhdGEsIHN1Y2Nlc3MsIHNlbmRlcikgew0KICAgICAgICAgICAgICAgIGlmIChzdWNjZXNzICYmIGRhdGEuU3VjY2Vzcykgew0KICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGRhdGEuTmV4dFBhZ2VMaW5rOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICQoIiNUb0JpbGxpbmdCdXR0b24iKS5idXR0b24oJ3Jlc2V0Jyk7DQogICAgICAgICAgICB9LCAkKHRoaXMpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBkYXRhID0gJ3siRGVsaXZlcnlJdGVtUGF0aCI6ICInICsgJCgiI0RlbGl2ZXJ5SXRlbVBhdGgiKS52YWwoKSArICciLCAiT3JkZXJTaGlwcGluZ1ByZWZlcmVuY2VUeXBlIjogIicgKyBvcmRlclNoaXBwaW5nUHJlZmVyZW5jZSArICciLCAiU2hpcHBpbmdNZXRob2RzIjonICsgSlNPTi5zdHJpbmdpZnkoc2hpcHBpbmcpICsgJywgIlNoaXBwaW5nQWRkcmVzc2VzIjonICsgSlNPTi5zdHJpbmdpZnkocGFydGllcykgKyAnfSc7DQoNCiAgICAgICAgQWpheFNlcnZpY2UuUG9zdCgiL2FwaS9jeGEvY2hlY2tvdXQvU2V0U2hpcHBpbmdNZXRob2RzIiwgSlNPTi5wYXJzZShkYXRhKSwgZnVuY3Rpb24gKGRhdGEsIHN1Y2Nlc3MsIHNlbmRlcikgew0KICAgICAgICAgICAgaWYgKHN1Y2Nlc3MgJiYgZGF0YS5TdWNjZXNzKSB7DQogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBkYXRhLk5leHRQYWdlTGluazsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJCgiI1RvQmlsbGluZ0J1dHRvbiIpLmJ1dHRvbigncmVzZXQnKTsNCiAgICAgICAgfSwgJCh0aGlzKSk7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQoNCg0KfQ0KDQprby5iaW5kaW5nSGFuZGxlcnMuY2hlY2tNZSA9IHsNCiAgICBpbml0OiBmdW5jdGlvbiAoZWxlbWVudCwgdmFsdWVBY2Nlc3NvciwgYWxsLCB2bSwgYmluZGluZ0NvbnRleHQpIHsNCiAgICAgICAga28udXRpbHMucmVnaXN0ZXJFdmVudEhhbmRsZXIoZWxlbWVudCwgImNsaWNrIiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGNoZWNrZWRWYWx1ZSA9IHZhbHVlQWNjZXNzb3IoKSwNCiAgICAgICAgICAgICAgICBtZVZhbHVlID0gYmluZGluZ0NvbnRleHQuJGRhdGEsDQogICAgICAgICAgICAgICAgY2hlY2tlZCA9IGVsZW1lbnQuY2hlY2tlZDsNCiAgICAgICAgICAgIGlmIChjaGVja2VkICYmIGtvLmlzT2JzZXJ2YWJsZShjaGVja2VkVmFsdWUpKSB7DQogICAgICAgICAgICAgICAgY2hlY2tlZFZhbHVlKG1lVmFsdWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9LA0KICAgIHVwZGF0ZTogZnVuY3Rpb24gKGVsZW1lbnQsIHZhbHVlQWNjZXNzb3IsIGFsbCwgdm0sIGJpbmRpbmdDb250ZXh0KSB7DQogICAgICAgIHZhciBjaGVja2VkVmFsdWUgPSBrby51dGlscy51bndyYXBPYnNlcnZhYmxlKHZhbHVlQWNjZXNzb3IoKSksDQogICAgICAgICAgICBtZVZhbHVlID0gYmluZGluZ0NvbnRleHQuJGRhdGE7DQoNCiAgICAgICAgZWxlbWVudC5jaGVja2VkID0gKGNoZWNrZWRWYWx1ZSA9PT0gbWVWYWx1ZSk7DQogICAgfQ0KfTsNCg0KZnVuY3Rpb24gaXNJdGVtVmFsaWQoZWxlbWVudCwgaW5kZXgsIGFycmF5KSB7DQogICAgcmV0dXJuIChlbGVtZW50ID09PSB0cnVlKTsNCn0NCmZ1bmN0aW9uIEdldE5lYXJlc3RTdG9yZXMoU2VydmljZVJlcXVlc3QpIHsNCg0KICAgIHZhciB1cmwgPSAiL2FwaS9jeGEvTmVhcmVzdFN0b3JlL0dldFN0b3Jlcz91c2VyTGF0aXR1ZGU9IiArIFNlcnZpY2VSZXF1ZXN0LkxhdGl0dWRlICsgIiZ1c2VyTG9uZ2l0dWRlPSIgKyBTZXJ2aWNlUmVxdWVzdC5Mb25naXR1ZGUgKyAiJnBpZD0iICsgU2VydmljZVJlcXVlc3QuUHJvZHVjdElkICsgIi0iICsgU2VydmljZVJlcXVlc3QuVmFyaWFudElkOw0KICAgIHZhciByZXF1ZXN0RGF0YSA9IEpTT04uc3RyaW5naWZ5KFNlcnZpY2VSZXF1ZXN0KTsNCiAgICAkKCcubG9hZGVyJykuc2hvdygpOw0KICAgIHZhciBhamF4UmVxdWVzdCA9ICQuYWpheCh7DQogICAgICAgIHR5cGU6ICdQT1NUJywNCiAgICAgICAgY29udGVudFR5cGU6ICJhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTgiLA0KICAgICAgICB1cmw6IHVybCwNCiAgICAgICAgLy9kYXRhOiB7ICd1c2VyTGF0aXR1ZGUnOiBTZXJ2aWNlUmVxdWVzdC5MYXRpdHVkZSwgJ3VzZXJMb25naXR1ZGUnOiBTZXJ2aWNlUmVxdWVzdC5Mb25naXR1ZGUgfSwNCiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHsNCiAgICAgICAgICAgICQoJy5sb2FkZXInKS5oaWRlKCk7DQogICAgICAgIH0sDQogICAgICAgIGVycm9yOiBmdW5jdGlvbiAoeCwgeSwgeikgew0KICAgICAgICB9DQogICAgfSk7DQogICAgcmV0dXJuIGFqYXhSZXF1ZXN0Ow0KfQ0KDQpmdW5jdGlvbiBHZXRJbnZlbnRvcnkoU2VydmljZVJlcXVlc3QpIHsNCg0KICAgIHZhciB1cmwgPSAiL2FwaS9jeGEvTmVhcmVzdFN0b3JlL0dldEludmVudG9yeT9waWQ9IiArIFNlcnZpY2VSZXF1ZXN0LlByb2R1Y3RJZCArICItIiArIFNlcnZpY2VSZXF1ZXN0LlZhcmlhbnRJZDsNCiAgICB2YXIgcmVxdWVzdERhdGEgPSBKU09OLnN0cmluZ2lmeShTZXJ2aWNlUmVxdWVzdCk7DQogICAgJCgnLmxvYWRlcicpLnNob3coKTsNCiAgICB2YXIgYWpheFJlcXVlc3QgPSAkLmFqYXgoew0KICAgICAgICB0eXBlOiAnUE9TVCcsDQogICAgICAgIGNvbnRlbnRUeXBlOiAiYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04IiwNCiAgICAgICAgdXJsOiB1cmwsDQogICAgICAgIC8vZGF0YTogeyAndXNlckxhdGl0dWRlJzogU2VydmljZVJlcXVlc3QuTGF0aXR1ZGUsICd1c2VyTG9uZ2l0dWRlJzogU2VydmljZVJlcXVlc3QuTG9uZ2l0dWRlIH0sDQogICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7DQogICAgICAgICAgICAkKCcubG9hZGVyJykuaGlkZSgpOw0KICAgICAgICB9LA0KICAgICAgICBlcnJvcjogZnVuY3Rpb24gKHgsIHksIHopIHsNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHJldHVybiBhamF4UmVxdWVzdDsNCn0NCg0KZnVuY3Rpb24gTmV3UGlja3VwU3RvcmUoZGF0YSkgew0KICAgIHNlbGYgPSB0aGlzOw0KICAgICQoZGF0YSkubWFwKGZ1bmN0aW9uIChpLCBiKSB7DQogICAgICAgIGlmICgoYlsnS2V5J10gPT0gJ0lkJykpDQogICAgICAgICAgICBzZWxmLklkID0gYlsnVmFsdWUnXTsNCiAgICAgICAgaWYgKChiWydLZXknXSA9PSAnRXh0ZXJuYWxJZCcpKQ0KICAgICAgICAgICAgc2VsZi5FeHRlcm5hbElkID0gYlsnVmFsdWUnXTsNCiAgICAgICAgaWYgKChiWydLZXknXSA9PSAnSW52ZW50b3J5U3RvcmVJZCcpKQ0KICAgICAgICAgICAgc2VsZi5JbnZlbnRvcnlTdG9yZUlkID0gYlsnVmFsdWUnXTsNCiAgICAgICAgaWYgKChiWydLZXknXSA9PSAnSW52ZW50b3J5U3RvcmVJZCcpKQ0KICAgICAgICAgICAgc2VsZi5EaXN0YW5jZSA9IGJbJ1ZhbHVlJ107DQogICAgICAgIGlmICgoYlsnS2V5J10gPT0gJ1plcm9JbnZlbnRvcnknKSkNCiAgICAgICAgICAgIHNlbGYuWmVyb0ludmVudG9yeSA9IGJbJ1ZhbHVlJ107DQogICAgICAgIGlmICgoYlsnS2V5J10gPT0gJ0Rpc3BsYXlOYW1lJykpDQogICAgICAgICAgICBzZWxmLkRpc3BsYXlOYW1lID0gYlsnVmFsdWUnXTsNCiAgICAgICAgaWYgKChiWydLZXknXSA9PSAnTGltaXRlZCcpKQ0KICAgICAgICAgICAgc2VsZi5MaW1pdGVkID0gYlsnVmFsdWUnXTsNCiAgICAgICAgaWYgKChiWydLZXknXSA9PSAnUXVhbnRpdHknKSkNCiAgICAgICAgICAgIHNlbGYuUXVhbnRpdHkgPSBiWydWYWx1ZSddOw0KICAgICAgICBpZiAoKGJbJ0tleSddID09ICdJbnZlbnRvcnlBbW91bnQnKSkNCiAgICAgICAgICAgIHNlbGYuSW52ZW50b3J5QW1vdW50ID0gYlsnVmFsdWUnXTsNCiAgICAgICAgaWYgKChiWydLZXknXSA9PSAnQWRkcmVzcycpKQ0KICAgICAgICAgICAgc2VsZi5BZGRyZXNzMSA9IGJbJ1ZhbHVlJ107DQogICAgICAgIGlmICgoYlsnS2V5J10gPT0gJ0NpdHknKSkNCiAgICAgICAgICAgIHNlbGYuQ2l0eSA9IGJbIlZhbHVlIl07DQogICAgICAgIGlmICgoYlsnS2V5J10gPT0gJ1ppcCcpKQ0KICAgICAgICAgICAgc2VsZi5aaXAgPSBiWyJWYWx1ZSJdOw0KICAgICAgICBpZiAoKGJbJ0tleSddID09ICdTdGF0ZScpKQ0KICAgICAgICAgICAgc2VsZi5TdGF0ZSA9IGJbIlZhbHVlIl07DQogICAgICAgIGlmICgoYlsnS2V5J10gPT0gJ0NvdW50cnknKSkNCiAgICAgICAgICAgIHNlbGYuQ291bnRyeSA9IGJbIlZhbHVlIl07DQogICAgfSkNCn0NCg0KDQoNCg0KDQoNCg0K
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 29481
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: da
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20190311T183725Z
    - ID: "5dd74568-4d4b-44c1-b513-0af5f4cda34f"
      Hint: __Created by
      Value: |
        sitecore\admin
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20190311T183725Z
- Language: "fr-CA"
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20190311T183726Z
    - ID: "5dd74568-4d4b-44c1-b513-0af5f4cda34f"
      Hint: __Created by
      Value: |
        sitecore\admin
- Language: "ja-JP"
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20190311T183726Z
    - ID: "5dd74568-4d4b-44c1-b513-0af5f4cda34f"
      Hint: __Created by
      Value: |
        sitecore\admin
